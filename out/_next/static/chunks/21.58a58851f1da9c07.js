(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[21],{2601:function(t,e,i){"use strict";var s,a;t.exports=(null==(s=i.g.process)?void 0:s.env)&&"object"==typeof(null==(a=i.g.process)?void 0:a.env)?i.g.process:i(8960)},3625:function(t,e,i){"use strict";let s;i.r(e),i.d(e,{default:function(){return tV}});var a,n,r,o,h,c,l=i(6306),d=i.n(l);let u={width:32,height:32},g={width:1280,height:720},m={width:g.width,height:.2*g.height},p={width:.08*m.width,height:m.height},E={width:m.height,height:m.height},T={type:d().AUTO,scale:{mode:d().Scale.FIT,autoCenter:d().Scale.CENTER_BOTH,width:g.width,height:g.height},parent:"game",backgroundColor:0,physics:{default:"arcade",arcade:{}}},y={cardEvent:Object.freeze({SELECT:"select-card",PLAY:"play-card",CANCEL:"cancel-card-select"}),uiEvent:Object.freeze({UPDATE_RESOURCE_DISPLAY:"update-resource-display",UPDATE_HAND:"update-hand-ui",UPDATE_UNIT_STAT_DISPLAY:"update-unit-stat-display",UPDATE_DECK_COUNTER:"update-deck-counter",UPDATE_CASUALTY_COUNTER:"update-casualty-counter",PLAY_FLOATING_TEXT:"play-floating-text"}),gameEvent:Object.freeze({PLAYER_TURN:"player-turn",NEXT_TURN:"next-turn"}),playerEvent:Object.freeze({GENERATE_RESOURCES:"generate-resources"}),fieldEvent:Object.freeze({SUMMON_UNIT:"summon-unit",CAST_SPELL:"cast-spell",CAPTURE_LANDMARK:"capture-landmark"}),unitEvent:Object.freeze({SELECT:"select-unit",CANCEL:"cancel-unit-select",ATTACK:"attack-unit",MOVE:"move-unit",WAIT:"wait-unit",DEATH:"unit-death"})},v=Object.freeze({player:"player",opponents:"opponents",allies:"allies",field:"field"}),f=Object.freeze({GAMEPLAY:"GameplayScene",HUD:"HUD",LOADING:"Loading",TURN_TRANSITION:"TurnTransition"}),O=Object.freeze({SOLDIER:"Soldier",BERSERKER:"Berserker",GUARDIAN:"Guardian",RANGER:"Ranger",ASSASSIN:"Assassin",MAGE:"Mage",LANCER:"Lancer",TOWER:"Tower"}),A=Object.freeze({SOLDIER:1,BERSERKER:3,RANGER:4,ASSASSIN:5,GUARDIAN:6,TOWER:7,MAGE:9,LANCER:13});function S(t){switch(t){case O.SOLDIER:return A.SOLDIER;case O.GUARDIAN:return A.GUARDIAN;case O.RANGER:return A.RANGER;case O.MAGE:return A.MAGE;case O.LANCER:return A.LANCER;case O.TOWER:return A.TOWER;case O.BERSERKER:return A.BERSERKER;case O.ASSASSIN:return A.ASSASSIN;default:return A.SOLDIER}}class P{constructor(t,e,i,s,a,n,r,o,h,c,l,d,u,g){this.id=t,this.name=e,this.unitClass=i,this.hp=s,this.sp=a,this.pwr=n,this.def=r,this.mvt=o,this.rng=h,this.passiveSkillDesc=l,this.passiveSkillData=d,this.activeSkillDesc=u,this.activeSkillData=g,this.cost=c}}class w extends P{constructor(t,e,i,s,a,n,r,o,h,c,l,d,u,g,m,p,E){super(t,e,i,s,a,n,r,o,h,E,d,u,g,m),this.leaderSkillDesc=c,this.leaderSkillData=l,this.minions=p}}class R{constructor(t){this.name=t.name,this.unitClass=t.unitClass,this.baseMaxHp=t.hp,this.maxHP=t.hp,this.currHp=t.hp,this.baseMaxSp=t.sp,this.maxSP=t.sp,this.currSp=t.sp,this.basePwr=t.pwr,this.currPwr=t.pwr,this.baseDef=t.def,this.currDef=t.def,this.baseMvt=t.mvt,this.currMvt=t.mvt,this.baseRng=t.rng,this.currRng=t.rng,this.stunTime=0,this.sleepTime=0,this.rush=!1}}let _=Object.freeze({none:"none",ally:"ally",enemy:"enemy",position:"position"}),C=Object.freeze({actionLight:65520,action:119,cancelLight:11141120,cancel:7798784,background:1842204,damage:16711680,heal:65280,mana:5011175}),N=new Phaser.Events.EventEmitter;function L(t,e,i){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<=i}class x{constructor(t,e,i,s,a,n){this.id=t,this.name=e,this.cost=s,this.description=a,this.effectData=n,this.targetType=i}}let D=Object.freeze({TILE_SET:"tile-set",MAP_ICONS:"map-icons",TILE_MAP:"map",TILE_GROUND_LAYER:"Ground",TILE_DECORATION_LAYER:"Decoration",TILE_OBSTACLE_LAYER:"Obstacles",TILE_LANDMARKS_LAYER:"Landmarks",TILE_MAP_PLAYER_START_LAYER:"PlayerStart",TILE_MAP_TILE_SET_IMG:"tileset",TILE_MAP_ICON_SET_IMG:"mapicons",CLASS_ICONS:"class-icons",HP_ICON:"hp-icon",SP_ICON:"sp-icon",PWR_ICON:"pwr-icon",DECK_COUNT:"deck-count",DEATH_COUNT:"death-count",INCOME_RATE:"income-rate",ATTACK_SELECTOR:"attack-selector",SPELL_SELECTOR:"spell-selector",UNDEFINED:"undefined",PORTRAIT:"portrait_",YOUR_TURN:"your-turn",OPPONENT_TURN:"opponent-turn"});function U(t,e,i,s,a,n){let r="".concat(D.PORTRAIT,"_").concat(i,"_").concat(s);t.load.image(r,"assets/portraits/".concat(i.toLowerCase(),"/").concat(s,".png")),t.load.once(Phaser.Loader.Events.COMPLETE,()=>{null==e||e.setTexture(r).setOrigin(.5).setDisplaySize(a,n)}),t.load.start()}class b extends Phaser.GameObjects.Container{renderCardBase(t,e){let i=e.data instanceof x?"spells":e.data instanceof w?"heroes":"units",s=this.scene.add.rectangle(0,0,p.width,p.height,0).setOrigin(0,0).setStrokeStyle(1,0);this.add(s),this.setInteractive(s,Phaser.Geom.Rectangle.Contains).on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{N.emit(y.cardEvent.SELECT,e)});let a=this.scene.add.sprite(.5*p.width,.5*p.height,D.UNDEFINED).setDisplaySize(.98*p.width,.98*p.height).setOrigin(.5);this.add(a),U(t,a,i,e.data.id,.98*p.width,.98*p.height);let n=this.scene.add.circle(0,0,.15*p.width,14277081).setStrokeStyle(1,0).setOrigin(0);this.add(n);let r=this.scene.add.text(.09*p.width,.025*p.width,String(e.data.cost),{color:"#000",fontFamily:'"Sansita",sans-serif',fontSize:24}).setOrigin(0);this.add(r)}constructor(t,e){super(t,e.getPosition().x,e.getPosition().y),this.card=e,this.renderCardBase(t,e)}}class I extends b{renderContents(){let t=this.scene.add.image(p.width-1,p.height,D.HP_ICON).setDisplaySize(.2*p.height,.2*p.height).setOrigin(1);this.add(t);let e=this.scene.add.text(p.width-1,p.height,String(this.card.data.hp),{color:"#FFF",fontFamily:'"Sansita",sans-serif',fontSize:24}).setOrigin(1);this.add(e);let i=this.scene.add.image(1,p.height-.2*p.height,D.PWR_ICON).setDisplaySize(.2*p.height,.2*p.height).setOrigin(0);this.add(i);let s=this.scene.add.text(.1*p.width,p.height,String(this.card.data.pwr),{color:"#FFF",fontFamily:'"Sansita",sans-serif',fontSize:24}).setOrigin(0,1);this.add(s);let a=this.scene.add.image(p.width-1,0,D.CLASS_ICONS,S(this.card.data.unitClass)).setOrigin(1,0);this.add(a)}constructor(t,e){super(t,e),this.renderContents()}}class k extends I{constructor(t,e){super(t,e),this.renderContents()}}class G{setPosition(t){var e;this.position=t,null===(e=this.gameObject)||void 0===e||e.setPosition(t.x,t.y)}getPosition(){return this.position}setOwner(t){this.owner=t}getOwner(){return this.owner}getGameObject(){return this.gameObject}hide(){var t;null===(t=this.gameObject)||void 0===t||t.setVisible(!1)}constructor(t,e,i){this.id=t,this.data=e,this.owner=i,this.position={x:0,y:0}}}class M extends G{play(t){N.emit(y.fieldEvent.SUMMON_UNIT,t,this.data,this.owner)}render(t){return this.gameObject||(this.gameObject=new I(t,this)),this.gameObject}constructor(t,e,i){super(t,e,i)}}class H extends M{play(t){N.emit(y.fieldEvent.SUMMON_UNIT,t,this.data,this.owner)}render(t){return this.gameObject||(this.gameObject=new k(t,this)),this.gameObject}constructor(t,e,i){super(t,e,i)}}let j=Object.freeze({main:'"Noto Sans",sans-serif',secondary:'"Sansita",sans-serif'});class V extends Phaser.GameObjects.Container{show(t){this.attacker=t,this.setVisible(!0)}hide(){this.setVisible(!1),this.attacker=void 0}constructor(t,e){super(t,0,0),this.unit=e;let i=t.add.rectangle(0,0,u.width,u.height).setOrigin(0);this.add(i);let s=t.add.image(0,0,D.ATTACK_SELECTOR).setOrigin(0);this.add(s),this.setInteractive(i,Phaser.Geom.Rectangle.Contains).on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{this.attacker&&N.emit(y.unitEvent.ATTACK,this.attacker,e)}),this.hide()}}class Y extends Phaser.GameObjects.Text{play(t,e){this.setText(t);let i=Phaser.Display.Color.IntegerToRGB(e);this.setColor(Phaser.Display.Color.RGBToString(i.r,i.g,i.b)),this.setVisible(!0),this.animation.restart(),this.animation.play()}constructor(t){super(t,0,0,"",{fontFamily:j.main,fontSize:16}),this.animation=t.tweens.add({targets:this,alpha:{from:1,to:.5},y:{from:.5*u.height,to:-(.5*u.height)},ease:"Linear.None",duration:1e3,repeat:0,yoyo:!1,persist:!0,onComplete:()=>{this.setVisible(!1)}})}}let z=Object.freeze({none:0,success:65520,warning:16776960,danger:16711680});class F extends Phaser.GameObjects.Container{show(t){let e=t.getOwner().id,i=this.unit.getOwner().playerInfo.id,s=t.data.targetType;(e!==i||s!==_.enemy)&&(e===i||s!==_.ally)&&(this.spellCard=t,this.selector.tint=t.data.targetType===_.ally?z.success:t.data.targetType===_.enemy?z.danger:z.none,this.setVisible(!0))}hide(){this.setVisible(!1)}constructor(t,e){super(t,0,0),this.unit=e;let i=t.add.rectangle(0,0,u.width,u.height).setOrigin(0);this.add(i),this.selector=t.add.image(0,0,D.SPELL_SELECTOR).setOrigin(0),this.add(this.selector),this.setInteractive(i,Phaser.Geom.Rectangle.Contains).on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{this.spellCard&&(console.log("Cast ".concat(this.spellCard.data.name," onto ").concat(this.unit.getUnitData().name,"!")),N.emit(y.cardEvent.PLAY,this.unit))}),this.hide()}}class B extends Phaser.GameObjects.Container{getImage(){return this.image}updateHpText(){this.hpText.setText(String(this.unit.getUnitData().currHp))}updatePwrText(){this.hpText.setText(String(this.unit.getUnitData().currPwr))}constructor(t,e){super(t,e.getPixelPosition().x,e.getPixelPosition().y),this.unit=e;let i=e.getUnitType(),s=e.getOwner().color;this.activeColor=s;let a=Phaser.Display.Color.ValueToColor(s).darken(80);this.inactiveColor=a.color,this.imageAssetName="".concat(D.PORTRAIT,"_").concat(i,"_").concat(e.card.id);let n=t.add.rectangle(u.width/2,u.height/2,.95*u.width,.95*u.height,s).setOrigin(.5);this.add(n),this.image=t.add.sprite(.5*u.width,.5*u.height,this.imageAssetName).setOrigin(.5).setDisplaySize(.85*u.width,.85*u.height),t.textures.exists(this.imageAssetName)||U(t,this.image,i,e.card.id,.85*u.width,.85*u.height),this.add(this.image),e.isActive()?this.image.setAlpha(1):this.image.setAlpha(.7);let r=t.add.image(u.width,0,D.CLASS_ICONS,S(e.getUnitData().unitClass)).setDisplaySize(.3*u.width,.3*u.height).setOrigin(1,0);this.add(r);let o=this.scene.add.image(u.width-1,.95*u.height,D.HP_ICON).setDisplaySize(.3*u.height,.3*u.height).setOrigin(1);this.add(o),this.hpText=this.scene.add.text(u.width-1,.95*u.height,String(e.getUnitData().currHp),{fontFamily:j.secondary,fontSize:8,resolution:3.125}).setOrigin(1),this.add(this.hpText);let h=this.scene.add.image(1,.95*u.height-.3*u.height,D.PWR_ICON).setDisplaySize(.3*u.height,.3*u.height).setOrigin(0);if(this.add(h),this.pwrText=this.scene.add.text(.1*u.width,.95*u.height,String(e.getUnitData().currPwr),{fontFamily:j.secondary,fontSize:8,resolution:3.125}).setOrigin(0,1),this.add(this.pwrText),e.card instanceof w){var c,l;let e=t.add.rectangle(u.width/2,u.height/2,u.width,u.height,s).setOrigin(.5);this.add(e),null===(c=e.preFX)||void 0===c||c.addGlow(void 0,void 0,void 0,!0),null===(l=e.postFX)||void 0===l||l.addGlow(void 0,void 0,void 0,!0),t.tweens.add({targets:e,alpha:{from:0,to:.1},scale:{from:1,to:1.1},ease:"Quartic.Out",duration:2e3,repeat:-1,yoyo:!0,persist:!0})}this.attackSelector=new V(t,e),this.add(this.attackSelector),this.spellSelector=new F(t,e),this.add(this.spellSelector),this.floatingText=new Y(t).setOrigin(.5).setPosition(u.width/2,u.height/2),this.add(this.floatingText),this.setInteractive(new Phaser.Geom.Rectangle(.05*u.width,.05*u.height,u.width,u.height),Phaser.Geom.Rectangle.Contains).on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{N.emit(y.unitEvent.SELECT,e)}),this.scene.add.existing(this)}}class W{handleEvents(){N.on(y.unitEvent.SELECT,t=>{var e,i;t!=this&&(t.owner.getTeam()!=this.owner.getTeam()&&L(t.getLocation(),this.getLocation(),t.unitData.currRng)?null===(e=this.gameObject)||void 0===e||e.attackSelector.show(t):null===(i=this.gameObject)||void 0===i||i.attackSelector.hide())}).on(y.unitEvent.MOVE,(t,e)=>{var i,s;if(t==this){console.log("Move ".concat(this.unitData.name," to (").concat(e.x,",").concat(e.y,")")),this.move(e);return}t.owner.getTeam()!=this.owner.getTeam()&&L(e,this.getLocation(),t.unitData.currRng)?null===(i=this.gameObject)||void 0===i||i.attackSelector.show(t):null===(s=this.gameObject)||void 0===s||s.attackSelector.hide()}).on(y.unitEvent.CANCEL,()=>{var t,e;(null===(t=this.gameObject)||void 0===t?void 0:t.attackSelector.visible)&&(null===(e=this.gameObject)||void 0===e||e.attackSelector.hide())}).on(y.unitEvent.WAIT,()=>{var t,e;(null===(t=this.gameObject)||void 0===t?void 0:t.attackSelector.visible)&&(null===(e=this.gameObject)||void 0===e||e.attackSelector.hide())}).on(y.cardEvent.SELECT,t=>{var e,i,s;if((null===(e=this.gameObject)||void 0===e?void 0:e.spellSelector.visible)&&(null===(i=this.gameObject)||void 0===i||i.spellSelector.hide()),t instanceof M||t instanceof H)return;let a=t.data.targetType;a!==_.none&&(null===(s=this.gameObject)||void 0===s||s.spellSelector.show(t))}).on(y.cardEvent.CANCEL,()=>{var t,e,i,s;(null===(t=this.gameObject)||void 0===t?void 0:t.attackSelector.visible)&&(null===(e=this.gameObject)||void 0===e||e.attackSelector.hide()),(null===(i=this.gameObject)||void 0===i?void 0:i.spellSelector.visible)&&(null===(s=this.gameObject)||void 0===s||s.spellSelector.hide())}).on(y.gameEvent.PLAYER_TURN,t=>{t==this.owner.id&&this.wake()}).on(y.uiEvent.PLAY_FLOATING_TEXT,(t,e,i)=>{var s;t===this&&(null===(s=this.gameObject)||void 0===s||s.floatingText.play(e,i))})}getUnitData(){return this.unitData}setLocation(t){var e;this.location=t,this.pixelPosition={x:t.x*u.width,y:t.y*u.height},null===(e=this.gameObject)||void 0===e||e.setPosition(this.pixelPosition.x,this.pixelPosition.y)}getLocation(){return this.location}getPixelPosition(){return this.pixelPosition}getDestination(){return this.destination}render(t){this.setLocation(this.location),this.gameObject||(this.setLocation(this.getLocation()),this.gameObject=new B(t,this),this.handleEvents())}isActive(){return this.active}wake(){var t;null===(t=this.gameObject)||void 0===t||t.getImage().setAlpha(1),this.active=!0,this.updateEffects(),this.clearInactiveEffects()}sleep(){var t;null===(t=this.gameObject)||void 0===t||t.getImage().setAlpha(.7),this.active=!1}move(t){var e;this.destination=t,null===(e=this.gameObject)||void 0===e||e.setPosition(t.x*u.width,t.y*u.height)}confirmMove(){var t;this.destination&&(this.location=this.destination,this.destination=void 0),null===(t=this.gameObject)||void 0===t||t.setPosition(this.location.x*u.width,this.location.y*u.height),this.sleep()}cancelMove(){var t;this.destination=void 0,null===(t=this.gameObject)||void 0===t||t.setPosition(this.location.x*u.width,this.location.y*u.height)}getUnitType(){return this.card instanceof w?"heroes":"units"}getOwner(){return this.owner}getGameObject(){return this.gameObject}killUnit(){var t;console.log("".concat(this.id," has been slain...")),this.active=!1,null===(t=this.gameObject)||void 0===t||t.setVisible(!1),N.emit(y.unitEvent.DEATH,this)}insertBuff(t){t.setTarget(this),this.buffs=[...this.buffs,t]}insertDebuff(t){t.setTarget(this),this.debuffs=[...this.debuffs,t]}removeBuff(t){this.buffs=this.buffs.filter(e=>e!=t)}removeDebuff(t){this.debuffs=this.debuffs.filter(e=>e!=t)}updateEffects(){this.buffs.forEach(t=>{t.apply()}),this.debuffs.forEach(t=>{t.apply()})}clearInactiveEffects(){this.buffs=this.buffs.filter(t=>t.isActive()),this.debuffs=this.debuffs.filter(t=>t.isActive())}takeDamage(t){var e;this.unitData.currHp-=t,console.log("".concat(this.unitData.name," takes ").concat(t," damage!")),null===(e=this.getGameObject())||void 0===e||e.updateHpText(),this.unitData.currHp<=0&&this.killUnit(),N.emit(y.uiEvent.PLAY_FLOATING_TEXT,this,-t,C.damage)}heal(t){var e;this.unitData.currHp+=t,this.unitData.currHp>=this.unitData.maxHP&&(this.unitData.currHp=this.unitData.maxHP),null===(e=this.getGameObject())||void 0===e||e.updateHpText(),console.log("".concat(this.unitData.name," heals ").concat(t," hp!")),N.emit(y.uiEvent.PLAY_FLOATING_TEXT,this,t,C.heal)}update(){}constructor(t,e,i,s){this.id=t,this.card=i,this.unitData=new R(i),this.location=e,this.pixelPosition={x:e.x*u.width,y:e.y*u.height},this.owner=s,this.active=this.unitData.rush,this.buffs=[],this.debuffs=[]}}let K=Object.freeze({VALUE:"value",PERCENTAGE:"percentage"});class X{isActive(){return this.active}getCurrTime(){return this.currTime}remove(){if(!this.isRemovable){console.log("This spell effect cannot be removed.");return}this.forceRemove()}forceRemove(){this.active=!1,console.log("This spell effect has been removed.")}setTarget(t){this.target=t,this.active=!0}getTarget(){return this.target}reset(){this.duration&&!(this.duration<=0)&&(this.currTime=0)}constructor(t,e=0,i=!0){this.name=t,this.duration=e,this.currTime=0,this.isRemovable=i,this.active=!1}}class J extends X{applyChange(){if(!this.target)return;let t=this.target.getUnitData().currHp,e=this.target.getUnitData().maxHP,i=this.valueType===K.VALUE?this.amount:Math.ceil(t*(this.amount/100)),s=t+i;s>e&&(s=e),this.amount>0?this.target.heal(this.amount):this.target.takeDamage(-this.amount),this.target.getUnitData().currHp>0||this.forceRemove()}apply(){if(!this.active)return;let t=!0;(this.applyOverTime||this.isDelayed)&&this.currTime++,this.isDelayed&&this.currTime<this.duration&&(t=!1),t&&this.applyChange(),this.duration||this.remove(),this.duration>0&&this.currTime>=this.duration&&this.remove()}constructor(t,e,i=K.VALUE,s=0,a=!1,n=!1,r=!0){super(t,(a||n)&&s>0?s:0,r),this.amount=e,this.valueType=i,this.isDelayed=n,this.applyOverTime=a}}class Q extends J{constructor(t,e,i=K.VALUE,s=0,a=!1,n=!1,r=!0){super(t,-e,i,s,a,n,r)}}class Z extends J{constructor(t,e,i=K.VALUE,s=0,a=!1,n=!1,r=!0){super(t,e,i,s,a,n,r)}}class q{initiateFight(t,e){let i=this.calcDamage(t,e);if(console.log("".concat(null==t?void 0:t.getUnitData().name," attacks ").concat(e.getUnitData().name)),e.takeDamage(i),t.getDestination()&&!L(e.getLocation(),t.getDestination(),e.getUnitData().currRng)||!L(e.getLocation(),t.getLocation(),e.getUnitData().currRng))return;let s=this.calcDamage(e,t);console.log("".concat(null==e?void 0:e.getUnitData().name," retaliates!")),t.takeDamage(s)}calcDamage(t,e){let i=t.getUnitData(),s=e.getUnitData(),a=i.currPwr;switch(i.unitClass){case O.ASSASSIN:s.currHp<.5*s.maxHP&&(a=Math.ceil(1.2*a));break;case O.BERSERKER:i.currHp<.5*i.maxHP&&(a=Math.ceil(1.2*a))}return s.unitClass===O.GUARDIAN&&(a=Math.floor(.8*a)),a<1&&(a=1),a}constructor(){N.on(y.unitEvent.ATTACK,(t,e)=>{(null==t?void 0:t.isActive())&&(N.emit(y.unitEvent.WAIT),this.initiateFight(t,e))}).on(y.fieldEvent.CAST_SPELL,(t,e)=>{t.forEach(t=>{if(e){if(e instanceof W){if(console.log("Apply ".concat(t.name," onto ").concat(e.getUnitData().name,"..")),!t.duration){t.setTarget(e),t.apply();return}t instanceof Z?e.insertBuff(t):t instanceof Q&&e.insertDebuff(t)}else console.log("Apply ".concat(t," to (").concat(e.x,",").concat(e.y,")..."))}else console.log("Apply ".concat(t," without a target..."))})})}}let $=Object.freeze({HP:"hp",SP:"sp",PWR:"pwr",DEF:"def",MVT:"mvt",RNG:"rng"});class tt extends X{getAmount(){return this.amount}getStat(){return this.stat}applyStatChange(){switch(this.stat){case $.HP:this.delta=this.valueType===K.VALUE?this.amount:Math.floor(this.target.getUnitData().baseMaxHp*this.amount/100),this.target.getUnitData().maxHP+=this.delta;break;case $.SP:this.delta=this.valueType===K.VALUE?this.amount:Math.floor(this.target.getUnitData().baseMaxSp*this.amount/100),this.target.getUnitData().maxSP+=this.delta;break;case $.PWR:var t;this.delta=this.valueType===K.VALUE?this.amount:Math.floor(this.target.getUnitData().basePwr*this.amount/100),this.target.getUnitData().currPwr+=this.delta,null===(t=this.target.getGameObject())||void 0===t||t.updatePwrText();break;case $.DEF:this.delta=this.valueType===K.VALUE?this.amount:Math.floor(this.target.getUnitData().baseDef*this.amount/100),this.target.getUnitData().currDef+=this.delta;break;case $.MVT:this.delta=this.valueType===K.VALUE?this.amount:Math.floor(this.target.getUnitData().baseMvt*this.amount/100),this.target.getUnitData().currMvt+=this.delta}}apply(){this.active&&(this.applied||(this.applyStatChange(),this.applied=!0),this.duration||this.remove(),this.currTime<this.duration?this.currTime++:this.currTime>=this.duration&&this.duration>0&&this.remove())}forceRemove(){switch(this.stat){case $.HP:this.target.getUnitData().maxHP-=this.delta;break;case $.SP:this.target.getUnitData().maxSP-=this.delta;break;case $.PWR:var t;this.target.getUnitData().currPwr-=this.delta,null===(t=this.target.getGameObject())||void 0===t||t.updatePwrText();break;case $.DEF:this.target.getUnitData().currDef-=this.delta;break;case $.MVT:this.target.getUnitData().currMvt-=this.delta}this.active=!1,console.log("This spell effect has been removed.")}constructor(t,e,i=K.VALUE,s,a=0,n=!0){super(t,a,n),this.amount=e,this.valueType=i,this.stat=s,this.applied=!1,this.delta=0}}class te extends tt{constructor(t,e,i=K.VALUE,s,a=0,n=!0){super(t,e,i,s,a,n)}}class ti{constructor(t,e,i,s,a=!1){this.id=t,this.x=e,this.y=i,this.tile=s,this.capturable=a}}class ts extends ti{updateCaptureTick(){this.captureTick--}resetCaptureTick(){this.captureTick=3}getCaptureTicks(){return this.captureTick}capture(t){this.owner=t}getOwner(){return this.owner}constructor(t,e,i,s){super(t,e,i,s,!0),this.captureTick=3}}class ta extends ts{linkRallyPoints(t){this.rallyPoints=[...this.rallyPoints,...t]}getRallyPoints(){return this.rallyPoints}constructor(t,e,i,s){super(t,e,i,s),this.effects=[new te("Stronghold's Advantage",3,K.VALUE,$.PWR,-1,!1),new te("Stronghold's Advantage",3,K.VALUE,$.DEF,-1,!1)],this.rallyPoints=[]}}class tn extends ti{constructor(t,e,i,s){super(t,e,i,s)}}class tr extends ts{linkRallyPoints(t){this.rallyPoints=[...this.rallyPoints,...t]}getRallyPoints(){return this.rallyPoints}constructor(t,e,i,s){super(t,e,i,s),this.effects=[new te("Outpost's Advantage",1,K.VALUE,$.PWR,-1,!1),new te("Outpost's Advantage",1,K.VALUE,$.DEF,-1,!1)],this.rallyPoints=[]}}class to extends ts{constructor(t,e,i,s){super(t,e,i,s)}}class th extends ts{constructor(t,e,i,s){super(t,e,i,s)}}(a=o||(o={}))[a.SUCCESS=0]="SUCCESS",a[a.WARNING=1]="WARNING",a[a.DANGER=2]="DANGER",(n=h||(h={}))[n.NONE=0]="NONE",n[n.PLAY_CARD=1]="PLAY_CARD",n[n.MOVE_UNIT=2]="MOVE_UNIT";class tc{setStatus(t){let e=this.getColorByTileStatus(t);this.status=t,this.tile.setFillStyle(e,.25),this.tile.setStrokeStyle(1,e)}getStatus(){return this.status}getTile(){return this.tile}show(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.NONE;this.tileSelectionType=i,this.setStatus(t||this.initStatus),this.selectedUnit=e||void 0,this.tile.setVisible(!0)}hide(){this.status=this.initStatus,this.tile.setVisible(!1),this.selectedUnit=void 0}getColorByTileStatus(t){switch(t){case o.SUCCESS:return z.success;case o.WARNING:return z.warning;case o.DANGER:return z.danger;default:return z.none}}constructor(t,e,i,s,a,n,r=o.SUCCESS){let c=this.getColorByTileStatus(r);this.status=r,this.initStatus=r,this.tilePosition=s,this.tile=t.add.rectangle(i.x,i.y,a,n,c,.25).setOrigin(0).setStrokeStyle(1,c).setName(e).setInteractive(),this.tileSelectionType=h.NONE,this.selectedUnit=void 0,this.tile.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{if(this.status===o.SUCCESS)switch(this.tileSelectionType){case h.PLAY_CARD:N.emit(y.cardEvent.PLAY,{x:s.x,y:s.y});break;case h.MOVE_UNIT:N.emit(y.unitEvent.MOVE,this.selectedUnit,this.tilePosition)}else console.log("Not a valid target")}),this.tile.setVisible(!1)}}let tl="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var td={randomUUID:tl};let tu=new Uint8Array(16),tg=[];for(let t=0;t<256;++t)tg.push((t+256).toString(16).slice(1));var tm=function(t,e,i){if(td.randomUUID&&!e&&!t)return td.randomUUID();t=t||{};let a=t.random||(t.rng||function(){if(!s&&!(s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(tu)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e){i=i||0;for(let t=0;t<16;++t)e[i+t]=a[t];return e}return function(t,e=0){return tg[t[e+0]]+tg[t[e+1]]+tg[t[e+2]]+tg[t[e+3]]+"-"+tg[t[e+4]]+tg[t[e+5]]+"-"+tg[t[e+6]]+tg[t[e+7]]+"-"+tg[t[e+8]]+tg[t[e+9]]+"-"+tg[t[e+10]]+tg[t[e+11]]+tg[t[e+12]]+tg[t[e+13]]+tg[t[e+14]]+tg[t[e+15]]}(a)};class tp{handleEvents(){N.on(y.gameEvent.PLAYER_TURN,(t,e,i)=>{this.activePlayerIndex=e,this.isDevicePlayerTurn=i;let s=this.playersInGame[e];s.getActiveUnits().forEach(t=>{this.attemptCaptureLandmark(t)});let a=this.playersInGame[e].getLandmarksOwned(),n=2*a.strongholds.length+a.outposts.length+a.resourceNodes.length;N.emit(y.playerEvent.GENERATE_RESOURCES,t,n)}).on(y.gameEvent.NEXT_TURN,()=>{let t=this.playersInGame[this.activePlayerIndex];t.getActiveUnits().forEach(t=>{t.isActive()&&(t.sleep(),console.log("".concat(t.getUnitData().name," has not moved, so it was set to inactive...")))})}).on(y.cardEvent.SELECT,t=>{if(this.hideHighlightTiles(),t instanceof M||t instanceof H){let t=this.playersInGame[this.activePlayerIndex].getLandmarksOwned().rallyPoints.map(t=>({x:t.x,y:t.y}));this.showHighlightTiles(t,void 0,this.isDevicePlayerTurn?void 0:o.WARNING,h.PLAY_CARD)}else switch(t.data.targetType){case _.ally:console.log("Choose an ally to use ".concat(t.data.name," on..."));break;case _.enemy:console.log("Choose an enemy to use ".concat(t.data.name," on..."));break;case _.position:console.log("Choose a target location to use ".concat(t.data.name," on..."));break;default:console.log("Applied ".concat(t.data.name,"!"))}}).on(y.cardEvent.CANCEL,()=>{this.hideHighlightTiles()}).on(y.fieldEvent.SUMMON_UNIT,(t,e,i)=>{let s=this.playersInGame.find(t=>t.playerInfo.id==i.id);s&&this.summonUnit(t,e,s)}).on(y.unitEvent.SELECT,t=>{this.movingUnit&&this.movingUnit!=t&&this.movingUnit.cancelMove(),this.movingUnit=t,this.hideHighlightTiles();let e=t.getUnitData().currMvt,i=t.getUnitData().currRng,s=t.getLocation(),a=t.isActive();if(a&&this.isDevicePlayerTurn){let i=this.getTilesInRange(s,e,!1);this.showHighlightTiles(i,t,void 0,h.MOVE_UNIT);return}let n=this.getTilesInRange(s,i,!0);this.showHighlightTiles(n,t,o.WARNING)}).on(y.unitEvent.CANCEL,()=>{var t;this.hideHighlightTiles(),null===(t=this.movingUnit)||void 0===t||t.cancelMove(),this.movingUnit=void 0}).on(y.unitEvent.WAIT,()=>{if(this.hideHighlightTiles(),!this.movingUnit)return;let t=this.movingUnit.getLocation(),e=this.landmarks.get("".concat(t.x,"_").concat(t.y));e&&e.capturable&&(e.occupant=void 0,e.resetCaptureTick()),this.units.delete("".concat(t.x,"_").concat(t.y)),this.movingUnit.confirmMove();let i=this.movingUnit.getLocation(),s=this.landmarks.get("".concat(i.x,"_").concat(i.y));this.units.set("".concat(i.x,"_").concat(i.y),this.movingUnit),this.movingUnit=void 0,s&&(s.occupant=this.movingUnit)}).on(y.fieldEvent.CAPTURE_LANDMARK,(t,e)=>{t.getOwner().registerLandmark(e)}).on(y.unitEvent.DEATH,t=>{let e=t.getOwner();e.moveUnitToGraveyard(t);let i=t.getLocation();this.units.delete("".concat(i.x,"_").concat(i.y)),t.setLocation({x:-1,y:-1}),t.getOwner().isDevicePlayer&&N.emit(y.uiEvent.UPDATE_CASUALTY_COUNTER,e.getCasualties())})}generateMap(){let t=this.scene.make.tilemap({key:D.TILE_MAP});t.addTilesetImage(D.TILE_MAP_TILE_SET_IMG,D.TILE_SET),t.addTilesetImage(D.TILE_MAP_ICON_SET_IMG,D.MAP_ICONS);let e=t.createLayer(D.TILE_GROUND_LAYER,D.TILE_MAP_TILE_SET_IMG,0,0).setOrigin(0),i=t.createLayer(D.TILE_DECORATION_LAYER,D.TILE_MAP_TILE_SET_IMG,0,0).setOrigin(0),s=t.createLayer(D.TILE_OBSTACLE_LAYER,D.TILE_MAP_TILE_SET_IMG,0,0).setOrigin(0),a=t.createLayer(D.TILE_LANDMARKS_LAYER,D.TILE_MAP_ICON_SET_IMG,0,0).setOrigin(0),n=t.getObjectLayer(D.TILE_MAP_PLAYER_START_LAYER);return{map:t,layers:{ground:e,decoration:i,obstacle:s,landmarks:a,playerStarts:n}}}generateHighlightTiles(t){let e=t.map,i=t.layers.obstacle,s=Array(e.height).fill([]).map(t=>Array(e.width));e.forEachTile(t=>{let e=i.getTileAt(t.x,t.y)?o.DANGER:o.SUCCESS,a=new tc(this.scene,"tile_".concat(t.x,"_").concat(t.y),{x:t.pixelX,y:t.pixelY},{x:t.x,y:t.y},t.width,t.height,e);s[t.y][t.x]=a}),this.selectionTiles=s}loadLandmarks(t){let e={strongholds:[],outposts:[],resourceNodes:[]},i=new Map,s=new Map,a=new Map,n=t.layers.landmarks;return n.forEachTile(t=>{let n;let r=t.x,o=t.y,h=t.properties.name,c="".concat(r,"_").concat(o);switch(h){case"Stronghold":console.log("Stronghold at (".concat(r,",").concat(o,")")),n=new ta("stronghold_".concat(r,"_").concat(o),r,o,t),s.set(c,n),e.strongholds=[...e.strongholds,n];break;case"Rally Point":console.log("Rally Point at (".concat(r,",").concat(o,")")),n=new tn("rally_point_".concat(r,"_").concat(o),r,o,t),i.set(c,n);break;case"Outpost":console.log("Outpost at (".concat(r,",").concat(o,")")),n=new tr("outpost_".concat(r,"_").concat(o),r,o,t),e.outposts=[...e.outposts,n],s.set(c,n);break;case"Resource Node":console.log("Resource Node at (".concat(r,",").concat(o,")")),n=new to("resource_node_".concat(r,"_").concat(o),r,o,t),e.resourceNodes=[...e.resourceNodes,n];break;case"Interest Point":console.log("Interest Point at (".concat(r,",").concat(o,")")),n=new th("point_of_interest_".concat(r,"_").concat(o),r,o,t);break;case"Camp":console.log("Camp at (".concat(r,",").concat(o,")"))}n&&a.set(c,n)}),this.linkRalliesToParents(s,i),{landmarks:e,landmarkMap:a}}linkRalliesToParents(t,e){t.forEach(t=>{let i=[],s=e.get("".concat(t.x-1,"_").concat(t.y)),a=e.get("".concat(t.x-1,"_").concat(t.y-1)),n=e.get("".concat(t.x,"_").concat(t.y-1)),r=e.get("".concat(t.x+1,"_").concat(t.y-1)),o=e.get("".concat(t.x+1,"_").concat(t.y)),h=e.get("".concat(t.x+1,"_").concat(t.y+1)),c=e.get("".concat(t.x,"_").concat(t.y+1)),l=e.get("".concat(t.x-1,"_").concat(t.y+1));s&&(i=[...i,s]),a&&(i=[...i,a]),n&&(i=[...i,n]),r&&(i=[...i,r]),o&&(i=[...i,o]),h&&(i=[...i,h]),c&&(i=[...i,c]),l&&(i=[...i,l]),t.linkRallyPoints(i)})}assignInitialLandmarks(t,e){let i=t.layers.playerStarts,s=t.layers.landmarks;i.objects.forEach(t=>{let i=Math.floor(t.x/t.width),a=Math.floor(t.y/t.height),n=s.getTileAt(i,a),r=n.properties.name,o=this.playersInGame[Number(t.name)-1];if(o)switch(r){case"Stronghold":let h=e.strongholds.find(t=>t.x==i&&t.y==a);h&&(o.registerLandmark(h),h.capture(o));break;case"Outpost":let c=e.outposts.find(t=>t.x==i&&t.y==a);c&&(o.registerLandmark(c),c.capture(o));break;case"Resource Node":let l=e.resourceNodes.find(t=>t.x==i&&t.y==a);l&&(o.registerLandmark(l),l.capture(o))}})}showHighlightTiles(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.NONE;t.forEach(t=>{let a=this.selectionTiles[t.y][t.x];this.activeHighlightTiles=[...this.activeHighlightTiles,a];let n=this.units.get("".concat(t.x,"_").concat(t.y));!i&&n&&n!=this.movingUnit?a.show(o.DANGER,e,s):a.show(i,e,s)})}hideHighlightTiles(){var t;null===(t=this.activeHighlightTiles)||void 0===t||t.forEach(t=>{t.hide()}),this.activeHighlightTiles=[]}summonUnit(t,e,i){let s=new W(tm().toString(),t,e,i),a=s.getLocation();s.render(this.scene),e instanceof w?i.registerHero(s):i.registerUnit(s),this.units.set("".concat(a.x,"_").concat(a.y),s),e instanceof w?console.log("Summoned hero unit ".concat(s.getUnitData().name," with id ").concat(s.id," at location (").concat(a.x,",").concat(a.y,")")):console.log("Summoned ".concat(s.getUnitData().name," with id ").concat(s.id," at location (").concat(a.x,",").concat(a.y,")"))}update(){this.movingUnit&&this.movingUnit.update()}getTilesInRange(t,e,i){let s={x:this.tilemap.map.width-1,y:this.tilemap.map.height-1},a=this.tilemap.layers.obstacle,n=this.units,r=this.movingUnit,o=new Map;!function t(e,h){if(0===h||e.x<0||e.y<0||e.x>s.x||e.y>s.y||(o.set("".concat(e.x,"_").concat(e.y),e),!i&&a.getTileAt(e.x,e.y)))return;let c=n.get("".concat(e.x,"_").concat(e.y));(i||!c||c==r)&&(t({x:e.x-1,y:e.y},h-1),t({x:e.x,y:e.y-1},h-1),t({x:e.x+1,y:e.y},h-1),t({x:e.x,y:e.y+1},h-1))}(t,e+1);let h=Array.from(o.values());return h}attemptCaptureLandmark(t){let{x:e,y:i}=t.getLocation(),s=this.landmarks.get("".concat(e,"_").concat(i));null==s||!s.capturable||s instanceof tn||s.getOwner()==t.getOwner()||(s.updateCaptureTick(),0===s.getCaptureTicks()?N.emit(y.fieldEvent.CAPTURE_LANDMARK,t,s):console.log("".concat(s.id," will be captured by ").concat(t.getOwner().id," in ").concat(s.getCaptureTicks()," turns...")))}getUnitsInRange(t){}constructor(t,e){this.scene=t,this.playersInGame=e,this.playerIdToIndexMap=new Map,this.isDevicePlayerTurn=!1,e.forEach((t,e)=>{this.playerIdToIndexMap.set(t.id,e)});let i=this.generateMap();this.tilemap=i,this.generateHighlightTiles(i),this.activeHighlightTiles=[];let{landmarks:s,landmarkMap:a}=this.loadLandmarks(i);this.landmarks=a,this.units=new Map,this.assignInitialLandmarks(i,s);let n={mapData:i,units:this.units,landmarks:this.landmarks};this.scene.game.registry.set(v.field,n),this.handleEvents(),this.activePlayerIndex=0,e.forEach(t=>{let e=t.getStartingStronghold(),i=t.deck.getLeader();i&&this.summonUnit({x:null==e?void 0:e.x,y:e.y},i.data,t)})}}class tE{goToNextTurn(){this.activePlayerIndex==this.playersInGame.length-1&&(this.activePlayerIndex=-1,this.turn++),this.activePlayerIndex++,this.activePlayer=this.playersInGame[this.activePlayerIndex],N.emit(y.gameEvent.PLAYER_TURN,this.activePlayer.id,this.activePlayerIndex,this.activePlayer.isDevicePlayer)}pass(t){console.log("Player ".concat(t,"'s turn...")),console.log("Player ".concat(t," is not implemented, so will pass...")),N.emit(y.gameEvent.NEXT_TURN)}constructor(t,e,i){this.playersInGame=[...i],this.activePlayerIndex=-1,this.turn=1,N.on(y.gameEvent.NEXT_TURN,()=>{this.goToNextTurn()}).on(y.gameEvent.PLAYER_TURN,(e,i,s)=>{s||t.time.addEvent({delay:3e3,callback:()=>{this.pass(e)}})})}}class tT extends Phaser.Scene{preload(){}create(){let{player:t,playersInGame:e}=this.loadPlayers();this.game.scene.start(f.HUD),this.game.scene.start(f.TURN_TRANSITION),this.fieldManager=new tp(this,e),this.turnManager=new tE(this,t,e),this.combatHandler=new q;let i=this.game.registry.get(v.field).mapData.map,s=this.cameras.main;this.cameras.main.setBounds(0,0,i.widthInPixels+.2*i.widthInPixels,i.heightInPixels+m.height/3.125).setZoom(3.125).setOrigin(.5),function(t,e){t.on(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,t=>{t.isDown&&(e.scrollX-=(t.x-t.prevPosition.x)/e.zoom,e.scrollY-=(t.y-t.prevPosition.y)/e.zoom)})}(this.input,s)}loadPlayers(){let t=this.game.registry.get(v.player),e=this.game.registry.get(v.opponents);return{player:t,playersInGame:[t,...e]}}update(){this.started||(N.emit(y.gameEvent.NEXT_TURN),this.started=!0)}constructor(){super({key:f.GAMEPLAY}),this.started=!1}}class ty extends Phaser.GameObjects.Container{hide(){this.setVisible(!1)}show(){this.setVisible(!0)}constructor(t,e,i,s,a,n,r,o,h,c,l){super(t,s.x,s.y),this.name=e,this.bg=t.add.rectangle(0,0,a,n,r).setOrigin(0),this.display=t.add.text(a/2,n/2,i,{color:"#FFF",fontFamily:j.main,fontSize:32}).setOrigin(.5),this.add(this.bg),this.add(this.display),this.scene.add.existing(this),this.setInteractive(this.bg,Phaser.Geom.Rectangle.Contains).on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{o&&o()}).on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{h&&h()}).on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,()=>{c&&c()}).on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,()=>{l&&l()}),this.setScrollFactor(0),this.setDepth(1/0)}}let tv={width:.12*g.width,height:.2*g.height};class tf extends Phaser.GameObjects.Container{constructor(t,e){super(t,e.x,e.y),this.bg=t.add.rectangle(0,0,tv.width,tv.height,C.background).setOrigin(0);let i=t.add.image(.2*tv.width,.3*tv.height,D.DECK_COUNT).setOrigin(.5),s=t.add.text(.4*tv.width,.15*tv.height,"X 0",{fontSize:50}),a=t.add.image(.2*tv.width,.7*tv.height,D.DEATH_COUNT).setOrigin(.5),n=t.add.text(.4*tv.width,.55*tv.height,"X 0",{fontSize:50});this.add(this.bg),this.add(i),this.add(s),this.add(a),this.add(n),N.on(y.uiEvent.UPDATE_DECK_COUNTER,t=>{s.setText("X ".concat(t))}).on(y.uiEvent.UPDATE_CASUALTY_COUNTER,t=>{n.setText("X ".concat(t))})}}class tO extends Phaser.GameObjects.Container{render(t){t.forEach(t=>{let e=t.render(this.scene);this.add(e)})}constructor(t){super(t,0,0)}}let tA={width:.12*g.width,height:.4*g.height};class tS extends Phaser.GameObjects.Container{constructor(t,e){super(t,e.x,e.y),this.bg=t.add.rectangle(0,0,tA.width,tA.height,C.background).setOrigin(0);let i=t.add.text(.2*tA.width,.2*tA.height,"0",{fontSize:50}),s=t.add.line(0,.25*tA.height,.1*tA.height,.4*tA.height,.8*tA.width,-(.05*tA.height),16777215).setLineWidth(3).setOrigin(0),a=t.add.text(.55*tA.width,.5*tA.height,"0",{fontSize:50}),n=t.add.image(.3*tA.width,.8*tA.height,D.INCOME_RATE).setOrigin(.5),r=t.add.text(.5*tA.width,.8*tA.height,"X 0",{fontSize:20});this.add(this.bg),this.add(i),this.add(s),this.add(a),this.add(n),this.add(r),N.on(y.uiEvent.UPDATE_RESOURCE_DISPLAY,(t,e,s)=>{console.log("Update Display with ".concat(t,"/ ").concat(e)),i.setText(String(t)),a.setText(String(e)),s&&(console.log("Update Income Rate Display with ".concat(s)),r.setText("X ".concat(s)))})}}let tP={width:.05*m.width,height:.05*m.width},tw={width:.5*tP.width,height:.5*tP.height};class tR extends Phaser.GameObjects.Container{show(t){this.unitData=t.getUnitData(),this.image.setTexture(t.getGameObject().imageAssetName),this.unitNameText.setText(this.unitData.name),this.classIcon.setTexture(D.CLASS_ICONS,S(this.unitData.unitClass)),this.unitHPText.setText(String(this.unitData.currHp)),this.unitSPText.setText(String(this.unitData.currSp)),this.unitPwrText.setText(String(this.unitData.currPwr)),this.setVisible(!0)}update(){this.unitData&&(this.unitHPText.setText(String(this.unitData.currHp)),this.unitSPText.setText(String(this.unitData.currSp)),this.unitPwrText.setText(String(this.unitData.currPwr)),this.setVisible(!0))}hide(){this.setVisible(!1)}constructor(t){super(t,0,0);let e={fontFamily:j.main,fontSize:20},i={fontFamily:j.secondary,fontSize:20};this.image=t.add.sprite(.5*E.width,.5*E.height,D.UNDEFINED).setDisplaySize(E.width,E.height).setOrigin(.5);let s=t.add.container(.15*m.width,.7*m.height),a=t.add.image(0,0,D.HP_ICON).setDisplaySize(tP.width,tP.height).setOrigin(.5);this.unitHPText=t.add.text(0,0,"0",i).setFontSize(32).setOrigin(.5),s.add(a),s.add(this.unitHPText);let n=t.add.container(.25*m.width,.7*m.height),r=t.add.image(0,0,D.SP_ICON).setDisplaySize(tP.width,tP.height).setOrigin(.5);this.unitSPText=t.add.text(0,0,"0",i).setFontSize(32).setOrigin(.5),n.add(r),n.add(this.unitSPText);let o=t.add.container(.35*m.width,.7*m.height),h=t.add.image(0,0,D.PWR_ICON).setDisplaySize(tP.width,tP.height).setOrigin(.5);this.unitPwrText=t.add.text(0,0,"0",i).setFontSize(32).setOrigin(.5),o.add(h),o.add(this.unitPwrText),this.unitNameText=t.add.text(.15*m.width,.2*m.height,"unit name",e).setOrigin(0,.5);let c=t.add.container(.125*m.width,.2*m.height),l=t.add.rectangle(0,0,tw.width,tw.height,0).setStrokeStyle(2,16777215).setOrigin(.5);this.classIcon=t.add.sprite(0,0,D.CLASS_ICONS,A.SOLDIER).setDisplaySize(tw.width,tw.height).setOrigin(.5),c.add(l),c.add(this.classIcon),this.add(this.image),this.add(this.unitNameText),this.add(c),this.add(s),this.add(n),this.add(o)}}class t_{handleEvents(){N.on(y.gameEvent.PLAYER_TURN,(t,e,i)=>{this.hand.forEach(t=>{var e,s;i?null===(e=t.getGameObject())||void 0===e||e.setInteractive():null===(s=t.getGameObject())||void 0===s||s.disableInteractive()}),i&&this.drawCard()}).on(y.cardEvent.SELECT,t=>{this.returnCard(),this.selected=t,this.pullOutCard()}).on(y.cardEvent.CANCEL,()=>{this.selected&&(this.returnCard(),this.selected=void 0)}).on(y.cardEvent.PLAY,t=>{if(!this.selected){console.log("No card is selected...");return}this.playCard(t)})}getHand(){return[...this.hand]}playCard(t){if(!this.selected){console.log("No card is selected...");return}try{this.player.spendResources(this.selected.data.cost),this.selected.play(t),this.removeSelected()}catch(t){console.log(t.message)}finally{N.emit(y.cardEvent.CANCEL)}}drawCard(){let t=this.deck.length;if(0===t)return;let e=Math.floor(Math.random()*this.deck.length),i=this.deck.splice(e,1)[0];return i.setPosition({x:this.hand.length*p.width,y:0}),this.hand=[...this.hand,i],N.emit(y.uiEvent.UPDATE_HAND,this.getHand()),N.emit(y.uiEvent.UPDATE_DECK_COUNTER,this.deck.length),i}removeSelected(){this.hand=this.hand.filter(t=>t!==this.selected),this.selected.hide(),this.selected=void 0,this.repositionCardsInHand(),N.emit(y.uiEvent.UPDATE_HAND,this.hand)}repositionCardsInHand(){let t=0;this.hand.forEach(e=>{e.setPosition({x:t*p.width,y:0}),t++})}pullOutCard(){var t,e;this.selected&&this.changeSelectedCardPosition(null===(t=this.selected)||void 0===t?void 0:t.getPosition().x,(null===(e=this.selected)||void 0===e?void 0:e.getPosition().y)-.05*p.height)}returnCard(){var t;this.selected&&this.changeSelectedCardPosition(null===(t=this.selected)||void 0===t?void 0:t.getPosition().x,0)}changeSelectedCardPosition(t,e){if(!this.selected)return;let i=this.selected.getPosition();i.y!==e&&this.selected.setPosition({x:t,y:e})}constructor(t){this.player=t,this.deck=t.deck.getCards(),this.hand=[],this.handleEvents()}}let tC={width:200,height:50};class tN extends Phaser.Scene{preload(){}create(){let t=this.game.registry.get(v.player);this.player=t,this.bottomPanel=this.add.container(0,.8*g.height),this.rightPanel=this.add.container(.87*g.width,0),this.cardManager=new t_(t);let e=this.add.rectangle(0,0,m.width,m.height,C.background).setOrigin(0);this.bottomPanel.add(e);let i=new tO(this);this.add.existing(i),this.bottomPanel.add(i);let s=new ty(this,"cancelCardButton","Cancel",{x:.8*m.width,y:.5*m.height},tC.width,tC.height,C.cancel,()=>{null==s||s.bg.setFillStyle(C.cancelLight)},()=>{null==s||s.bg.setFillStyle(C.cancel),N.emit(y.cardEvent.CANCEL)});i.add(s),s.hide();let a=new ty(this,"endTurnButton","End Turn",{x:.8*m.width,y:.1*m.height},tC.width,tC.height,C.action,()=>{null==a||a.bg.setFillStyle(C.actionLight)},()=>{null==a||a.bg.setFillStyle(C.action),N.emit(y.gameEvent.NEXT_TURN)});i.add(a);let n=new tR(this);this.add.existing(n),this.bottomPanel.add(n);let r=new ty(this,"cancelUnitButton","Cancel",{x:.8*m.width,y:.5*m.height},tC.width,tC.height,C.cancel,()=>{null==s||s.bg.setFillStyle(C.cancelLight)},()=>{null==s||s.bg.setFillStyle(C.cancel),N.emit(y.unitEvent.CANCEL)});n.add(r);let o=new ty(this,"waitButton","Wait",{x:.8*m.width,y:.1*m.height},tC.width,tC.height,C.action,()=>{null==o||o.bg.setFillStyle(C.actionLight)},()=>{null==o||o.bg.setFillStyle(C.action),N.emit(y.unitEvent.WAIT)});n.add(o),n.hide(),this.resourceDisplay=new tS(this,{x:0,y:.39*g.height}),this.rightPanel.add(this.resourceDisplay),this.deckStatDisplay=new tf(this,{x:0,y:.15*g.height}),this.rightPanel.add(this.deckStatDisplay),N.on(y.cardEvent.SELECT,()=>{s.show(),this.isPlayerTurn&&a.hide()}).on(y.cardEvent.CANCEL,()=>{s.hide(),this.isPlayerTurn&&a.show()}).on(y.uiEvent.UPDATE_HAND,t=>{i.render(t)}).on(y.unitEvent.SELECT,t=>{N.emit(y.cardEvent.CANCEL),i.setVisible(!1),n.show(t),t.isActive()&&t.getOwner()==this.player?o.show():o.hide()}).on(y.uiEvent.UPDATE_UNIT_STAT_DISPLAY,()=>{n.update()}).on(y.unitEvent.CANCEL,()=>{i.setVisible(!0),n.hide()}).on(y.unitEvent.WAIT,()=>{i.setVisible(!0),n.hide()}).on(y.gameEvent.PLAYER_TURN,(t,e,i)=>{i&&(this.wake(),a.setVisible(!0))}).on(y.gameEvent.NEXT_TURN,()=>{this.sleep(),a.setVisible(!1)}),this.cardManager.drawCard(),this.cardManager.drawCard(),this.cardManager.drawCard()}sleep(){this.isPlayerTurn=!1}wake(){this.isPlayerTurn=!0}update(){}constructor(){super({key:f.HUD}),this.isPlayerTurn=!1}}class tL{constructor(t,e){this.id=t,this.name=e}}(r=c||(c={}))[r.STRONGHOLD=0]="STRONGHOLD",r[r.OUTPOST=1]="OUTPOST",r[r.RALLY_POINT=2]="RALLY_POINT",r[r.RESOURCE_NODE=3]="RESOURCE_NODE",r[r.POINT_OF_INTEREST=4]="POINT_OF_INTEREST",r[r.CAMP=5]="CAMP";class tx{setTeam(t){this.team=t}getTeam(){return this.team}registerLandmark(t){t.getOwner(),this.unregisterLandmark(t),t instanceof ta?this.landmarksOwned.strongholds.push(t):t instanceof tr?this.landmarksOwned.outposts.push(t):t instanceof to&&this.landmarksOwned.resourceNodes.push(t),(t instanceof ta||t instanceof tr)&&t.getRallyPoints().forEach(t=>{t.tile.tint=this.color,this.landmarksOwned.rallyPoints=[...this.landmarksOwned.rallyPoints,t]}),t.capture(this),t.tile.tint=this.color,console.log("".concat(t.id," has been captured by ").concat(this.playerInfo.name))}unregisterLandmark(t){let e=t.getOwner();if(e&&(console.log("Remove ".concat(t.id," from ").concat(t.getOwner().id,"'s ownership...")),t instanceof ta?e.landmarksOwned.strongholds=e.landmarksOwned.strongholds.filter(e=>e.id!=t.id):t instanceof tr?e.landmarksOwned.outposts=e.landmarksOwned.outposts.filter(e=>e.id!=t.id):t instanceof to&&(e.landmarksOwned.resourceNodes=e.landmarksOwned.resourceNodes.filter(e=>e.id!=t.id)),t instanceof ta||t instanceof tr)){var i;let s=t.getRallyPoints();e.landmarksOwned.rallyPoints=null===(i=e.landmarksOwned.rallyPoints)||void 0===i?void 0:i.filter(t=>!s.find(e=>e==t))}}registerUnit(t){this.activeUnits=[...this.activeUnits,t]}registerHero(t){t.card instanceof M||(this.activeChampions=[...this.activeChampions,t])}moveUnitToGraveyard(t){this.activeUnits=this.activeUnits.filter(e=>e!=t),this.graveyard.push(t)}getLandmarkAt(t,e){switch(t){case c.STRONGHOLD:return this.landmarksOwned.strongholds.find(t=>t.x==e.x&&t.y==e.y);case c.OUTPOST:return this.landmarksOwned.outposts.find(t=>t.x==e.x&&t.y==e.y);case c.RESOURCE_NODE:return this.landmarksOwned.resourceNodes.find(t=>t.x==e.x&&t.y==e.y)}}getStartingStronghold(){return this.landmarksOwned.strongholds[0]}getLandmarksOwned(){return this.landmarksOwned}getActiveUnits(){return[...this.activeUnits,...this.activeChampions]}getCasualties(){return this.graveyard.length}generateResources(t){let e=this.currResource+t;e>this.maxResource&&(e=this.maxResource),this.currResource=e,this.isDevicePlayer&&N.emit(y.uiEvent.UPDATE_RESOURCE_DISPLAY,this.currResource,this.maxResource,t)}spendResources(t){if(t>this.currResource)throw Error("Not enough resources");this.currResource-=t,this.isDevicePlayer&&N.emit(y.uiEvent.UPDATE_RESOURCE_DISPLAY,this.currResource,this.maxResource)}getResources(){return{current:this.currResource,max:this.maxResource}}constructor(t,e,i,s,a,n=!1){this.id=t,this.playerInfo=e,this.team=i,this.color=s,this.deck=a,this.isDevicePlayer=n,this.activeChampions=[],this.activeUnits=[],this.traps=[],this.landmarksOwned={strongholds:[],outposts:[],resourceNodes:[],rallyPoints:[]},this.graveyard=[],this.currResource=0,this.maxResource=2,N.on(y.gameEvent.PLAYER_TURN,(e,i)=>{e===t&&this.maxResource<10&&this.maxResource++}).on(y.playerEvent.GENERATE_RESOURCES,(e,i)=>{e===t&&this.generateResources(i)})}}let tD=Object.freeze({PLAYER1:196,PLAYER2:16711680,PLAYER3:48300,PLAYER4:16776960,NEUTRAL:0});function tU(t){switch(t){case 1:return tD.PLAYER1;case 2:return tD.PLAYER2;case 3:return tD.PLAYER3;case 4:return tD.PLAYER4;default:return tD.NEUTRAL}}let tb=Object.freeze({dealDamage:"deal-damage",heal:"heal",statChange:"stat-change",summon:"summon",drawCard:"draw-card"});class tI{static getSkillEffect(t,e){let i,s=[];switch(e.effectType){case tb.dealDamage:if(!e.amount||!e.valueType)break;i=new Q(e.name?e.name:t,e.amount,e.valueType,e.duration,e.overTime,e.isDelayed,e.isRemovable);break;case tb.heal:if(!e.amount||!e.valueType)break;i=new Z(e.name?e.name:t,e.amount,e.valueType,e.duration,e.overTime,e.isDelayed,e.isRemovable)}return i&&(s=[...s,i]),s}}class tk extends b{renderContents(){}constructor(t,e){super(t,e),this.renderContents()}}class tG extends G{play(t){switch(this.data.targetType){case _.ally:case _.enemy:case _.position:N.emit(y.fieldEvent.CAST_SPELL,this.skillEffects,t);break;default:N.emit(y.fieldEvent.CAST_SPELL,this.skillEffects)}}render(t){return this.gameObject||(this.gameObject=new tk(t,this)),this.gameObject}constructor(t,e,i){super(t,e,i),this.skillEffects=tI.getSkillEffect(this.data.name,e.effectData)}}class tM{getCards(){return this.cards}getLeader(){return this.leader}constructor(t,e){this.cards=t,this.leader=e}}class tH extends Phaser.Scene{preload(){this.load.image(D.TILE_SET,"./assets/maps/tilesets/tileset.png"),this.load.image(D.MAP_ICONS,"./assets/maps/tilesets/mapicons.png"),this.load.tilemapTiledJSON(D.TILE_MAP,"./assets/maps/testmap2.json"),this.load.image(D.UNDEFINED,"./assets/portraits/undefined.png"),this.load.image(D.HP_ICON,"./assets/icons/hp.png"),this.load.image(D.SP_ICON,"./assets/icons/sp.png"),this.load.image(D.PWR_ICON,"./assets/icons/pwr.png"),this.load.image(D.ATTACK_SELECTOR,"./assets/icons/attack.png"),this.load.image(D.SPELL_SELECTOR,"./assets/icons/spell.png"),this.load.image(D.INCOME_RATE,"./assets/icons/incomeRate.png"),this.load.image(D.DECK_COUNT,"./assets/icons/deckCount.png"),this.load.image(D.DEATH_COUNT,"./assets/icons/deathCount.png"),this.load.spritesheet(D.CLASS_ICONS,"./assets/icons/Class.png",{frameWidth:31,frameHeight:31}),this.load.image(D.YOUR_TURN,"./assets/ui/your_turn.png"),this.load.image(D.OPPONENT_TURN,"./assets/ui/opponent_turn.png")}create(){console.log("Now Loading...");let t=new tL(tm().toString(),"TestPlayer"),e=new tL(tm().toString(),"Enemy"),i=new H("0",new w("3","test_mage_hero",O.MAGE,20,30,3,0,2,2,"pwr +25% to mages",{name:"Magic Aura",targetType:_.none,effectType:tb.statChange,childEffects:[],amount:25,valueType:K.PERCENTAGE,stat:$.PWR,duration:-1,isRemovable:!1},"recover 2sp per turn",{name:"Meditate",targetType:_.none,effectType:tb.statChange,amount:25,valueType:K.VALUE,stat:$.SP,duration:-1,overTime:!0,isRemovable:!1},"deal 2 damage to targets (radius 1)",{name:"Magic Burst",targetType:_.enemy,effectType:tb.dealDamage,childEffects:[],amount:2,valueType:K.VALUE},[O.MAGE,O.MAGE,O.MAGE,O.MAGE],5),t),s=new H("0",new w("2","test_ranger_hero",O.RANGER,22,15,3,0,3,3,"pwr +25% to rangers",{name:"Precision Aura",targetType:_.none,effectType:tb.statChange,childEffects:[],amount:25,valueType:K.PERCENTAGE,stat:$.PWR,duration:-1,isRemovable:!1},"+20% pwr when target is 3 tiles away",{name:"Snipe",targetType:_.none,effectType:tb.statChange,childEffects:[],amount:25,valueType:K.PERCENTAGE,stat:$.PWR,duration:-1,isRemovable:!1},"move unit 2 tiles",{name:"Chase",targetType:_.none,effectType:tb.statChange,amount:0,valueType:K.PERCENTAGE,stat:$.PWR},[O.RANGER,O.RANGER,O.RANGER,O.ASSASSIN,O.ASSASSIN,O.SOLDIER],5),e),a=[new H("1",new w("1","test_soldier_hero",O.SOLDIER,30,10,5,5,3,1,"pwr +25% to all",{name:"Assault Aura",targetType:_.none,effectType:tb.statChange,childEffects:[],amount:25,valueType:K.PERCENTAGE,stat:$.PWR,duration:-1,isRemovable:!1},"+2 pwr to units 1 tile adjacent to this unit",{name:"Charisma",targetType:_.none,effectType:tb.statChange,childEffects:[],amount:2,valueType:K.VALUE,stat:$.PWR,duration:-1,isRemovable:!1},"deal 5 damage to target",{name:"Cleave",targetType:_.none,effectType:tb.dealDamage,amount:5,valueType:K.VALUE,stat:$.PWR},[O.SOLDIER,O.SOLDIER,O.SOLDIER,O.RANGER,O.RANGER,O.GUARDIAN],5),t),new M("2",new P("1","test_soldier",O.SOLDIER,10,0,1,1,3,1,1),t),new M("3",new P("1","test_soldier",O.SOLDIER,10,0,1,1,3,1,1),t),new M("4",new P("1","test_soldier",O.SOLDIER,10,0,1,1,3,1,1),t),new M("5",new P("3","test_ranger",O.RANGER,8,0,2,1,2,3,2),t),new M("6",new P("3","test_ranger",O.RANGER,8,0,2,1,2,3,2),t),new M("7",new P("6","test_guardian",O.GUARDIAN,15,0,1,1,1,1,3),t),new tG("8",new x("1","test_fire_spell",_.enemy,5,"Deal 1 burn damage per turn for 3 turns",{name:"Burn",targetType:_.enemy,effectType:tb.dealDamage,amount:1,valueType:K.VALUE,duration:3,overTime:!0,isRemovable:!0}),t),new tG("9",new x("2","test_heal_spell",_.ally,2,"Heal target by 10 hp",{name:"Heal",targetType:_.ally,effectType:tb.heal,amount:10,valueType:K.VALUE,isRemovable:!0}),t)],n=new tM(a,i),r=new tM([],s),o=new tx(1,t,1,tU(1),n,!0),h=new tx(2,e,2,tU(2),r);this.game.registry.set(v.player,o),this.game.registry.set(v.opponents,[h]),this.game.scene.start(f.GAMEPLAY)}update(){}}class tj extends Phaser.Scene{create(){let t=this.add.sprite(g.width/2,g.height/2,D.YOUR_TURN).setOrigin(.5);t.setVisible(!1);let e=this.tweens.add({targets:t,alpha:{from:0,to:1},scale:{from:2,to:2.2},ease:"Quartic.Out",duration:1200,repeat:0,yoyo:!0,persist:!0}),i=this.add.sprite(g.width/2,g.height/2,D.OPPONENT_TURN).setOrigin(.5);i.setVisible(!1);let s=this.tweens.add({targets:i,alpha:{from:0,to:1},scale:{from:2,to:2.2},ease:"Quartic.Out",duration:1200,repeat:0,yoyo:!0,persist:!0});N.on(y.gameEvent.PLAYER_TURN,(a,n,r)=>{r?(i.setVisible(!1),t.setVisible(!0),e.restart(),e.play()):(t.setVisible(!1),i.setVisible(!0),s.restart(),s.play())})}constructor(){super({key:f.TURN_TRANSITION})}}function tV(){let t=new(d()).Game(T);return t.scene.add(f.LOADING,tH,!1),t.scene.add(f.GAMEPLAY,tT,!1),t.scene.add(f.HUD,tN,!1),t.scene.add(f.TURN_TRANSITION,tj,!1),t.scene.start(f.LOADING),t}},8960:function(t){!function(){var e={229:function(t){var e,i,s,a=t.exports={};function n(){throw Error("setTimeout has not been defined")}function r(){throw Error("clearTimeout has not been defined")}function o(t){if(e===setTimeout)return setTimeout(t,0);if((e===n||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(i){try{return e.call(null,t,0)}catch(i){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:n}catch(t){e=n}try{i="function"==typeof clearTimeout?clearTimeout:r}catch(t){i=r}}();var h=[],c=!1,l=-1;function d(){c&&s&&(c=!1,s.length?h=s.concat(h):l=-1,h.length&&u())}function u(){if(!c){var t=o(d);c=!0;for(var e=h.length;e;){for(s=h,h=[];++l<e;)s&&s[l].run();l=-1,e=h.length}s=null,c=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===r||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function g(t,e){this.fun=t,this.array=e}function m(){}a.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];h.push(new g(t,e)),1!==h.length||c||o(u)},g.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(t){return[]},a.binding=function(t){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},i={};function s(t){var a=i[t];if(void 0!==a)return a.exports;var n=i[t]={exports:{}},r=!0;try{e[t](n,n.exports,s),r=!1}finally{r&&delete i[t]}return n.exports}s.ab="//";var a=s(229);t.exports=a}()}}]);