(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[34],{2601:function(t,e,i){"use strict";var s,a;t.exports=(null==(s=i.g.process)?void 0:s.env)&&"object"==typeof(null==(a=i.g.process)?void 0:a.env)?i.g.process:i(8960)},7676:function(t,e,i){"use strict";let s;i.r(e),i.d(e,{default:function(){return eP}});var a,n,r,h,o,c,l=i(6306),d=i.n(l);let u={width:32,height:32},g={width:1280,height:720},m={width:g.width,height:.2*g.height},p={width:.08*m.width,height:m.height},E={width:m.height,height:m.height},T={width:200,height:50},y={type:d().AUTO,scale:{mode:d().Scale.FIT,autoCenter:d().Scale.CENTER_BOTH,width:g.width,height:g.height},parent:"game",backgroundColor:0,physics:{default:"arcade",arcade:{}}},C=Object.freeze({playersInGame:"players-in-game",tilemapData:"tilemap-data",selectionGrid:"selection-grid",landmarksData:"landmarks-data",state:"game-state",field:"field"}),f=Object.freeze({GAMEPLAY:"GameplayScene",HUD:"HUD",LOADING:"Loading",TURN_TRANSITION:"TurnTransition"}),w=new Phaser.Events.EventEmitter,v={cardEvent:Object.freeze({DRAW:"draw-card",SELECT:"select-card",PLAY:"play-card",CANCEL:"cancel-card-select",SELECT_DISCARD:"select-discard",CONFIRM_DISCARD:"confirm-discard"}),uiEvent:Object.freeze({SHOW_ATTACK_SELECTOR:"show-attack-selector",HIDE_ATTACK_SELECTOR:"hide-attack-selector",SHOW_SPELL_SELECTOR:"show-spell-selector",HIDE_SPELL_SELECTOR:"hide-spell-selector",PLAY_FLOATING_TEXT:"play-floating-text",HANDLE_DISCARD:"handle-discard"}),gameEvent:Object.freeze({START_GAME:"start-game",PLAYER_TURN:"player-turn",NEXT_TURN:"next-turn"}),fieldEvent:Object.freeze({SUMMON_UNIT:"summon-unit",CAST_SPELL:"cast-spell",CAPTURE_LANDMARK:"capture-landmark",AREA_OF_EFFECT:"area-of-effect"}),unitEvent:Object.freeze({SELECT:"select-unit",CANCEL:"cancel-unit-select",ATTACK:"attack-unit",MOVE:"move-unit",WAIT:"wait-unit",DEATH:"unit-death"})};class S extends Phaser.Scene{preload(){}create(){let t=this.game.registry.get(C.tilemapData),e=t.map,i=this.cameras.main,s={x:1.3*e.widthInPixels,y:e.heightInPixels+m.height/3.125};this.cameras.main.setBounds(0,0,s.x,s.y).setZoom(3.125),function(t,e){t.on(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,t=>{t.isDown&&(e.scrollX-=(t.x-t.prevPosition.x)/e.zoom,e.scrollY-=(t.y-t.prevPosition.y)/e.zoom)})}(this.input,i),this.game.scene.start(f.HUD),this.game.scene.start(f.TURN_TRANSITION),w.emit(v.gameEvent.START_GAME)}update(){}constructor(){super({key:f.GAMEPLAY})}}let O=Object.freeze({turnController:"turn-controller",unitsController:"units-controller",selectionGridController:"selection-grid-controller",landmarksController:"landmarks-controller",cardController:"card-controller",effectsSystem:"effects-system",combatSystem:"combat-system",eventDispatcher:"event-dispatcher",mainController:"main-controller",handUIObject:"hand-ui",unitControlsPanel:"unit-controls-panel",unitStatDisplay:"unit-stat-display",endTurnButton:"end-turn-button",resourceDisplay:"resource-display",cardDetailsDisplay:"card-details-display",deckStatDisplay:"deck-stat-display",discardWindow:"discard-window",handUIController:"hand-ui-controller",unitCtrlPanelController:"unit-controls-panel-controller",unitStatDisplayController:"unit-stat-display-controller",endTurnButtonController:"end-turn-button-controller",resourceDisplayController:"resource-display-controller",cardDetailsDisplayController:"card-details-display-controller",deckStatDisplayController:"deck-stat-display-controller",discardWindowController:"discard-window-controller",uiController:"ui-controller"}),A=Object.freeze({actionLight:65520,action:119,cancelLight:11141120,cancel:7798784,background:1842204,damage:16711680,heal:65280,mana:5011175,buff:65520,white:16777215});class R extends Phaser.Scene{preload(){}create(){this.game.registry.get(O.turnController),this.bottomPanel=this.add.container(0,.8*g.height),this.rightPanel=this.add.container(.87*g.width,0);let t=this.add.rectangle(0,0,m.width,m.height,A.background).setOrigin(0);this.bottomPanel.add(t);let e=this.game.registry.get(O.handUIObject);this.bottomPanel.add(e);let i=this.game.registry.get(O.endTurnButton);this.bottomPanel.add(i);let s=this.game.registry.get(O.unitStatDisplay);this.bottomPanel.add(s);let a=this.game.registry.get(O.unitControlsPanel);s.add(a),s.hide();let n=this.game.registry.get(O.resourceDisplay);this.rightPanel.add(n);let r=this.game.registry.get(O.deckStatDisplay);this.rightPanel.add(r);let h=this.game.registry.get(O.cardDetailsDisplay);this.add.existing(h);let o=this.game.registry.get(O.discardWindow);this.add.existing(o)}constructor(){super({key:f.HUD})}}let P=Object.freeze({TILE_SET:"tile-set",MAP_ICONS:"map-icons",TILE_MAP:"map",TILE_GROUND_LAYER:"Ground",TILE_DECORATION_LAYER:"Decoration",TILE_OBSTACLE_LAYER:"Obstacles",TILE_LANDMARKS_LAYER:"Landmarks",TILE_MAP_PLAYER_START_LAYER:"PlayerStart",TILE_MAP_TILE_SET_IMG:"tileset",TILE_MAP_ICON_SET_IMG:"mapicons",CLASS_ICONS:"class-icons",HP_ICON:"hp-icon",SP_ICON:"sp-icon",PWR_ICON:"pwr-icon",DEF_ICON:"def-icon",DECK_COUNT:"deck-count",DEATH_COUNT:"death-count",INCOME_RATE:"income-rate",ATTACK_SELECTOR:"attack-selector",SPELL_SELECTOR:"spell-selector",UNDEFINED:"undefined",PORTRAIT:"portrait_",YOUR_TURN:"your-turn",OPPONENT_TURN:"opponent-turn"}),D=Object.freeze({PLAYER1:196,PLAYER2:16711680,PLAYER3:48300,PLAYER4:16776960,NEUTRAL:0});function L(t){switch(t){case 1:return D.PLAYER1;case 2:return D.PLAYER2;case 3:return D.PLAYER3;case 4:return D.PLAYER4;default:return D.NEUTRAL}}class _{constructor(t,e){this.id=t,this.name=e}}let x=new _("12345","TestPlayer"),N=new _("67890".toString(),"Enemy"),I=Object.freeze({unit:"unit",hero:"hero",spell:"spell"}),b=Object.freeze({unit:"unit",hero:"hero"}),k=Object.freeze({SOLDIER:"Soldier",BERSERKER:"Berserker",GUARDIAN:"Guardian",RANGER:"Ranger",ASSASSIN:"Assassin",MAGE:"Mage",LANCER:"Lancer",TOWER:"Tower"}),U=Object.freeze({SOLDIER:1,BERSERKER:3,RANGER:4,ASSASSIN:5,GUARDIAN:6,TOWER:7,MAGE:9,LANCER:13});function G(t){switch(t){case k.SOLDIER:return U.SOLDIER;case k.GUARDIAN:return U.GUARDIAN;case k.RANGER:return U.RANGER;case k.MAGE:return U.MAGE;case k.LANCER:return U.LANCER;case k.TOWER:return U.TOWER;case k.BERSERKER:return U.BERSERKER;case k.ASSASSIN:return U.ASSASSIN;default:return U.SOLDIER}}let M={name:"test_mage_hero",unitType:b.hero,unitClass:k.MAGE,stats:{hp:20,sp:30,pwr:3,def:0,mvt:2,rng:2}},B={name:"test_mage_hero",unitType:b.hero,unitClass:k.SOLDIER,stats:{hp:30,sp:10,pwr:5,def:0,mvt:3,rng:1}},H={name:"test_ranger_hero",unitType:b.hero,unitClass:k.RANGER,stats:{hp:22,sp:15,pwr:3,def:0,mvt:2,rng:3}},F=(b.hero,k.ASSASSIN,{name:"test_soldier",unitType:b.unit,unitClass:k.SOLDIER,stats:{hp:10,sp:0,pwr:1,def:0,mvt:3,rng:1}}),z={name:"test_ranger",unitType:b.unit,unitClass:k.RANGER,stats:{hp:8,sp:0,pwr:2,def:0,mvt:2,rng:3}},j={name:"test_guardian",unitType:b.unit,unitClass:k.GUARDIAN,stats:{hp:15,sp:0,pwr:1,def:1,mvt:1,rng:1}},V=Object.freeze({none:"none",ally:"ally",enemy:"enemy",unit:"unit",position:"position",all:"all",rallyPoint:"rally"}),Y=Object.freeze({onCast:"onCast",onRemove:"onRemove",onTurnStart:"onTurnStart",onTurnEnd:"onTurnEnd",onAttack:"onAttack",onReceiveHit:"onReceiveHit",onKill:"onKill",onDeath:"onDeath"}),W=Object.freeze({VALUE:"value",PERCENTAGE:"percentage"}),K=Object.freeze({healthChange:"health-change",statChange:"stat-change",summon:"summon",drawCard:"draw-card"}),X=[{name:"Fireball",description:"Deal 2 damage to a target",targetType:V.enemy,trigger:Y.onCast,components:[{type:K.healthChange,amount:-2,valueType:W.VALUE}],isRemovable:!0},{name:"Burn",description:"Deals 1 damage per turn for 3 turns",targetType:V.enemy,duration:3,trigger:Y.onTurnStart,components:[{type:K.healthChange,amount:-1,valueType:W.VALUE}],isRemovable:!0}],J=[{name:"Healing Light",description:"Restore 5hp to the target",targetType:V.ally,trigger:Y.onCast,components:[{type:K.healthChange,amount:5,valueType:W.VALUE}],isRemovable:!0}],Q=[{name:"Magic Bomb",description:"Deal 2 damage to enemies within 1 tile at a target location",targetType:V.position,trigger:Y.onCast,creates:[{name:"Explode",description:"Deal 2 damage to the target",targetType:V.enemy,trigger:Y.onCast,components:[{type:K.healthChange,amount:-2,valueType:W.VALUE}],isRemovable:!0}],range:1,isRemovable:!0}],Z=[{name:"Nature's Blessing",description:"Restore 2hp to allies within 2 tiles at a target location",targetType:V.position,trigger:Y.onCast,creates:[{name:"Nature's Blessing",description:"Restore 2hp to the target",targetType:V.ally,trigger:Y.onCast,components:[{type:K.healthChange,amount:2,valueType:W.VALUE}],isRemovable:!0}],range:2,isRemovable:!0}];V.position,Y.onCast,K.summon,b.unit,k.SOLDIER,V.enemy,Y.onCast,K.healthChange,W.VALUE,V.position,Y.onCast,V.enemy,Y.onCast,K.healthChange,W.VALUE,V.ally,Y.onCast,K.healthChange,W.VALUE;let q={id:"3",name:"test_mage_hero",cardType:I.hero,cost:5,contents:{...M},owner:x,followers:[k.MAGE,k.MAGE,k.MAGE,k.MAGE]},$={id:"1",name:"test_soldier_hero",cardType:I.hero,cost:5,contents:{...B},owner:x,followers:[k.SOLDIER,k.SOLDIER,k.SOLDIER,k.RANGER,k.RANGER,k.GUARDIAN]},tt={id:"2",name:"test_ranger_hero",cardType:I.hero,cost:5,contents:{...H},owner:N,followers:[k.RANGER,k.RANGER,k.RANGER,k.ASSASSIN,k.ASSASSIN,k.SOLDIER]};I.hero,k.ASSASSIN,k.ASSASSIN,k.ASSASSIN,k.RANGER,k.RANGER,k.SOLDIER;let te={id:"1",name:"test_soldier",cardType:I.unit,cost:1,contents:{...F},owner:x},ti={id:"3",name:"test_ranger",cardType:I.unit,cost:2,contents:{...z},owner:x},ts={id:"6",name:"test_guardian",cardType:I.unit,cost:3,contents:{...j},owner:x},ta={id:"1",name:"Fireball",cardType:I.spell,cost:5,contents:[...X],owner:x},tn={id:"2",name:"Healing Light",cardType:I.spell,cost:2,contents:[...J],owner:x},tr={id:"3",name:"Magic Bomb",cardType:I.spell,cost:5,contents:[...Q],owner:x},th={id:"4",name:"Nature's Blessing",cardType:I.spell,cost:5,contents:[...Z],owner:x};class to{linkGameObject(t){this.gameObject=t}setOwner(t){this.owner=t}getGameObject(){return this.gameObject}getUnit(){return this.unit}getEffects(){return this.effects}getOwner(){return this.owner}constructor(t,e,i,s,a,n,r,h=V.rallyPoint){this.id=t,this.name=e,this.cardType=i,this.cost=s,this.effects=n?[...n]:void 0,this.description=a||(n?n[0].description:void 0),this.unit=r||void 0,this.targetType=h}}class tc{moveTo(t){this.destination=t;let e={x:t.x*u.width,y:t.y*u.height};this.unit.getGameObject().setPosition(e.x,e.y)}confirm(){this.destination&&(this.position=this.destination,this.destination=void 0),this.unit.setActive(!1)}set(t){this.position=t;let e={x:t.x*u.width,y:t.y*u.height};this.unit.getGameObject().setPosition(e.x,e.y)}get(){return this.position}cancel(){this.destination=void 0,this.unit.getGameObject().setPosition(this.position.x*u.width,this.position.y*u.height)}constructor(t,e){this.unit=t,this.position=e}}class tl{changeHealth(t){this.unit.getCurrentStats().hp+t<this.unit.base.hp?this.unit.getCurrentStats().hp+=t:this.unit.getCurrentStats().hp=this.unit.base.hp;let e=this.unit.getGameObject();t>0?(console.log("".concat(this.unit.name," heals ").concat(t," hp!")),e.updateHpText(),e.floatingText.play("".concat(t),A.heal)):(console.log("".concat(this.unit.name," takes ").concat(t," damage!")),e.updateHpText(),e.floatingText.play("".concat(t),A.damage)),this.unit.getGameObject().updatePwrText(),this.unit.getCurrentStats().hp<=0&&this.killUnit()}killUnit(){var t;console.log("".concat(this.unit.id," has been slain...")),this.unit.setActive(!1),null===(t=this.unit.getGameObject())||void 0===t||t.setVisible(!1);let e=this.unit.getOwner();e&&(e.units.moveUnitToGraveyard(this.unit),w.emit(v.unitEvent.DEATH,this.unit))}constructor(t){this.unit=t}}class td{applyInstant(t){t.setTarget(this.unit),t.apply()}insertToTriggerList(t,e){let i=this.getList(t);e.setTarget(this.unit),i.push(e)}applyOnTrigger(t){let e=[],i=this.getList(t);i.forEach((t,i)=>{console.log("Apply ".concat(t.name," onto ").concat(this.unit.name,"!")),t.isActive()&&t.apply(),t.isActive()||e.push(i)}),this.clearInactive(t,e)}getList(t){let e=this.effects.get(t);if(!e)throw Error("No such effect trigger named ".concat(t,"..."));return e}clearInactive(t,e){e.forEach(e=>{this.effects.get(t).splice(e,1)})}constructor(t){this.unit=t,this.effects=new Map,this.effects.set(Y.onTurnStart,[]),this.effects.set(Y.onTurnEnd,[])}}class tu{setStun(t){this.stunned=t}isStunned(){return this.stunned}setSleep(t){this.sleeping=t}isSleeping(){return this.sleeping}setFreeze(t){this.frozen=t}isFrozen(){return this.frozen}setRush(t){this.rush=t}isRush(){return this.rush}constructor(t){this.unit=t,this.frozen=!1,this.sleeping=!1,this.stunned=!1,this.rush=!1}}class tg{getCurrentStats(){return this.current}getStatus(){return this.status}getEffects(){return this.effects}setOwner(t){this.owner=t}getOwner(){return this.owner}linkGameObject(t){this.gameObject=t,this.positionController=new tc(this,{x:-10,y:-10})}getGameObject(){return this.gameObject}position(){return this.positionController}setActive(t){var e;this.active=t,null===(e=this.gameObject)||void 0===e||e.updateActive()}isActive(){return this.active}constructor(t,e,i,s,a,n,r){this.id=t,this.name=e,this.cardId=i,this.unitClass=s,this.unitType=a,this.base={...n},this.effects=[...r],this.current={...n},this.active=!1,this.status=new tu(this),this.combat=new tl(this),this.effectHandler=new td(this)}}class tm{getComponents(){return this.components}getComponentsByType(t){return this.components.filter(e=>e.type===t)}apply(){var t,e,i;console.log("Applied ".concat(this.name," onto ").concat(this.target instanceof tg?null===(t=this.target)||void 0===t?void 0:t.name:"".concat(null===(e=this.target)||void 0===e?void 0:e.x,",").concat(null===(i=this.target)||void 0===i?void 0:i.y),"...")),this.components.forEach(t=>{t.apply(this.target)}),!(this.duration<=0)&&(this.currTime++,this.currTime<this.duration||(console.log("".concat(this.name," has ended...")),this.forceRemove()))}createSubEffect(){return tC.createEffects(this.creates)}setTarget(t){this.target=t,this.components.forEach(t=>{t.setActive(!0)}),this.active=!0}getTarget(){return this.target}setActive(t){this.active=t}isActive(){return this.active}remove(){this.isRemovable&&this.forceRemove()}forceRemove(){this.components.forEach(t=>{t.remove()}),this.reset()}reset(){this.currTime=0,this.target=void 0,this.active=!1}constructor(t,e){this.name=t.name,this.description=t.description,this.targetType=t.targetType,this.duration=t.duration?t.duration:0,this.trigger=t.trigger,this.components=e,this.creates=t.creates?t.creates:[],this.range=t.range?t.range:0,this.isRemovable=t.isRemovable,this.active=!1,this.currTime=0}}class tp{remove(){this.active=!1}setActive(t){this.active=t}isActive(){return this.active}constructor(t,e,i=W.VALUE,s,a){this.type=t,this.amount=e,this.valueType=i,this.stat=s,this.unit=a,this.active=!1}}class tE extends tp{apply(t){if(!this.active)return;let e=t.getCurrentStats().hp,i=this.valueType===W.VALUE?this.amount:Math.ceil(e*(this.amount/100));t.combat.changeHealth(i),t.getCurrentStats().hp>0||t.combat.killUnit()}constructor(t,e=W.VALUE){super(K.healthChange,t,e),this.amount=t,this.valueType=e}}let tT=Object.freeze({HP:"hp",SP:"sp",PWR:"pwr",DEF:"def",MVT:"mvt",RNG:"rng"});class ty extends tp{apply(t){if(this.active)switch(this.target=t,this.stat){case tT.PWR:this.delta=this.valueType===W.VALUE?this.amount:Math.floor(t.base.pwr*this.amount/100),t.getCurrentStats().pwr+=this.delta,t.getGameObject().updatePwrText();break;case tT.DEF:this.delta=this.valueType===W.VALUE?this.amount:Math.floor(t.base.def*this.amount/100),t.getCurrentStats().def+=this.delta;break;case tT.MVT:this.delta=this.valueType===W.VALUE?this.amount:Math.floor(t.base.mvt*this.amount/100),t.getCurrentStats().mvt+=this.delta;break;case tT.RNG:this.delta=this.valueType===W.VALUE?this.amount:Math.floor(t.base.rng*this.amount/100),t.getCurrentStats().rng+=this.delta}}remove(){if(this.target){switch(this.stat){case tT.PWR:this.target.getCurrentStats().pwr-=this.delta,this.target.getGameObject().updatePwrText();break;case tT.DEF:this.target.getCurrentStats().def-=this.delta;break;case tT.MVT:this.target.getCurrentStats().mvt-=this.delta;break;case tT.RNG:this.target.getCurrentStats().rng-=this.delta}this.active=!1}}constructor(t,e,i=W.VALUE){super(K.statChange,e,i,t),this.stat=t,this.amount=e,this.valueType=i,this.delta=0}}class tC{static createEffects(t){let e=[];return t.forEach(t=>{let i=this.createEffectComponents(t.components),s=new tm(t,i);e.push(s)}),e}static createEffectComponents(t){if(!t)return[];let e=[];return t.forEach(t=>{let i;let s=t.stat,a=t.amount,n=t.valueType;switch(t.type){case K.healthChange:if(!a)return;i=new tE(a,n);break;case K.statChange:if(!s||!a)return;i=new ty(s,a,n)}i&&e.push(i)}),e}}let tf="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var tw={randomUUID:tf};let tv=new Uint8Array(16),tS=[];for(let t=0;t<256;++t)tS.push((t+256).toString(16).slice(1));var tO=function(t,e,i){if(tw.randomUUID&&!e&&!t)return tw.randomUUID();t=t||{};let a=t.random||(t.rng||function(){if(!s&&!(s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(tv)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e){i=i||0;for(let t=0;t<16;++t)e[i+t]=a[t];return e}return function(t,e=0){return tS[t[e+0]]+tS[t[e+1]]+tS[t[e+2]]+tS[t[e+3]]+"-"+tS[t[e+4]]+tS[t[e+5]]+"-"+tS[t[e+6]]+tS[t[e+7]]+"-"+tS[t[e+8]]+tS[t[e+9]]+"-"+tS[t[e+10]]+tS[t[e+11]]+tS[t[e+12]]+tS[t[e+13]]+tS[t[e+14]]+tS[t[e+15]]}(a)};class tA{static createUnit(t,e){let i=e.effects?tC.createEffects(e.effects):[],s=new tg(tO().toString(),e.name,t.id,e.unitClass,e.unitType,e.stats,i);return s}}class tR{static createCard(t){let e;if((t.cardType===I.hero||t.cardType===I.unit)&&t.contents){let i=t.contents,s=tA.createUnit(t,i);e=new to(t.id,t.name,t.cardType,t.cost,t.description,void 0,s)}else{let i=t.contents,s=tC.createEffects(i);e=new to(t.id,t.name,t.cardType,t.cost,t.description,s,void 0,s[0].targetType)}return e}}class tP{getCards(){return this.cards}getLeader(){return this.leader}constructor(t,e){this.cards=t,this.leader=e}}(a=h||(h={}))[a.STRONGHOLD=0]="STRONGHOLD",a[a.OUTPOST=1]="OUTPOST",a[a.RALLY_POINT=2]="RALLY_POINT",a[a.RESOURCE_NODE=3]="RESOURCE_NODE",a[a.POINT_OF_INTEREST=4]="POINT_OF_INTEREST",a[a.CAMP=5]="CAMP";let tD=Object.freeze({MAX_HAND_SIZE:9,MAX_SPELL_RANGE:2,RESOURCE_LIMIT:10,LANDMARK_CAPTURE_TURNS:3});class tL{generate(t){let e=this.currResource+t;e>this.maxResource&&(e=this.maxResource),this.currResource=e}increaseMax(){this.maxResource<tD.RESOURCE_LIMIT&&this.maxResource++}spend(t){if(t>this.currResource)throw Error("Not enough resources");this.currResource-=t}get(){return{current:this.currResource,max:this.maxResource}}calculateIncome(){return 2*this.player.landmarks.get(h.STRONGHOLD).length+this.player.landmarks.get(h.OUTPOST).length+this.player.landmarks.get(h.RESOURCE_NODE).length}constructor(t){this.player=t,this.currResource=0,this.maxResource=1}}class t_{register(t){t.unitType===b.hero?this.activeChampions=[...this.activeChampions,t]:this.activeUnits=[...this.activeUnits,t]}getAllActiveUnits(){return[...this.activeUnits,...this.activeChampions]}getActiveChampions(){return[...this.activeChampions]}getCasualties(){return this.graveyard.length}moveUnitToGraveyard(t){t.unitType===b.unit?this.activeUnits=this.activeUnits.filter(e=>e!=t):this.activeChampions=this.activeChampions.filter(e=>e!=t),this.graveyard.push(t)}selectUnit(t){this.selected=t}deselectUnit(){this.selected=void 0}getSelected(){return this.selected}constructor(t){this.player=t,this.activeUnits=[],this.activeChampions=[],this.graveyard=[]}}class tx{registerLandmark(t){var e;if(!t.capturable)throw Error("".concat(t.id," cannot be owned by any players..."));null===(e=this.landmarks.get(t.type))||void 0===e||e.push(t),console.log("".concat(t.id," has been captured by ").concat(this.player.name)),t.capturable.getLinkedLandmarks().forEach(t=>{var e;t.capturable&&(null===(e=this.landmarks.get(t.type))||void 0===e||e.push(t))})}unregisterLandmark(t){if(!t.capturable)throw Error("".concat(t.id," cannot be owned by any players..."));let e=this.landmarks.get(t.type);e=null==e?void 0:e.filter(e=>e==t),this.landmarks.set(t.type,e);let i=t.capturable.getLinkedLandmarks();i.forEach(t=>{if(!t.capturable)return;let e=this.landmarks.get(t.type).filter(e=>e.id==t.id);this.landmarks.set(t.type,e)})}getStartingStronghold(){return this.landmarks.get(h.STRONGHOLD)[0]}get(t){return this.landmarks.get(t)}constructor(t){this.player=t,this.landmarks=new Map,this.landmarks.set(h.STRONGHOLD,[]),this.landmarks.set(h.OUTPOST,[]),this.landmarks.set(h.RALLY_POINT,[]),this.landmarks.set(h.RESOURCE_NODE,[])}}class tN{drawCard(){let t=this.deck.length;if(0===t)return;let e=Math.floor(Math.random()*this.deck.length),i=this.deck.splice(e,1)[0];if(this.hand.length>=tD.MAX_HAND_SIZE){i.cardType===I.hero?(console.log("Maximum hand size reached! You've drawn a hero. Please discard a card from your hand."),w.emit(v.uiEvent.HANDLE_DISCARD,i)):console.log("Maximum hand size reached! Card ".concat(i.name," was discarded..."));return}return this.insertCardToHand(i),i}insertCardToHand(t){this.hand.push(t)}removeCardFromHand(t){let e=this.getIndexInHand(t);this.hand=this.hand.toSpliced(e,1)}handleDiscard(t,e){this.removeCardFromHand(e),this.insertCardToHand(t)}getHand(){return this.hand}getLeader(){return this.deckLeader}getDeckCount(){return this.deck.length}getIndexInHand(t){let e=this.hand.findIndex(e=>e===t);if(-1===e)throw Error("".concat(t.name," was not in the player's hand!"));return e}selectCard(t){this.getIndexInHand(t),this.selected=t}deselectCard(){this.selected=void 0}getSelected(){return this.selected}constructor(t,e){this.player=t,this.hand=[],this.deck=e.getCards(),this.deckLeader=e.getLeader()}}class tI{setTeam(t){this.team=t}getTeam(){return this.team}constructor(t,e,i,s,a,n=!1){this.id=t,this.name=e.name,this.color=i,this.team=s,this.isDevicePlayer=n,this.resources=new tL(this),this.units=new t_(this),this.landmarks=new tx(this),this.cards=new tN(this,a),a.getCards().forEach(t=>{t.setOwner(this)}),a.getLeader().setOwner(this)}}class tb{setOwner(t){this.owner=t}getOwner(){return this.owner}linkRallyPoints(t){t.forEach(t=>{if(t.type!==h.RALLY_POINT)throw Error("Failed to link rally point;".concat(t.id," is not a rally point."));this.linkedLandmarks.push(t)})}getLinkedLandmarks(){return this.linkedLandmarks}attemptCapture(){if(!this.directCapture)return!1;let t=this.landmark.occupant;if(!t)return!1;let e=t.getOwner();return!!e&&e!=this.owner&&((this.captureTick++,this.captureTick<tD.LANDMARK_CAPTURE_TURNS)?(console.log("".concat(t.name," has attempted to capture ").concat(this.landmark.id,". \n                ").concat(tD.LANDMARK_CAPTURE_TURNS-this.captureTick," turns until capture...")),!1):(this.capture(e),!0))}capture(t){this.setOwner(t),this.landmark.tile.tint=t.color,this.linkedLandmarks.forEach(e=>{e.capturable.capture(t)})}resetCapture(){if(!this.directCapture)return!1;this.captureTick=0}constructor(t,e=!0){this.landmark=t,this.captureTick=0,this.linkedLandmarks=[],this.directCapture=e}}class tk{getEffects(){return this.effects}constructor(t){let e;switch(this.landmark=t,t.type){case h.STRONGHOLD:e=[{name:"Stronghold's Advantage",description:"+2 PWR/DEF",targetType:"ally",duration:-1,trigger:"onCast",components:[{type:"stat-change",amount:2,valueType:"value",stat:"pwr"},{type:"stat-change",amount:2,valueType:"value",stat:"def"}],isRemovable:!1},{name:"Rest",description:"Recover 2hp at the start of each turn",targetType:"ally",duration:-1,trigger:"onTurnStart",components:[{type:"health-change",amount:2,valueType:"value"}],isRemovable:!1}],this.effects=tC.createEffects(e);break;case h.OUTPOST:e=[{name:"Outpost's Advantage",description:"+1 PWR/DEF",targetType:"ally",duration:-1,trigger:"onCast",components:[{type:"stat-change",amount:1,valueType:"value",stat:"pwr"},{type:"stat-change",amount:1,valueType:"value",stat:"def"}],isRemovable:!1},{name:"Rest",description:"Recover 1hp at the start of each turn",targetType:"ally",duration:-1,trigger:"onTurnStart",components:[{type:"health-change",amount:1,valueType:"value"}],isRemovable:!1}],this.effects=tC.createEffects(e);break;default:this.effects=[]}}}class tU{constructor(t,e,i,s,a,n=!0){this.id=t,this.type=e,this.position=i,this.tile=s,this.capturable=a?new tb(this,n):void 0,[h.STRONGHOLD,h.OUTPOST,h.CAMP].includes(e)&&(this.effects=new tk(this))}}class tG extends Phaser.GameObjects.Rectangle{show(){this.setVisible(!0)}hide(){this.setVisible(!1)}setColor(t){super.setFillStyle(t,.25),this.setStrokeStyle(1,t)}disable(){this.disableInteractive()}constructor(t,e,i){super(t,e.x*u.width,e.y*u.height,u.width,u.height,i,.25),this.position=e,this.setOrigin(0).setStrokeStyle(1,i).setName("".concat(e.x,"_").concat(e.y)),this.hide(),this.scene.add.existing(this)}}let tM=Object.freeze({none:0,success:65520,warning:16776960,danger:16711680});function tB(t){switch(t){case 0:return tM.success;case 1:return tM.warning;case 2:return tM.danger;default:return tM.none}}(n=o||(o={}))[n.SUCCESS=0]="SUCCESS",n[n.WARNING=1]="WARNING",n[n.DANGER=2]="DANGER",(r=c||(c={}))[r.NONE=0]="NONE",r[r.PLAY_CARD=1]="PLAY_CARD",r[r.MOVE_UNIT=2]="MOVE_UNIT";class tH{show(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.initStatus,e=tB(t);this.tile.setColor(e),this.tile.show(),t!==o.SUCCESS?this.tile.disable():this.tile.setInteractive()}hide(){this.tile.hide(),this.reset()}reset(){let t=tB(this.initStatus);this.tile.setColor(t),this.tileSelectionType=c.NONE}handleClick(){this.tileSelectionType!==c.NONE&&w.emit(this.tileSelectionType===c.PLAY_CARD?v.cardEvent.PLAY:v.unitEvent.MOVE,this.tile.position)}setSelectionType(t){this.tileSelectionType=t}constructor(t,e){this.id="".concat(t.position.x,"_").concat(t.position.y),this.tile=t,this.tileSelectionType=c.NONE,this.initStatus=e,this.tile.setInteractive().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{this.handleClick()})}}class tF{static generateMap(t){let e=t.make.tilemap({key:P.TILE_MAP});e.addTilesetImage(P.TILE_MAP_TILE_SET_IMG,P.TILE_SET),e.addTilesetImage(P.TILE_MAP_ICON_SET_IMG,P.MAP_ICONS);let i=e.createLayer(P.TILE_GROUND_LAYER,P.TILE_MAP_TILE_SET_IMG,0,0).setOrigin(0),s=e.createLayer(P.TILE_DECORATION_LAYER,P.TILE_MAP_TILE_SET_IMG,0,0).setOrigin(0),a=e.createLayer(P.TILE_OBSTACLE_LAYER,P.TILE_MAP_TILE_SET_IMG,0,0).setOrigin(0),n=e.createLayer(P.TILE_LANDMARKS_LAYER,P.TILE_MAP_ICON_SET_IMG,0,0).setOrigin(0),r=e.getObjectLayer(P.TILE_MAP_PLAYER_START_LAYER);return{map:e,layers:{ground:i,decoration:s,obstacle:a,landmarks:n,playerStarts:r}}}static loadLandmarks(t){let e=new Map;e.set(h.STRONGHOLD,[]),e.set(h.RALLY_POINT,[]),e.set(h.OUTPOST,[]),e.set(h.RESOURCE_NODE,[]);let i=new Map,s=new Map,a=new Map,n=t.layers.landmarks;return n.forEachTile(t=>{let n;let r=t.x,o=t.y,c={x:r,y:o},l=t.properties.name,d="".concat(r,"_").concat(o);switch(l){case"Stronghold":n=new tU("stronghold_".concat(d),h.STRONGHOLD,c,t,!0),s.set(d,n),e.get(h.STRONGHOLD).push(n);break;case"Rally Point":n=new tU("rally_point_".concat(d),h.RALLY_POINT,c,t,!0,!1),i.set(d,n);break;case"Outpost":n=new tU("outpost_".concat(d),h.OUTPOST,c,t,!0),s.set(d,n),e.get(h.OUTPOST).push(n);break;case"Resource Node":n=new tU("resource_node_".concat(d),h.RESOURCE_NODE,c,t,!0),e.get(h.RESOURCE_NODE).push(n);break;case"Interest Point":n=new tU("point_of_interest_".concat(d),h.POINT_OF_INTEREST,c,t,!0)}n&&a.set(d,n)}),this.linkRalliesToParents(s,i),{byType:e,byLocation:a}}static linkRalliesToParents(t,e){t.forEach(t=>{var i;let s=[],a=e.get("".concat(t.tile.x-1,"_").concat(t.tile.y)),n=e.get("".concat(t.tile.x-1,"_").concat(t.tile.y-1)),r=e.get("".concat(t.tile.x,"_").concat(t.tile.y-1)),h=e.get("".concat(t.tile.x+1,"_").concat(t.tile.y-1)),o=e.get("".concat(t.tile.x+1,"_").concat(t.tile.y)),c=e.get("".concat(t.tile.x+1,"_").concat(t.tile.y+1)),l=e.get("".concat(t.tile.x,"_").concat(t.tile.y+1)),d=e.get("".concat(t.tile.x-1,"_").concat(t.tile.y+1));a&&(s=[...s,a]),n&&(s=[...s,n]),r&&(s=[...s,r]),h&&(s=[...s,h]),o&&(s=[...s,o]),c&&(s=[...s,c]),l&&(s=[...s,l]),d&&(s=[...s,d]),null===(i=t.capturable)||void 0===i||i.linkRallyPoints(s)})}static assignInitialLandmarks(t,e,i){let s=t.layers.playerStarts,a=t.layers.landmarks;s.objects.forEach(t=>{let s=Math.floor(t.x/t.width),n=Math.floor(t.y/t.height),r=a.getTileAt(s,n),o=r.properties.name,c=i[Number(t.name)-1];if(c)switch(o){case"Stronghold":let l=e.get(h.STRONGHOLD).find(t=>t.position.x==s&&t.position.y==n);l&&(c.landmarks.registerLandmark(l),l.capturable.capture(c));break;case"Outpost":let d=e.get(h.OUTPOST).find(t=>t.position.x==s&&t.position.y==n);d&&(c.landmarks.registerLandmark(d),d.capturable.capture(c));break;case"Resource Node":let u=e.get(h.RESOURCE_NODE).find(t=>t.position.x==s&&t.position.y==n);u&&(c.landmarks.registerLandmark(u),u.capturable.capture(c))}})}static generateSelectionGrid(t,e){let i=e.map,s=e.layers.obstacle,a=Array(i.height).fill([]).map(t=>Array(i.width));return i.forEachTile(e=>{let i=s.getTileAt(e.x,e.y)?o.DANGER:o.SUCCESS,n=new tG(t,{x:e.x,y:e.y},tB(i)),r=new tH(n,i);a[e.y][e.x]=r}),a}static spawnDeckLeaders(t,e,i,s){e.forEach(e=>{let a=e.cards.getLeader();if(!a)throw Error("".concat(e.name," does not have a leader..."));let n=e.landmarks.getStartingStronghold(),r=n.position,h=i.summonUnitByCard(t,a,r);s.enterLandmark(n,h),console.log("Summoned ".concat(h.name," at (").concat(r.x,",").concat(r.y,")"))})}}class tz{handleEvents(){this.handleGameEvents(),this.handleCardEvents(),this.handleUnitEvents(),this.handleUIEvents()}handleGameEvents(){w.on(v.gameEvent.START_GAME,()=>{this.main.startGame()}).on(v.gameEvent.NEXT_TURN,()=>{this.main.endTurn(),this.ui.handleEndTurn()}).on(v.gameEvent.PLAYER_TURN,t=>{this.main.startTurn(t),this.ui.handlePlayerTurn(t)})}handleCardEvents(){w.on(v.cardEvent.DRAW,t=>{this.ui.handleDrawCard(t)}).on(v.cardEvent.SELECT,t=>{this.main.selectCard(t),this.ui.handleSelectCard(t)}).on(v.cardEvent.CANCEL,()=>{this.main.cancelCard(),this.ui.handleCancelCard()}).on(v.cardEvent.PLAY,t=>{try{this.main.playCard(t),this.ui.handlePlayCard()}catch(t){return console.log(t.message),!1}})}handleUnitEvents(){w.on(v.unitEvent.SELECT,t=>{this.main.selectUnit(t),this.ui.handleSelectUnit(this.main.getActivePlayer(),t)}).on(v.unitEvent.MOVE,t=>{this.main.moveUnitTo(t)}).on(v.unitEvent.WAIT,()=>{this.main.waitUnit(),this.ui.handleDeselectUnit()}).on(v.unitEvent.CANCEL,()=>{this.main.cancelUnitMove(),this.ui.handleDeselectUnit()}).on(v.unitEvent.ATTACK,t=>{this.main.attackUnit(t),this.ui.handleDeselectUnit()}).on(v.unitEvent.DEATH,t=>{this.main.killUnit(t),this.ui.handleKillUnit(t)})}handleUIEvents(){w.on(v.uiEvent.HANDLE_DISCARD,t=>{this.ui.setDiscardMode(t)}).on(v.cardEvent.SELECT_DISCARD,t=>{this.ui.handleSelectDiscard(t)}).on(v.cardEvent.CONFIRM_DISCARD,(t,e)=>{this.main.confirmDiscard(t,e),this.ui.handleConfirmDiscard(t,e)})}constructor(t,e,i){this.main=e,this.ui=i,this.handleEvents()}}function tj(t,e,i){return -1===i||Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<=i}function tV(t,e,i,s){let a={x:t.mapData.map.width-1,y:t.mapData.map.height-1},n=t.mapData.layers.obstacle,r=t.units,h=new Map;!function t(i,o){if(0===o||i.x<0||i.y<0||i.x>a.x||i.y>a.y||(h.set("".concat(i.x,"_").concat(i.y),i),!s&&n.getTileAt(i.x,i.y)))return;let c=r.get("".concat(i.x,"_").concat(i.y));(s||!c||i===e)&&(t({x:i.x-1,y:i.y},o-1),t({x:i.x,y:i.y-1},o-1),t({x:i.x+1,y:i.y},o-1),t({x:i.x,y:i.y+1},o-1))}(e,i+1);let o=Array.from(h.values());return o}class tY{cast(t,e,i){e.forEach(e=>{if(e.targetType===V.position||i instanceof tg)e.targetType===V.position&&(i instanceof tg?this.castPosition(t,e,i.position().get()):this.castPosition(t,e,i));else throw Error("Attempted to cast an effect meant for units on a location...");this.castSingleUnit(t,e,i)})}castSingleUnit(t,e,i){var s,a;(e.targetType!==V.ally||(null===(s=i.getOwner())||void 0===s?void 0:s.getTeam())===t.getTeam())&&(e.targetType!==V.enemy||(null===(a=i.getOwner())||void 0===a?void 0:a.getTeam())!==t.getTeam())&&(e.trigger===Y.onTurnStart?i.effectHandler.insertToTriggerList(Y.onTurnStart,e):i.effectHandler.applyInstant(e))}castPosition(t,e,i){let s=function(t,e,i){if(-1===i){let e=Array.from(t.units.values());return e}let s={x:t.mapData.map.width-1,y:t.mapData.map.height-1},a=t.units,n=[];return!function t(e,i){if(0===i||e.x<0||e.y<0||e.x>s.x||e.y>s.y)return;let r=a.get("".concat(e.x,"_").concat(e.y));r&&n.push(r),t({x:e.x-1,y:e.y},i-1),t({x:e.x,y:e.y-1},i-1),t({x:e.x+1,y:e.y},i-1),t({x:e.x,y:e.y+1},i-1)}(e,i+1),n}(this.field,i,e.range);s.forEach(i=>{let s=e.createSubEffect();this.cast(t,s,i)})}forceRemove(t){t.forceRemove()}constructor(t,e){this.field=t,this.passives=new Map,e.forEach(t=>{this.passives.set(t.id,[])})}}class tW{transferLandmark(t,e){if(!t.capturable)throw Error("Landmark cannot be captured...");let i=t.capturable.getOwner();i&&(null==i||i.landmarks.unregisterLandmark(t)),e.landmarks.registerLandmark(t),t.capturable.setOwner(e),t.tile.tint=e.color}getLandmarkAt(t){return this.field.landmarksByLocation.get("".concat(t.x,"_").concat(t.y))}enterLandmark(t,e){var i,s;if(t.occupant=e,e.getOwner()!==(null===(i=t.capturable)||void 0===i?void 0:i.getOwner()))return;let a=null===(s=t.effects)||void 0===s?void 0:s.getEffects();a&&e.getOwner()&&this.effectSystem.cast(e.getOwner(),a,e)}leaveLandmark(t){var e;let i=null===(e=t.effects)||void 0===e?void 0:e.getEffects();i&&i.forEach(t=>{this.effectSystem.forceRemove(t)}),this.resetLandmark(t),t.occupant=void 0}resetLandmark(t){t.capturable&&t.capturable.resetCapture()}updateLandmarks(t){let e=this.field.landmarksByLocation;e.forEach(e=>{var i;let s=e.occupant;if(!s)return;let a=s.getOwner();if(!a||s.getOwner()!==t)return;let n=null===(i=e.capturable)||void 0===i?void 0:i.attemptCapture();n&&(this.transferLandmark(e,a),this.leaveLandmark(e),this.enterLandmark(e,s))})}constructor(t,e){this.field=t,this.effectSystem=e}}class tK{showRallyPoints(t){let e=t.landmarks.get(h.RALLY_POINT);e.forEach(t=>{let e=t.position,i=this.selectionGrid[e.y][e.x],s=this.units.getUnitByPosition(e);this.activeTiles.push(i),i.setSelectionType(c.PLAY_CARD),i.show(s?o.DANGER:o.SUCCESS)})}showMoves(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=this.units.getUnitByPosition(t);if(!s)throw Error("Selected unit was not found...");let a=tV(this.field,t,e,i);a.forEach(t=>{let e=this.selectionGrid[t.y][t.x],i=this.units.getUnitByPosition(t);this.activeTiles.push(e),e.setSelectionType(c.MOVE_UNIT),i&&s!==i?e.show(o.DANGER):e.show()})}showAttackRange(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.WARNING,s=this.units.getUnitByPosition(t);if(!s)throw Error("Selected unit was not found...");let a=tV(this.field,t,e,!0);a.forEach(t=>{let e=this.selectionGrid[t.y][t.x];this.activeTiles.push(e),e.show(i)})}showSpellRange(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.NONE,i=t.units.getActiveChampions(),s=[];i.forEach(t=>{var e;let i=null===(e=t.position())||void 0===e?void 0:e.get();if(!i)throw Error("".concat(t.name," does not have a position controller initialized..."));s.push(...tV(this.field,i,tD.MAX_SPELL_RANGE,!0))}),s.forEach(t=>{let i=this.selectionGrid[t.y][t.x];this.activeTiles.push(i),i.setSelectionType(e),i.show(e===c.PLAY_CARD?o.SUCCESS:o.WARNING)})}hide(){var t;null===(t=this.activeTiles)||void 0===t||t.forEach(t=>{t.hide()}),this.activeTiles=[]}constructor(t,e){this.field=t,this.activeTiles=[],this.selectionGrid=t.selectionGrid,this.units=e}}function tX(t,e,i,s,a,n){let r="".concat(P.PORTRAIT).concat(i,"_").concat(s);t.load.image(r,"./assets/portraits/".concat(i,"/").concat(s,".png")),t.load.once(Phaser.Loader.Events.COMPLETE,()=>{null==e||e.setTexture(r).setOrigin(.5).setDisplaySize(a,n)}),t.load.start()}class tJ{constructor(t,e){let i=e.getCard(),s=i.getUnit();if(!s)throw Error("No unit was linked to ".concat(i.name,"..."));let a=s.getCurrentStats(),n=t.add.image(p.width-1,p.height,P.HP_ICON).setDisplaySize(.2*p.height,.2*p.height).setOrigin(1);e.add(n);let r=t.add.text(p.width-1,p.height,String(a.hp),{color:"#FFF",fontFamily:'"Sansita",sans-serif',fontSize:24}).setOrigin(1);e.add(r);let h=t.add.image(1,p.height-.2*p.height,P.PWR_ICON).setDisplaySize(.2*p.height,.2*p.height).setOrigin(0);e.add(h);let o=t.add.text(.1*p.width,p.height,String(a.pwr),{color:"#FFF",fontFamily:'"Sansita",sans-serif',fontSize:24}).setOrigin(0,1);e.add(o);let c=t.add.image(p.width-1,0,P.CLASS_ICONS,G(s.unitClass)).setOrigin(1,0);e.add(c)}}class tQ extends Phaser.GameObjects.Container{renderCardBase(t){let e=this.card.cardType,i=this.scene.add.rectangle(0,0,p.width,p.height,0).setOrigin(0,0).setStrokeStyle(1,0);this.add(i);let s=this.scene.add.sprite(.5*p.width,.5*p.height,P.UNDEFINED).setDisplaySize(.98*p.width,.98*p.height).setOrigin(.5);this.add(s),tX(t,s,e,this.card.id,.98*p.width,.98*p.height);let a=this.scene.add.circle(0,0,.15*p.width,14277081).setStrokeStyle(1,0).setOrigin(0);this.add(a);let n=this.scene.add.text(.09*p.width,.025*p.width,String(this.card.cost),{color:"#000",fontFamily:'"Sansita",sans-serif',fontSize:24}).setOrigin(0);this.add(n),this.stats=this.card.cardType===I.spell?void 0:new tJ(t,this)}getCard(){return this.card}getStats(){return this.stats}getPosition(){return{x:this.x,y:this.y}}updateActive(){}getAsContainer(){return this}pullOut(){let t={x:this.x,y:this.y-.1*p.height};this.setPosition(t.x,t.y)}return(){let t={x:this.x,y:this.y+.1*p.height};this.setPosition(t.x,t.y)}constructor(t,e,i){super(t,i.x,i.y),this.card=e,this.renderCardBase(t)}}let tZ=Object.freeze({main:'"Noto Sans",sans-serif',secondary:'"Sansita",sans-serif'});class tq extends Phaser.GameObjects.Text{play(t,e){this.setText(t);let i=Phaser.Display.Color.IntegerToRGB(e);this.setColor(Phaser.Display.Color.RGBToString(i.r,i.g,i.b)),this.setVisible(!0),this.animation.restart(),this.animation.play()}constructor(t){super(t,0,0,"",{fontFamily:tZ.main,fontSize:16}),this.animation=t.tweens.add({targets:this,alpha:{from:1,to:.5},y:{from:.5*u.height,to:-(.5*u.height)},ease:"Linear.None",duration:1e3,repeat:0,yoyo:!1,persist:!0,onComplete:()=>{this.setVisible(!1)}})}}class t$ extends Phaser.GameObjects.Container{show(t){this.attacker=t,this.setVisible(!0)}hide(){this.setVisible(!1),this.attacker=void 0}constructor(t,e){super(t,0,0),this.unit=e;let i=t.add.rectangle(0,0,u.width,u.height).setOrigin(0);this.add(i);let s=t.add.image(0,0,P.ATTACK_SELECTOR).setOrigin(0);this.add(s),this.setInteractive(i,Phaser.Geom.Rectangle.Contains).on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{this.attacker&&w.emit(v.unitEvent.ATTACK,e)}),this.hide(),w.on(v.uiEvent.SHOW_ATTACK_SELECTOR,(t,e)=>{var i;let s=e||(null===(i=t.position())||void 0===i?void 0:i.get()),a=this.unit.position().get(),n=t.getCurrentStats().rng;s&&a&&t.getOwner()!==this.unit.getOwner()&&tj(s,a,n)&&this.show(t)}).on(v.uiEvent.HIDE_ATTACK_SELECTOR,()=>{this.hide()})}}class t0 extends Phaser.GameObjects.Container{show(t){this.selector.tint=t,this.setVisible(!0)}hide(){this.setVisible(!1)}constructor(t,e){super(t,0,0),this.unit=e;let i=t.add.rectangle(0,0,u.width,u.height).setOrigin(0);this.add(i),this.selector=t.add.image(0,0,P.SPELL_SELECTOR).setOrigin(0),this.add(this.selector),this.setInteractive(i,Phaser.Geom.Rectangle.Contains).on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{w.emit(v.cardEvent.PLAY,this.unit)}),this.hide(),w.on(v.uiEvent.SHOW_SPELL_SELECTOR,(t,e)=>{if(e===V.none||e===V.ally&&t!==this.unit.getOwner()||e===V.enemy&&t===this.unit.getOwner())return;let i=t.units.getActiveChampions(),s=this.unit.position().get(),a=!1;i.forEach(t=>{var e;let i=null===(e=t.position())||void 0===e?void 0:e.get();if(!i)throw Error("".concat(t.name," does not have a position controller initialized..."));tj(i,s,tD.MAX_SPELL_RANGE)&&(a=!0)}),a&&this.show(this.unit.getOwner()===t?tM.success:tM.danger)}).on(v.uiEvent.HIDE_SPELL_SELECTOR,()=>{this.hide()})}}class t1 extends Phaser.GameObjects.Container{getPosition(){return{x:this.x,y:this.y}}getImage(){return this.image}updateHpText(){this.hpText.setText(String(this.unit.getCurrentStats().hp))}updatePwrText(){let t=this.unit.getCurrentStats().pwr,e=this.unit.base.pwr;this.pwrText.setText(String(t));let i=t<e?A.damage:t>e?A.buff:A.white,s=Phaser.Display.Color.IntegerToRGB(i);this.pwrText.setColor(Phaser.Display.Color.RGBToString(s.r,s.g,s.b))}updateActive(){this.getImage().setAlpha(this.unit.isActive()?1:.7)}getAsContainer(){return this}constructor(t,e){super(t,-u.width,-u.height),this.unit=e;let i=e.unitType,s=e.getOwner().color;this.imageAssetName="".concat(P.PORTRAIT).concat(i,"_").concat(e.cardId);let a=t.add.rectangle(u.width/2,u.height/2,.95*u.width,.95*u.height,s).setOrigin(.5);this.add(a),this.image=t.add.sprite(.5*u.width,.5*u.height,this.imageAssetName).setOrigin(.5).setDisplaySize(.85*u.width,.85*u.height),t.textures.exists(this.imageAssetName)||tX(t,this.image,i,e.cardId,.85*u.width,.85*u.height),this.add(this.image),e.isActive()?this.image.setAlpha(1):this.image.setAlpha(.7);let n=t.add.image(u.width,0,P.CLASS_ICONS,G(e.unitClass)).setDisplaySize(.3*u.width,.3*u.height).setOrigin(1,0);this.add(n);let r=this.scene.add.image(u.width-1,.95*u.height,P.HP_ICON).setDisplaySize(.3*u.height,.3*u.height).setOrigin(1);this.add(r),this.hpText=this.scene.add.text(u.width-1,.95*u.height,String(e.getCurrentStats().hp),{fontFamily:tZ.secondary,fontSize:8,resolution:3.125}).setOrigin(1),this.add(this.hpText);let h=this.scene.add.image(1,.95*u.height-.3*u.height,P.PWR_ICON).setDisplaySize(.3*u.height,.3*u.height).setOrigin(0);if(this.add(h),this.pwrText=this.scene.add.text(.1*u.width,.95*u.height,String(e.getCurrentStats().pwr),{fontFamily:tZ.secondary,fontSize:8,resolution:3.125}).setOrigin(0,1),this.add(this.pwrText),i===b.hero){var o,c;let e=t.add.rectangle(u.width/2,u.height/2,u.width,u.height,s).setOrigin(.5);this.add(e),null===(o=e.preFX)||void 0===o||o.addGlow(void 0,void 0,void 0,!0),null===(c=e.postFX)||void 0===c||c.addGlow(void 0,void 0,void 0,!0),t.tweens.add({targets:e,alpha:{from:0,to:.1},scale:{from:1,to:1.1},ease:"Quartic.Out",duration:2e3,repeat:-1,yoyo:!0,persist:!0})}this.attackSelector=new t$(t,e),this.add(this.attackSelector),this.spellSelector=new t0(t,e),this.add(this.spellSelector),this.floatingText=new tq(t).setOrigin(.5).setPosition(u.width/2,u.height/2),this.add(this.floatingText),this.setInteractive(new Phaser.Geom.Rectangle(.05*u.width,.05*u.height,u.width,u.height),Phaser.Geom.Rectangle.Contains).on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{w.emit(v.unitEvent.SELECT,e)}),this.scene.add.existing(this)}}class t2{static createCardGO(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};return new tQ(t,e,i)}static createUnitGO(t,e){return new t1(t,e)}}class t5{summonUnitByCard(t,e,i){let s=e.getUnit();if(!s)throw Error("Cannot summon a unit with the card ".concat(e.name,"; no unit was initialized..."));let a=e.getOwner();if(!a)throw Error("Cannot summon a unit with the card ".concat(e.name,"; card has no owner..."));s.setOwner(a);let n=t2.createUnitGO(t,s);return s.linkGameObject(n),this.getPositionController(s).set(i),this.field.units.set("".concat(i.x,"_").concat(i.y),s),a.units.register(s),s}selectUnit(t,e){t.units.selectUnit(e)}cancelMove(t){let e=t.units.getSelected();if(!e)return;let i=this.getPositionController(e);i.cancel(),t.units.deselectUnit()}moveTo(t,e){var i;null===(i=t.position())||void 0===i||i.moveTo(e)}confirmMove(t,e){let i=t.units.getSelected();if(!i)throw Error("No unit was selected...");if(e!==i)throw Error("Unit provided is not the selected unit...");let s=this.getPositionController(i),a=s.get();this.field.units.delete("".concat(a.x,"_").concat(a.y)),s.confirm();let n=i.position().get();this.field.units.set("".concat(n.x,"_").concat(n.y),i),t.units.deselectUnit()}removeUnit(t){let e=this.getPosition(t);this.field.units.delete("".concat(e.x,"_").concat(e.y))}getPosition(t){let e=this.getPositionController(t);return e.get()}getUnitByPosition(t){return this.field.units.get("".concat(t.x,"_").concat(t.y))}getSelected(t){return t.units.getSelected()}getPositionController(t){let e=t.position();if(!e)throw Error("".concat(t.name,"'s does not have a position controller..."));return e}constructor(t){this.field=t}}class t3{endTurn(){this.gameState.goToNextPlayer()}getActivePlayer(){return this.gameState.getActivePlayer()}getPlayersInGame(){return this.gameState.playersInGame}isDevicePlayerTurn(){return this.getActivePlayer().isDevicePlayer}getDevicePlayer(){let t=this.gameState.getDevicePlayer();if(!t)throw Error("Device player not found...");return t}pass(t){console.log("Player ".concat(t,"'s turn...")),console.log("Player ".concat(t," is not implemented, so will pass...")),w.emit(v.gameEvent.NEXT_TURN)}getTurnNumber(){return this.gameState.getTurnNumber()}constructor(t){this.gameState=t}}class t6{constructor(t,e,i,s){this.game=t,this.mapData=e,this.landmarksByLocation=i,this.landmarksByType=new Map,this.units=new Map,this.selectionGrid=s}}class t7{goToNextPlayer(){this.activePlayerIndex==this.playersInGame.length-1&&this.goToNextTurn(),this.activePlayerIndex++;let t=this.playersInGame[this.activePlayerIndex];w.emit(v.gameEvent.PLAYER_TURN,t)}goToNextTurn(){this.activePlayerIndex=-1,this.turn++}getActivePlayer(){return this.playersInGame[this.activePlayerIndex]}getPlayers(){return this.playersInGame}getTurnNumber(){return this.turn}getDevicePlayer(){return this.playersInGame.find(t=>t.isDevicePlayer)}constructor(t){this.playersInGame=t,this.activePlayerIndex=-1,this.turn=1}}class t8{drawCard(t){let e=this.cardManagers.get(t.id);if(!e)throw Error("".concat(t.name," does not have a card manager..."));let i=e.drawCard();t.isDevicePlayer&&i&&w.emit(v.cardEvent.DRAW,i)}removeCard(t,e){this.cardManagers.get(t.id).removeCardFromHand(e)}getHand(t){return this.cardManagers.get(t.id).getHand()}selectCard(t,e){this.cardManagers.get(t.id).selectCard(e)}deselectCard(t){this.cardManagers.get(t.id).deselectCard()}handleDiscard(t,e,i){this.cardManagers.get(t.id).handleDiscard(e,i)}getSelectedCard(t){return this.cardManagers.get(t.id).getSelected()}constructor(t){this.cardManagers=new Map,t.forEach(t=>this.cardManagers.set(t.id,t.cards))}}class t9 extends Phaser.GameObjects.Container{hide(){this.setVisible(!1)}show(){this.setVisible(!0)}constructor(t,e,i,s,a,n,r,h,o,c,l){super(t,s.x,s.y),this.name=e,this.bg=t.add.rectangle(0,0,a,n,r).setOrigin(0),this.display=t.add.text(a/2,n/2,i,{color:"#FFF",fontFamily:tZ.main,fontSize:32}).setOrigin(.5),this.add(this.bg),this.add(this.display),this.scene.add.existing(this),this.setInteractive(this.bg,Phaser.Geom.Rectangle.Contains).on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{h&&h()}).on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{o&&o()}).on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,()=>{c&&c()}).on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,()=>{l&&l()}),this.setScrollFactor(0),this.setDepth(1/0)}}class t4 extends Phaser.GameObjects.Container{insertCard(t,e){let i=t2.createCardGO(this.scene,t,{x:(e.length-1)*p.width*1.05,y:0});t.linkGameObject(i),i.setInteractive(new Phaser.Geom.Rectangle(0,0,p.width,p.height),Phaser.Geom.Rectangle.Contains).on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{w.emit(this.discardMode?v.cardEvent.SELECT_DISCARD:v.cardEvent.SELECT,t)}),this.cardContainer.add(i)}removeCard(t,e){let i=e.getGameObject();if(!i)throw Error("".concat(e.name," does not have a game object defined..."));this.cardContainer.remove(i),this.repositionHand(t),i.setVisible(!1),i.setPosition(-100,-100)}repositionHand(t){t.forEach((t,e)=>{let i=t.getGameObject();i&&i.setPosition(e*p.width*1.05,0)})}showCancelButton(){this.cancelCardButton.show()}hideCancelButton(){this.cancelCardButton.hide()}setDiscardMode(t){this.discardMode=t}getDiscardMode(){return this.discardMode}constructor(t){super(t,0,0),this.discardMode=!1,this.cardContainer=t.add.container(0,0),this.cancelCardButton=new t9(t,"cancelCardButton","Cancel",{x:.8*m.width,y:.5*m.height},T.width,T.height,A.cancel,()=>{var t;null===(t=this.cancelCardButton)||void 0===t||t.bg.setFillStyle(A.cancelLight)},()=>{var t;null===(t=this.cancelCardButton)||void 0===t||t.bg.setFillStyle(A.cancel),w.emit(v.cardEvent.CANCEL)}),this.add(this.cardContainer),this.add(this.cancelCardButton),this.cancelCardButton.hide()}}class et{select(t){this.selected&&this.selected.getGameObject().return();let e=t.getGameObject();if(!e)throw Error("Failed to update card game object; no game object was found for ".concat(t.name));this.selected=t,e.pullOut(),this.ui.showCancelButton()}cancel(){this.selected&&(this.selected.getGameObject().return(),this.selected=void 0,this.ui.hideCancelButton())}drawCard(t){let e=this.cards.getHand();this.ui.insertCard(t,e)}handlePlayCard(){this.selected&&(this.ui.removeCard(this.cards.getHand(),this.selected),this.cancel())}setDiscardMode(t){this.ui.setDiscardMode(t)}getDiscardMode(){return this.ui.getDiscardMode()}hide(){this.ui.setVisible(!1)}show(){this.ui.setVisible(!0)}handleConfirmDiscard(t,e){this.ui.removeCard(this.cards.getHand(),e),this.drawCard(t)}constructor(t,e){this.ui=t,this.cards=e.cards}}class ee{handleDrawCard(t){this.hand.drawCard(t)}handlePlayerTurn(t){if(!t.isDevicePlayer)return;let{current:e,max:i}=t.resources.get(),s=t.resources.calculateIncome();this.resources.setCurrent(e),this.resources.setMax(i),this.resources.setIncome(s),this.deckStats.setDeckCount(t.cards.getDeckCount()),this.discardMode||this.endTurn.show()}handleEndTurn(){this.handleDeselectUnit(),this.turn.getActivePlayer().isDevicePlayer||this.endTurn.hide()}handleSelectCard(t){this.turn.isDevicePlayerTurn()&&(this.cardDetails.hide(),this.handleDeselectUnit(),this.hand.select(t),this.cardDetails.show(t),this.endTurn.hide())}handleCancelCard(){this.turn.isDevicePlayerTurn()&&(this.hand.cancel(),this.cardDetails.hide(),this.endTurn.show())}handleSelectUnit(t,e){!this.discardMode&&(this.handleCancelCard(),this.handleDeselectUnit(),this.hand.hide(),this.endTurn.hide(),this.unitStats.show(e),this.unitControls.show(),e.isActive()&&e.getOwner()===t&&e.getOwner().isDevicePlayer&&this.unitControls.showWaitButton())}handleDeselectUnit(){this.unitControls.hide(),this.unitStats.hide(),this.hand.show(),this.turn.getActivePlayer().isDevicePlayer&&(this.discardMode||this.endTurn.show())}handlePlayCard(){if(!this.turn.isDevicePlayerTurn())return;let t=this.turn.getActivePlayer(),{current:e}=t.resources.get();this.cardDetails.hide(),this.hand.handlePlayCard(),this.endTurn.show(),this.resources.setCurrent(e)}handleKillUnit(t){let e=t.getOwner();if(!e)throw Error("".concat(t.name," does not have an owner..."));console.log("Owner of ".concat(t.name,": ").concat(e.name)),e.isDevicePlayer&&this.deckStats.setDeathCount(e.units.getCasualties())}setDiscardMode(t){this.discardMode=!0,this.discard.show(t),this.hand.setDiscardMode(!0)}handleSelectDiscard(t){this.discard.setCardToDiscard(t)}handleConfirmDiscard(t,e){this.discardMode=!1,this.discard.hide(),this.hand.setDiscardMode(!1),this.hand.handleConfirmDiscard(t,e)}constructor(t,e,i,s,a,n,r,h,o){this.turn=t,this.hand=e,this.unitControls=i,this.unitStats=s,this.endTurn=a,this.resources=n,this.cardDetails=r,this.deckStats=h,this.discard=o,this.discardMode=!1}}class ei{startGame(){let t=this.turn.getPlayersInGame();tF.spawnDeckLeaders(this.scene,t,this.units,this.landmarks),t.forEach(t=>{for(let e=0;e<2;e++)this.cards.drawCard(t);console.log("".concat(t.name,": ").concat(JSON.stringify(this.cards.getHand(t).map(t=>t.name))))}),this.turn.endTurn()}endTurn(){console.log("End Turn"),this.turn.getPlayersInGame().forEach(t=>{this.cancelUnitMove(t)});let t=this.turn.getActivePlayer();t.units.getAllActiveUnits().forEach(t=>{t.effectHandler.applyOnTrigger(Y.onTurnEnd),t.isActive()&&(t.setActive(!1),console.log("".concat(t.name," has not moved, so it was set to inactive...")))}),this.turn.endTurn()}startTurn(t){console.log("".concat(t.name,"'s turn")),this.landmarks.updateLandmarks(t);let e=t.resources.calculateIncome();t.resources.increaseMax(),t.resources.generate(e),this.cards.drawCard(t),t.units.getAllActiveUnits().forEach(t=>{t.effectHandler.applyOnTrigger(Y.onTurnStart),t.setActive(!0)}),t.isDevicePlayer||(1===this.turn.getTurnNumber()?(this.selectUnit(this.units.getUnitByPosition({x:0,y:0}),t),this.scene.time.addEvent({delay:1e3,callback:()=>{this.moveUnitTo({x:2,y:0},t),this.waitUnit(t),w.emit(v.gameEvent.NEXT_TURN)}})):5===this.turn.getTurnNumber()?(this.selectUnit(this.units.getUnitByPosition({x:2,y:0}),t),this.scene.time.addEvent({delay:2e3,callback:()=>{this.moveUnitTo({x:2,y:2},t),this.waitUnit(t),w.emit(v.gameEvent.NEXT_TURN)}})):this.scene.time.addEvent({delay:3e3,callback:()=>{this.turn.pass(t.id)}}))}selectCard(t){w.emit(v.uiEvent.HIDE_SPELL_SELECTOR),this.selectionGrid.hide();let e=this.turn.getActivePlayer();if(t.getOwner()!==e)return;if(this.cards.selectCard(e,t),t.cardType!==I.spell){this.selectionGrid.showRallyPoints(e);return}let i=t.targetType===V.position?c.PLAY_CARD:c.NONE;this.selectionGrid.showSpellRange(e,i),w.emit(v.uiEvent.SHOW_SPELL_SELECTOR,e,t.targetType)}cancelCard(){w.emit(v.uiEvent.HIDE_SPELL_SELECTOR);let t=this.turn.getActivePlayer();this.cards.deselectCard(t),this.selectionGrid.hide()}playCard(t){let e=this.turn.getActivePlayer(),i=this.cards.getSelectedCard(e),s=e.resources;if(!i)throw Error("Failed to play card; no card was selected...");switch(s.spend(i.cost),this.cancelCard(),this.cards.removeCard(e,i),i.cardType){case I.unit:case I.hero:if(t instanceof tg)throw Error("Invalid summon location...");this.playUnitCard(i,t);break;case I.spell:this.playSpellCard(e,i,t)}return console.log("Played ".concat(i.name,"!")),!0}playUnitCard(t,e){this.units.summonUnitByCard(this.scene,t,e)}playSpellCard(t,e,i){let s=e.getEffects();if(!s)throw Error("No effects were defined in ".concat(e.name,"..."));this.effects.cast(t,s,i)}confirmDiscard(t,e){let i=this.turn.getActivePlayer();this.cards.handleDiscard(i,t,e)}selectUnit(t){var e;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.turn.getDevicePlayer();if(w.emit(v.uiEvent.HIDE_ATTACK_SELECTOR),w.emit(v.uiEvent.HIDE_SPELL_SELECTOR),console.log("select ".concat(t.name)),t===i.units.getSelected())return;this.cancelUnitMove(),this.units.selectUnit(i,t);let s=null===(e=t.position())||void 0===e?void 0:e.get();if(!s)throw Error("The position controller for ".concat(t.id," has not been initialized..."));let a=t.getCurrentStats().mvt,n=t.getCurrentStats().rng;t.isActive()&&this.turn.isDevicePlayerTurn()?this.selectionGrid.showMoves(s,a,!1):this.selectionGrid.showAttackRange(s,n),t.isActive()&&w.emit(v.uiEvent.SHOW_ATTACK_SELECTOR,t)}moveUnitTo(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.turn.getDevicePlayer();w.emit(v.uiEvent.HIDE_ATTACK_SELECTOR);let i=this.units.getSelected(e);if(!i)throw Error("No unit was selected...");this.units.moveTo(i,t),w.emit(v.uiEvent.SHOW_ATTACK_SELECTOR,i,t)}waitUnit(){var t;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.turn.getDevicePlayer(),i=this.units.getSelected(e);if(!i)throw Error("Failed to wait unit; no unit was selected...");let s=null===(t=i.position())||void 0===t?void 0:t.get();if(!s)throw Error("Failed to wait unit; ".concat(i.name," does not have a game object defined..."));let a=this.landmarks.getLandmarkAt(s);this.units.confirmMove(e,i),w.emit(v.uiEvent.HIDE_ATTACK_SELECTOR),this.selectionGrid.hide();let n=i.position().get();if(!n)throw Error("Failed to wait unit; ".concat(i.name," does not have a game object defined..."));let r=this.landmarks.getLandmarkAt(n);a!=r&&(a&&this.landmarks.leaveLandmark(a),r&&this.landmarks.enterLandmark(r,i))}cancelUnitMove(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.turn.getDevicePlayer();this.units.cancelMove(t),this.selectionGrid.hide(),w.emit(v.uiEvent.HIDE_ATTACK_SELECTOR)}attackUnit(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.turn.getDevicePlayer(),i=this.units.getSelected(e);if(!i)throw Error("Failed to initiate fight; attacker is missing...");this.waitUnit(),this.combat.initiateFight(i,t)}killUnit(t){this.units.removeUnit(t)}getActivePlayer(){return this.turn.getActivePlayer()}constructor(t,e,i,s,a,n,r,h){this.scene=t,this.landmarks=e,this.turn=i,this.units=s,this.selectionGrid=a,this.cards=n,this.effects=r,this.combat=h}}class es{show(){this.ui.show()}hide(){this.ui.hide(),this.ui.hideWaitButton()}showWaitButton(){this.ui.showWaitButton()}hideWaitButton(){this.ui.hideWaitButton()}constructor(t){this.ui=t}}class ea extends Phaser.GameObjects.Container{show(){this.setVisible(!0)}hide(){this.setVisible(!1)}showWaitButton(){this.waitButton.show()}hideWaitButton(){this.waitButton.hide()}constructor(t){super(t,.8*m.width,.1*m.height),this.cancelButton=new t9(t,"cancelUnitButton","Cancel",{x:0,y:.5*m.height},T.width,T.height,A.cancel,()=>{var t;null===(t=this.cancelButton)||void 0===t||t.bg.setFillStyle(A.cancelLight)},()=>{var t;null===(t=this.cancelButton)||void 0===t||t.bg.setFillStyle(A.cancel),w.emit(v.unitEvent.CANCEL)}),this.add(this.cancelButton),this.waitButton=new t9(t,"waitButton","Wait",{x:0,y:0},T.width,T.height,A.action,()=>{var t;null===(t=this.waitButton)||void 0===t||t.bg.setFillStyle(A.actionLight)},()=>{var t;null===(t=this.waitButton)||void 0===t||t.bg.setFillStyle(A.action),w.emit(v.unitEvent.WAIT)}),this.add(this.waitButton),this.waitButton.hide(),this.hide()}}class en{show(t){let e=t.getCurrentStats();this.ui.setUnitName(t.name),this.ui.setPortrait(t.getGameObject().imageAssetName),this.ui.setClassIcon(G(t.unitClass)),this.ui.setHP(e.hp),this.ui.setSP(e.sp),this.updatePwrText(t),this.updateDefText(t),this.ui.show()}updatePwrText(t){let e=t.getCurrentStats(),i=e.pwr<t.base.pwr?A.damage:e.pwr>t.base.pwr?A.buff:A.white;this.ui.setPwr(e.pwr,i)}updateDefText(t){let e=t.getCurrentStats(),i=e.def<t.base.def?A.damage:e.def>t.base.def?A.buff:A.white;this.ui.setDef(e.def,i)}hide(){this.ui.hide()}isVisible(){return this.ui.visible}constructor(t){this.ui=t}}let er={width:.05*m.width,height:.05*m.width},eh={width:.5*er.width,height:.5*er.height};class eo extends Phaser.GameObjects.Container{show(){this.setVisible(!0)}hide(){this.setVisible(!1)}isVisible(){return this.visible}setUnitName(t){this.unitNameText.setText(t)}setClassIcon(t){this.classIcon.setTexture(P.CLASS_ICONS,t)}setPortrait(t){this.image.setTexture(t)}setHP(t){this.unitHPText.setText(String(t))}setSP(t){this.unitSPText.setText(String(t))}setPwr(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A.white;this.unitPwrText.setText(String(t));let i=Phaser.Display.Color.IntegerToRGB(e);this.unitPwrText.setColor(Phaser.Display.Color.RGBToString(i.r,i.g,i.b))}setDef(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A.white;this.unitDefText.setText(String(t));let i=Phaser.Display.Color.IntegerToRGB(e);this.unitDefText.setColor(Phaser.Display.Color.RGBToString(i.r,i.g,i.b))}constructor(t){super(t,0,0);let e={fontFamily:tZ.main,fontSize:20},i={fontFamily:tZ.secondary,fontSize:20};this.image=t.add.sprite(.5*E.width,.5*E.height,P.UNDEFINED).setDisplaySize(E.width,E.height).setOrigin(.5);let s=t.add.container(.15*m.width,.7*m.height),a=t.add.image(0,0,P.HP_ICON).setDisplaySize(er.width,er.height).setOrigin(.5);this.unitHPText=t.add.text(0,0,"0",i).setFontSize(32).setOrigin(.5),s.add(a),s.add(this.unitHPText);let n=t.add.container(.25*m.width,.7*m.height),r=t.add.image(0,0,P.SP_ICON).setDisplaySize(er.width,er.height).setOrigin(.5);this.unitSPText=t.add.text(0,0,"0",i).setFontSize(32).setOrigin(.5),n.add(r),n.add(this.unitSPText);let h=t.add.container(.35*m.width,.7*m.height),o=t.add.image(0,0,P.PWR_ICON).setDisplaySize(er.width,er.height).setOrigin(.5);this.unitPwrText=t.add.text(0,0,"0",i).setFontSize(32).setOrigin(.5),h.add(o),h.add(this.unitPwrText);let c=t.add.container(.45*m.width,.7*m.height),l=t.add.image(0,0,P.DEF_ICON).setDisplaySize(er.width,er.height).setOrigin(.5);this.unitDefText=t.add.text(0,0,"0",i).setFontSize(32).setOrigin(.5),c.add(l),c.add(this.unitDefText),this.unitNameText=t.add.text(.15*m.width,.2*m.height,"unit name",e).setOrigin(0,.5);let d=t.add.container(.125*m.width,.2*m.height),u=t.add.rectangle(0,0,eh.width,eh.height,0).setStrokeStyle(2,16777215).setOrigin(.5);this.classIcon=t.add.sprite(0,0,P.CLASS_ICONS,U.SOLDIER).setDisplaySize(eh.width,eh.height).setOrigin(.5),d.add(u),d.add(this.classIcon),this.add(this.image),this.add(this.unitNameText),this.add(d),this.add(s),this.add(n),this.add(h),this.add(c)}}class ec{show(){this.ui.show()}hide(){this.ui.hide()}constructor(t){this.ui=t}}class el extends t9{constructor(t){super(t,"endTurnButton","End Turn",{x:.8*m.width,y:.1*m.height},T.width,T.height,A.action,()=>{this.bg.setFillStyle(A.actionLight)},()=>{this.bg.setFillStyle(A.action),w.emit(v.gameEvent.NEXT_TURN)})}}let ed={width:.12*g.width,height:.4*g.height};class eu extends Phaser.GameObjects.Container{setCurrent(t){this.currentText.setText(String(t))}setMax(t){this.maxText.setText(String(t))}setIncome(t){this.incomeText.setText("X ".concat(t))}constructor(t){super(t,0,.39*g.height);let e=t.add.rectangle(0,0,ed.width,ed.height,A.background).setOrigin(0);this.currentText=t.add.text(.2*ed.width,.2*ed.height,"0",{fontSize:50});let i=t.add.line(0,.25*ed.height,.1*ed.height,.4*ed.height,.8*ed.width,-(.05*ed.height),16777215).setLineWidth(3).setOrigin(0);this.maxText=t.add.text(.55*ed.width,.5*ed.height,"0",{fontSize:50});let s=t.add.image(.3*ed.width,.8*ed.height,P.INCOME_RATE).setOrigin(.5);this.incomeText=t.add.text(.5*ed.width,.8*ed.height,"X 0",{fontSize:20}),this.add(e),this.add(this.currentText),this.add(i),this.add(this.maxText),this.add(s),this.add(this.incomeText)}}class eg{setMax(t){this.ui.setMax(t)}setCurrent(t){this.ui.setCurrent(t)}setIncome(t){this.ui.setIncome(t)}constructor(t){this.ui=t}}let em={width:.2*g.width,height:.5*g.height},ep=.05*em.width;class eE extends Phaser.GameObjects.Container{setupBase(t){let e=t.add.rectangle(0,0,em.width,em.height,A.background).setOrigin(0);this.add(e);let i=t.add.text(ep,0,"",{fontFamily:tZ.main,fontSize:24});this.add(i);let s=t.add.text(ep,.05*g.height,"",{fontFamily:tZ.secondary,fontSize:16});return this.add(s),{cardName:i,cardType:s}}setupDescBox(t,e,i,s,a){let n=t.add.container(i.x,i.y),r=t.add.rectangle(0,0,.4*em.width,.05*em.height).setStrokeStyle(1,16777215).setOrigin(0),h=t.add.text(0,0,e,{fontFamily:tZ.main,fontSize:16,wordWrap:{width:.9*em.width}}),o=t.add.rectangle(0,.06*em.height,s,a,0).setOrigin(0).setStrokeStyle(1,16777215),c=t.add.text(0,.06*em.height,"",{fontFamily:tZ.main,fontSize:18,wordWrap:{width:.9*em.width}}).setOrigin(0);return n.add(r),n.add(h),n.add(o),n.add(c),this.add(n),n.setVisible(!1),{container:n,desc:c}}show(){this.setVisible(!0),""!==this.spellEffectsDesc.text&&this.spellEffects.setVisible(!0),""!==this.leaderDesc.text&&this.spellEffects.setVisible(!0),""!==this.passiveDesc.text&&this.spellEffects.setVisible(!0),""!==this.activeDesc.text&&this.spellEffects.setVisible(!0)}hide(){this.setVisible(!1)}reset(){this.cardName.setText(""),this.cardType.setText(""),this.spellEffectsDesc.setText(""),this.spellEffects.setVisible(!1),this.leaderDesc.setText(""),this.leaderSkill.setVisible(!1),this.passiveDesc.setText(""),this.passiveSkill.setVisible(!1),this.activeDesc.setText(""),this.activeSkill.setVisible(!1)}setCardName(t){this.cardName.setText(t)}setCardType(t){this.cardType.setText(t)}setSpellEffects(t){this.spellEffects.setVisible(!0),this.spellEffectsDesc.setText(t)}constructor(t){super(t,.66*g.width,.29*g.height),({cardName:this.cardName,cardType:this.cardType}=this.setupBase(t)),({container:this.spellEffects,desc:this.spellEffectsDesc}=this.setupDescBox(t,"Spell Effect",{x:ep,y:.2*em.height},.9*em.width,.7*em.height)),({container:this.leaderSkill,desc:this.leaderDesc}=this.setupDescBox(t,"Leader Skill",{x:ep,y:.18*em.height},.9*em.width,.15*em.height)),({container:this.passiveSkill,desc:this.passiveDesc}=this.setupDescBox(t,"Passive Skill",{x:ep,y:.4*em.height},.9*em.width,.15*em.height)),({container:this.activeSkill,desc:this.activeDesc}=this.setupDescBox(t,"Active Skill",{x:ep,y:.62*em.height},.9*em.width,.3*em.height)),this.hide()}}class eT{show(t){this.ui.setCardName(t.name),this.ui.setCardType(t.cardType),t.cardType===I.spell&&t.description&&this.ui.setSpellEffects(t.description),this.ui.show()}hide(){this.ui.hide(),this.ui.reset()}constructor(t){this.ui=t}}let ey={width:.12*g.width,height:.2*g.height};class eC extends Phaser.GameObjects.Container{setDeckCount(t){this.deckCountText.setText("X ".concat(t))}setDeathCount(t){this.deathCountText.setText("X ".concat(t))}constructor(t){super(t,0,.15*g.height);let e=t.add.rectangle(0,0,ey.width,ey.height,A.background).setOrigin(0),i=t.add.image(.2*ey.width,.3*ey.height,P.DECK_COUNT).setOrigin(.5);this.deckCountText=t.add.text(.4*ey.width,.15*ey.height,"X 0",{fontSize:50});let s=t.add.image(.2*ey.width,.7*ey.height,P.DEATH_COUNT).setOrigin(.5);this.deathCountText=t.add.text(.4*ey.width,.55*ey.height,"X 0",{fontSize:50}),this.add(e),this.add(i),this.add(this.deckCountText),this.add(s),this.add(this.deathCountText)}}class ef{setDeckCount(t){this.ui.setDeckCount(t)}setDeathCount(t){this.ui.setDeathCount(t)}constructor(t){this.ui=t}}class ew{initiateFight(t,e){this.attack(t,e),this.attemptRetalliation(t,e)}attack(t,e){let i=this.calcDamage(t,e);console.log("".concat(t.name," attacks ").concat(e.name)),e.combat.changeHealth(-i)}attemptRetalliation(t,e){tj(e.position().get(),t.position().get(),e.getCurrentStats().rng)&&(this.attack(e,t),console.log("".concat(e.name," retaliates!")))}calcDamage(t,e){let i=t.getCurrentStats(),s=e.getCurrentStats(),a=i.pwr-s.def;switch(t.unitClass){case k.ASSASSIN:s.hp<.5*e.base.hp&&(a=Math.ceil(1.2*a));break;case k.BERSERKER:i.hp<.5*t.base.hp&&(a=Math.ceil(1.2*a))}return e.unitClass===k.GUARDIAN&&(a=Math.floor(.8*a)),a<1&&(a=1),a}constructor(t,e){this.units=t,this.effects=e}}let ev={width:.4*g.width,height:.5*g.height};class eS extends Phaser.GameObjects.Container{setCardToDiscard(t){this.discardContainer&&this.remove(this.discardContainer,!0);let e={x:.1*ev.width,y:.35*ev.height};this.discardContainer=t2.createCardGO(this.scene,t,e),this.add(this.discardContainer)}showOKButton(){this.okButton.show()}setHeroCard(t){let e={x:.55*ev.width,y:.35*ev.height};this.heroCardContainer=new tQ(this.scene,t,e),this.add(this.heroCardContainer)}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}reset(){this.heroCardContainer&&this.remove(this.heroCardContainer,!0),this.discardContainer&&this.remove(this.discardContainer,!0),this.okButton.hide()}constructor(t){super(t,.25*g.width,.2*g.height);let e=t.add.rectangle(0,0,ev.width,ev.height,A.background).setOrigin(0),i=t.add.text(.1*ev.width,.1*ev.height,"Maximum hand size reached! Please discard a card to make room for this hero.",{wordWrap:{width:.9*ev.width}}).setOrigin(0),s=t.add.text(.1*ev.width,.25*ev.height,"To Discard:"),a=t.add.rectangle(.1*ev.width,.35*ev.height,p.width,p.height,0).setOrigin(0),n=t.add.text(.55*ev.width,.25*ev.height,"Next Card:");this.okButton=new t9(t,"confirmDiscard","OK",{x:.35*ev.width,y:.85*ev.height},.2*ev.width,.1*ev.height,A.action,()=>{var t;null===(t=this.okButton)||void 0===t||t.bg.setFillStyle(A.actionLight)},()=>{var t,e;null===(t=this.okButton)||void 0===t||t.bg.setFillStyle(A.action),this.heroCardContainer&&this.discardContainer&&(w.emit(v.cardEvent.CONFIRM_DISCARD,null===(e=this.heroCardContainer)||void 0===e?void 0:e.getCard(),this.discardContainer.getCard()),this.hide())}),this.okButton.hide(),this.add(e),this.add(i),this.add(s),this.add(a),this.add(n),this.add(this.okButton),this.hide()}}class eO{show(t){this.ui.setHeroCard(t),this.ui.show()}hide(){this.ui.hide(),this.reset()}setCardToDiscard(t){this.cardToDiscard=t,this.ui.setCardToDiscard(t),this.ui.showOKButton()}reset(){this.cardToDiscard=void 0,this.heroCard=void 0,this.ui.reset()}constructor(t){this.ui=t}}class eA extends Phaser.Scene{preload(){this.load.image(P.TILE_SET,"./assets/maps/tilesets/tileset.png"),this.load.image(P.MAP_ICONS,"./assets/maps/tilesets/mapicons.png"),this.load.tilemapTiledJSON(P.TILE_MAP,"./assets/maps/testmap2.json"),this.load.image(P.UNDEFINED,"./assets/portraits/undefined.png"),this.load.image(P.HP_ICON,"./assets/icons/hp.png"),this.load.image(P.SP_ICON,"./assets/icons/sp.png"),this.load.image(P.PWR_ICON,"./assets/icons/pwr.png"),this.load.image(P.DEF_ICON,"./assets/icons/def.png"),this.load.image(P.ATTACK_SELECTOR,"./assets/icons/attack.png"),this.load.image(P.SPELL_SELECTOR,"./assets/icons/spell.png"),this.load.image(P.INCOME_RATE,"./assets/icons/incomeRate.png"),this.load.image(P.DECK_COUNT,"./assets/icons/deckCount.png"),this.load.image(P.DEATH_COUNT,"./assets/icons/deathCount.png"),this.load.spritesheet(P.CLASS_ICONS,"./assets/icons/Class.png",{frameWidth:31,frameHeight:31}),this.load.image(P.YOUR_TURN,"./assets/ui/your_turn.png"),this.load.image(P.OPPONENT_TURN,"./assets/ui/opponent_turn.png")}create(){console.log("Now Loading..."),console.log("Loading Player Information...");let t=tR.createCard(q),e=tR.createCard(tt);console.log("Loading Player Decks...");let i=[tR.createCard($),tR.createCard(te),tR.createCard(te),tR.createCard(te),tR.createCard(ti),tR.createCard(ti),tR.createCard(ts),tR.createCard(ta),tR.createCard(tn),tR.createCard(tr),tR.createCard(th)],s=new tP(i,t),a=new tP([],e),n=new tI(1,x,L(1),1,s,!0),r=new tI(2,N,L(2),2,a),h=[n,r];console.log("Generating Field...");let o=this.game.scene.getScene(f.GAMEPLAY),c=tF.generateMap(o),l=tF.generateSelectionGrid(o,c),d=tF.loadLandmarks(c);tF.assignInitialLandmarks(c,d.byType,h),console.log("Initializing Game State");let u=new t7(h),g=new t6(u,c,d.byLocation,l);console.log("Initializing Controllers");let m=new t3(u),p=new t5(g),E=new tK(g,p),T=new t8(h),y=new tY(g,h),w=new ew(p,y),v=new tW(g,y),S=new ei(o,v,m,p,E,T,y,w);console.log("Initializing UI");let A=this.game.scene.getScene(f.HUD),R=new t4(A),P=new ea(A),D=new eo(A),_=new el(A),I=new eu(A),b=new eE(A),k=new eC(A),U=new eS(A),G=new et(R,n),M=new es(P),B=new en(D),H=new ec(_),F=new eg(I),z=new eT(b),j=new ef(k),V=new eO(U),Y=new ee(m,G,M,B,H,F,z,j,V),W=new tz(o,S,Y);console.log("Starting game..."),this.game.registry.set(C.playersInGame,h),this.game.registry.set(C.tilemapData,c),this.game.registry.set(C.selectionGrid,l),this.game.registry.set(C.landmarksData,d),this.game.registry.set(C.state,u),this.game.registry.set(C.field,g),this.game.registry.set(O.turnController,m),this.game.registry.set(O.unitsController,p),this.game.registry.set(O.selectionGridController,E),this.game.registry.set(O.landmarksController,v),this.game.registry.set(O.cardController,T),this.game.registry.set(O.effectsSystem,y),this.game.registry.set(O.combatSystem,w),this.game.registry.set(O.mainController,S),this.game.registry.set(O.handUIObject,R),this.game.registry.set(O.unitControlsPanel,P),this.game.registry.set(O.unitStatDisplay,D),this.game.registry.set(O.endTurnButton,_),this.game.registry.set(O.resourceDisplay,I),this.game.registry.set(O.cardDetailsDisplay,b),this.game.registry.set(O.deckStatDisplay,k),this.game.registry.set(O.discardWindow,U),this.game.registry.set(O.handUIController,G),this.game.registry.set(O.unitCtrlPanelController,M),this.game.registry.set(O.unitStatDisplayController,B),this.game.registry.set(O.endTurnButtonController,H),this.game.registry.set(O.resourceDisplayController,F),this.game.registry.set(O.cardDetailsDisplayController,z),this.game.registry.set(O.deckStatDisplayController,j),this.game.registry.set(O.discardWindowController,V),this.game.registry.set(O.uiController,Y),this.game.registry.set(O.eventDispatcher,W),this.game.scene.start(f.GAMEPLAY)}update(){}}class eR extends Phaser.Scene{create(){let t=this.add.sprite(g.width/2,g.height/2,P.YOUR_TURN).setOrigin(.5);t.setVisible(!1);let e=this.tweens.add({targets:t,alpha:{from:0,to:1},scale:{from:2,to:2.2},ease:"Quartic.Out",duration:1200,repeat:0,yoyo:!0,persist:!0}),i=this.add.sprite(g.width/2,g.height/2,P.OPPONENT_TURN).setOrigin(.5);i.setVisible(!1);let s=this.tweens.add({targets:i,alpha:{from:0,to:1},scale:{from:2,to:2.2},ease:"Quartic.Out",duration:1200,repeat:0,yoyo:!0,persist:!0});w.on(v.gameEvent.PLAYER_TURN,a=>{a.isDevicePlayer?(i.setVisible(!1),t.setVisible(!0),e.restart(),e.play()):(t.setVisible(!1),i.setVisible(!0),s.restart(),s.play())})}constructor(){super({key:f.TURN_TRANSITION})}}function eP(){let t=new(d()).Game(y);return t.scene.add(f.LOADING,eA,!1),t.scene.add(f.GAMEPLAY,S,!1),t.scene.add(f.HUD,R,!1),t.scene.add(f.TURN_TRANSITION,eR,!1),t.scene.start(f.LOADING),t}},8960:function(t){!function(){var e={229:function(t){var e,i,s,a=t.exports={};function n(){throw Error("setTimeout has not been defined")}function r(){throw Error("clearTimeout has not been defined")}function h(t){if(e===setTimeout)return setTimeout(t,0);if((e===n||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(i){try{return e.call(null,t,0)}catch(i){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:n}catch(t){e=n}try{i="function"==typeof clearTimeout?clearTimeout:r}catch(t){i=r}}();var o=[],c=!1,l=-1;function d(){c&&s&&(c=!1,s.length?o=s.concat(o):l=-1,o.length&&u())}function u(){if(!c){var t=h(d);c=!0;for(var e=o.length;e;){for(s=o,o=[];++l<e;)s&&s[l].run();l=-1,e=o.length}s=null,c=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===r||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function g(t,e){this.fun=t,this.array=e}function m(){}a.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];o.push(new g(t,e)),1!==o.length||c||h(u)},g.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(t){return[]},a.binding=function(t){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},i={};function s(t){var a=i[t];if(void 0!==a)return a.exports;var n=i[t]={exports:{}},r=!0;try{e[t](n,n.exports,s),r=!1}finally{r&&delete i[t]}return n.exports}s.ab="//";var a=s(229);t.exports=a}()}}]);