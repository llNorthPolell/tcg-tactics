(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[582],{2601:function(t,e,i){"use strict";var s,a;t.exports=(null==(s=i.g.process)?void 0:s.env)&&"object"==typeof(null==(a=i.g.process)?void 0:a.env)?i.g.process:i(8960)},2023:function(t,e,i){"use strict";let s;i.r(e),i.d(e,{default:function(){return tI}});var a,n,r,o,h,c,l=i(6306),d=i.n(l);let u={width:32,height:32},g={width:1280,height:720},m={width:g.width,height:.2*g.height},E={width:.08*m.width,height:m.height},p={width:m.height,height:m.height},T={type:d().AUTO,scale:{width:g.width,height:g.height},parent:"game",backgroundColor:0,physics:{default:"arcade",arcade:{}}},y={cardEvent:Object.freeze({SELECT:"select-card",PLAY:"play-card",CANCEL:"cancel-card-select"}),uiEvent:Object.freeze({UPDATE_RESOURCE_DISPLAY:"update-resource-display",UPDATE_HAND:"update-hand-ui",UPDATE_UNIT_STAT_DISPLAY:"update-unit-stat-display",UPDATE_DECK_COUNTER:"update-deck-counter",UPDATE_CASUALTY_COUNTER:"update-casualty-counter"}),gameEvent:Object.freeze({PLAYER_TURN:"player-turn",NEXT_TURN:"next-turn"}),playerEvent:Object.freeze({GENERATE_RESOURCES:"generate-resources"}),fieldEvent:Object.freeze({SUMMON_UNIT:"summon-unit",CAST_SPELL:"cast-spell",CAPTURE_LANDMARK:"capture-landmark"}),unitEvent:Object.freeze({SELECT:"select-unit",CANCEL:"cancel-unit-select",ATTACK:"attack-unit",MOVE:"move-unit",WAIT:"wait-unit",DEATH:"unit-death"})},v=Object.freeze({player:"player",opponents:"opponents",allies:"allies",field:"field",deck:"deck"}),f=Object.freeze({GAMEPLAY:"GameplayScene",HUD:"HUD",LOADING:"Loading"}),A=Object.freeze({SOLDIER:"Soldier",BERSERKER:"Berserker",GUARDIAN:"Guardian",RANGER:"Ranger",ASSASSIN:"Assassin",MAGE:"Mage",LANCER:"Lancer",TOWER:"Tower"}),P=Object.freeze({SOLDIER:1,BERSERKER:3,RANGER:4,ASSASSIN:5,GUARDIAN:6,TOWER:7,MAGE:9,LANCER:13});class R{constructor(t,e,i,s,a,n,r,o,h,c,l,d,u,g){this.id=t,this.name=e,this.unitClass=i,this.hp=s,this.sp=a,this.pwr=n,this.def=r,this.mvt=o,this.rng=h,this.passiveSkillDesc=l,this.passiveSkillData=d,this.activeSkillDesc=u,this.activeSkillData=g,this.cost=c}}class S extends R{constructor(t,e,i,s,a,n,r,o,h,c,l,d,u,g,m,E,p){super(t,e,i,s,a,n,r,o,h,p,d,u,g,m),this.leaderSkillDesc=c,this.leaderSkillData=l,this.minions=E}}class w{constructor(t){this.name=t.name,this.unitClass=t.unitClass,this.baseMaxHp=t.hp,this.maxHP=t.hp,this.currHp=t.hp,this.baseMaxSp=t.sp,this.maxSP=t.sp,this.currSp=t.sp,this.basePwr=t.pwr,this.currPwr=t.pwr,this.baseDef=t.def,this.currDef=t.def,this.baseMvt=t.mvt,this.currMvt=t.mvt,this.baseRng=t.rng,this.currRng=t.rng,this.isStunned=!1,this.sleepTime=0}}let O=Object.freeze({none:"none",ally:"ally",enemy:"enemy",position:"position"}),C=new Phaser.Events.EventEmitter;function _(t,e,i){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<=i}class L{constructor(t,e,i,s,a,n){this.id=t,this.name=e,this.cost=s,this.description=a,this.effectData=n,this.targetType=i}}let x=Object.freeze({TILE_SET:"tile-set",MAP_ICONS:"map-icons",TILE_MAP:"map",TILE_GROUND_LAYER:"Ground",TILE_DECORATION_LAYER:"Decoration",TILE_OBSTACLE_LAYER:"Obstacles",TILE_LANDMARKS_LAYER:"Landmarks",TILE_MAP_PLAYER_START_LAYER:"PlayerStart",TILE_MAP_TILE_SET_IMG:"tileset",TILE_MAP_ICON_SET_IMG:"mapicons",UNDEFINED:"undefined",PORTRAIT:"portrait_",CLASS_ICONS:"class-icons",HP_ICON:"hp-icon",SP_ICON:"sp-icon",PWR_ICON:"pwr-icon",DECK_COUNT:"deck-count",DEATH_COUNT:"death-count",INCOME_RATE:"income-rate",ATTACK_SELECTOR:"attack-selector",SPELL_SELECTOR:"spell-selector"});function N(t,e,i,s,a,n){let r="".concat(x.PORTRAIT,"_").concat(i,"_").concat(s);t.load.image(r,"./assets/portraits/".concat(i.toLowerCase(),"/").concat(s,".png")),t.load.once(Phaser.Loader.Events.COMPLETE,()=>{null==e||e.setTexture(r).setOrigin(.5).setDisplaySize(a,n)}),t.load.start()}class U extends Phaser.GameObjects.Container{constructor(t,e){super(t,e.getPosition().x,e.getPosition().y);let i=e.data instanceof L?"Spells":e.data instanceof S?"Heroes":"Units",s=e.data instanceof L?119:e.data instanceof S?7798784:7829248,a=this.scene.add.rectangle(0,0,E.width,E.height,s).setOrigin(0,0).setStrokeStyle(1,0);this.add(a),this.add(this.scene.add.text(.1*E.width,.5*E.height,e.data.name,{fontFamily:'"Averia Serif Libre",serif',fontSize:16})),this.setInteractive(a,Phaser.Geom.Rectangle.Contains).on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{C.emit(y.cardEvent.SELECT,e)});let n=this.scene.add.sprite(.5*E.width,.5*E.height,x.UNDEFINED).setDisplaySize(.9*E.width,.9*E.height).setOrigin(.5);N(t,n,i,e.data.id,.9*E.width,.9*E.height),this.add(n)}}class I{setPosition(t){var e;this.position=t,null===(e=this.gameObject)||void 0===e||e.setPosition(t.x,t.y)}getPosition(){return this.position}render(t){return this.gameObject||(this.gameObject=new U(t,this)),this.gameObject}setOwner(t){this.owner=t}getOwner(){return this.owner}getGameObject(){return this.gameObject}hide(){var t;null===(t=this.gameObject)||void 0===t||t.setVisible(!1)}constructor(t,e,i){this.id=t,this.data=e,this.owner=i,this.position={x:0,y:0}}}class D extends I{play(t){C.emit(y.fieldEvent.SUMMON_UNIT,t,this.data,this.owner)}constructor(t,e,i){super(t,e,i)}}class b extends I{play(t){C.emit(y.fieldEvent.SUMMON_UNIT,t,this.data,this.owner)}constructor(t,e,i){super(t,e,i)}}class k extends Phaser.GameObjects.Container{show(t){this.attacker=t,this.setVisible(!0)}hide(){this.setVisible(!1),this.attacker=void 0}constructor(t,e){super(t,0,0),this.unit=e;let i=t.add.rectangle(0,0,u.width,u.height).setOrigin(0);this.add(i);let s=t.add.image(0,0,x.ATTACK_SELECTOR).setOrigin(0);this.add(s),this.setInteractive(i,Phaser.Geom.Rectangle.Contains).on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{this.attacker&&C.emit(y.unitEvent.ATTACK,this.attacker,e)}),this.hide()}}let M=Object.freeze({none:0,success:65520,warning:16776960,danger:16711680});class G extends Phaser.GameObjects.Container{show(t){let e=t.getOwner().id,i=this.unit.getOwner().playerInfo.id,s=t.data.targetType;(e!==i||s!==O.enemy)&&(e===i||s!==O.ally)&&(this.spellCard=t,this.selector.tint=t.data.targetType===O.ally?M.success:t.data.targetType===O.enemy?M.danger:M.none,this.setVisible(!0))}hide(){this.setVisible(!1)}constructor(t,e){super(t,0,0),this.unit=e;let i=t.add.rectangle(0,0,u.width,u.height).setOrigin(0);this.add(i),this.selector=t.add.image(0,0,x.SPELL_SELECTOR).setOrigin(0),this.add(this.selector),this.setInteractive(i,Phaser.Geom.Rectangle.Contains).on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{this.spellCard&&(console.log("Cast ".concat(this.spellCard.data.name," onto ").concat(this.unit.getUnitData().name,"!")),C.emit(y.cardEvent.PLAY,this.unit))}),this.hide()}}class H extends Phaser.GameObjects.Container{getImage(){return this.image}constructor(t,e){super(t,e.getPixelPosition().x,e.getPixelPosition().y);let i=e.getUnitType(),s=e.getOwner().color;this.activeColor=s;let a=Phaser.Display.Color.ValueToColor(s).darken(80);this.inactiveColor=a.color,this.imageAssetName="".concat(x.PORTRAIT,"_").concat(i,"_").concat(e.card.id);let n=t.add.rectangle(0,0,u.width,u.height,s).setOrigin(0);this.add(n),this.image=t.add.sprite(.5*u.width,.5*u.height,this.imageAssetName).setOrigin(.5).setDisplaySize(.9*u.width,.9*u.height),t.textures.exists(this.imageAssetName)||N(t,this.image,i,e.card.id,.9*u.width,.9*u.height),this.add(this.image),e.isActive()?this.image.setAlpha(1):this.image.setAlpha(.7),this.attackSelector=new k(t,e),this.add(this.attackSelector),this.spellSelector=new G(t,e),this.add(this.spellSelector),this.setInteractive(n,Phaser.Geom.Rectangle.Contains).on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{C.emit(y.unitEvent.SELECT,e)}),this.scene.add.existing(this)}}class j{handleEvents(){C.on(y.unitEvent.SELECT,t=>{var e,i;t!=this&&(t.owner.getTeam()!=this.owner.getTeam()&&_(t.getLocation(),this.getLocation(),t.unitData.currRng)?null===(e=this.gameObject)||void 0===e||e.attackSelector.show(t):null===(i=this.gameObject)||void 0===i||i.attackSelector.hide())}).on(y.unitEvent.MOVE,(t,e)=>{var i,s;if(t==this){console.log("Move ".concat(this.unitData.name," to (").concat(e.x,",").concat(e.y,")")),this.move(e);return}t.owner.getTeam()!=this.owner.getTeam()&&_(e,this.getLocation(),t.unitData.currRng)?null===(i=this.gameObject)||void 0===i||i.attackSelector.show(t):null===(s=this.gameObject)||void 0===s||s.attackSelector.hide()}).on(y.unitEvent.CANCEL,()=>{var t,e;(null===(t=this.gameObject)||void 0===t?void 0:t.attackSelector.visible)&&(null===(e=this.gameObject)||void 0===e||e.attackSelector.hide())}).on(y.unitEvent.WAIT,()=>{var t,e;(null===(t=this.gameObject)||void 0===t?void 0:t.attackSelector.visible)&&(null===(e=this.gameObject)||void 0===e||e.attackSelector.hide())}).on(y.cardEvent.SELECT,t=>{var e,i,s;if((null===(e=this.gameObject)||void 0===e?void 0:e.spellSelector.visible)&&(null===(i=this.gameObject)||void 0===i||i.spellSelector.hide()),t instanceof b||t instanceof D)return;let a=t.data.targetType;a!==O.none&&(null===(s=this.gameObject)||void 0===s||s.spellSelector.show(t))}).on(y.cardEvent.CANCEL,()=>{var t,e,i,s;(null===(t=this.gameObject)||void 0===t?void 0:t.attackSelector.visible)&&(null===(e=this.gameObject)||void 0===e||e.attackSelector.hide()),(null===(i=this.gameObject)||void 0===i?void 0:i.spellSelector.visible)&&(null===(s=this.gameObject)||void 0===s||s.spellSelector.hide())}).on(y.gameEvent.PLAYER_TURN,t=>{t==this.owner.id&&this.wake()})}getUnitData(){return this.unitData}setLocation(t){var e;this.location=t,this.pixelPosition={x:t.x*u.width,y:t.y*u.height},null===(e=this.gameObject)||void 0===e||e.setPosition(this.pixelPosition.x,this.pixelPosition.y)}getLocation(){return this.location}getPixelPosition(){return this.pixelPosition}getDestination(){return this.destination}render(t){this.setLocation(this.location),this.gameObject||(this.setLocation(this.getLocation()),this.gameObject=new H(t,this),this.handleEvents())}isActive(){return this.active}wake(){var t;null===(t=this.gameObject)||void 0===t||t.getImage().setAlpha(1),this.active=!0,this.updateEffects(),this.clearInactiveEffects()}sleep(){var t;null===(t=this.gameObject)||void 0===t||t.getImage().setAlpha(.7),this.active=!1}move(t){var e;this.destination=t,null===(e=this.gameObject)||void 0===e||e.setPosition(t.x*u.width,t.y*u.height)}confirmMove(){var t;this.destination&&(this.location=this.destination,this.destination=void 0),null===(t=this.gameObject)||void 0===t||t.setPosition(this.location.x*u.width,this.location.y*u.height),this.sleep()}cancelMove(){var t;this.destination=void 0,null===(t=this.gameObject)||void 0===t||t.setPosition(this.location.x*u.width,this.location.y*u.height)}getUnitType(){return this.card instanceof S?"heroes":"units"}getOwner(){return this.owner}getGameObject(){return this.gameObject}killUnit(){var t;console.log("".concat(this.id," has been slain...")),this.active=!1,null===(t=this.gameObject)||void 0===t||t.setVisible(!1),C.emit(y.unitEvent.DEATH,this)}insertBuff(t){t.setTarget(this),this.buffs=[...this.buffs,t]}insertDebuff(t){t.setTarget(this),this.debuffs=[...this.debuffs,t]}removeBuff(t){this.buffs=this.buffs.filter(e=>e!=t)}removeDebuff(t){this.debuffs=this.debuffs.filter(e=>e!=t)}updateEffects(){this.buffs.forEach(t=>{t.apply()}),this.debuffs.forEach(t=>{t.apply()})}clearInactiveEffects(){this.buffs=this.buffs.filter(t=>t.isActive()),this.debuffs=this.debuffs.filter(t=>t.isActive())}update(){}constructor(t,e,i,s){this.id=t,this.card=i,this.unitData=new w(i),this.location=e,this.pixelPosition={x:e.x*u.width,y:e.y*u.height},this.owner=s,this.active=!1,this.buffs=[],this.debuffs=[]}}let V=Object.freeze({VALUE:"value",PERCENTAGE:"percentage"});class Y{setTarget(t){this.target=t,this.active=!0}getTarget(){return this.target}reset(){this.duration&&!(this.duration<=0)&&(this.currTime=0)}getCurrTime(){return this.currTime}isActive(){return this.active}applyChange(){if(!this.target)return;let t=this.target.getUnitData().currHp,e=this.target.getUnitData().maxHP,i=this.valueType===V.VALUE?this.amount:Math.ceil(t*(this.amount/100)),s=t+i;s>e&&(s=e),this.target.getUnitData().currHp=s,console.log(i>0?"Heal target by ".concat(i," health"):"Deal ".concat(i," damage to target"))}apply(){if(!this.active)return;let t=!0;(this.applyOverTime||this.isDelayed)&&this.currTime++,this.isDelayed&&this.currTime<this.duration&&(t=!1),t&&this.applyChange(),this.duration||this.remove(),this.duration>0&&this.currTime>=this.duration&&this.remove()}remove(){if(!this.isRemovable){console.log("This spell effect cannot be removed.");return}this.forceRemove()}forceRemove(){this.active=!1,console.log("This spell effect has been removed.")}constructor(t,e,i=V.VALUE,s=0,a=!1,n=!1,r=!0){this.name=t,this.amount=e,this.valueType=i,this.isDelayed=n,this.applyOverTime=a,this.duration=(a||n)&&s>0?s:0,this.currTime=0,this.isRemovable=r,this.active=!1}}class z extends Y{constructor(t,e,i=V.VALUE,s=0,a=!1,n=!1,r=!0){super(t,-e,i,s,a,n,r)}}class W extends Y{constructor(t,e,i=V.VALUE,s=0,a=!1,n=!1,r=!0){super(t,e,i,s,a,n,r)}}class B{initiateFight(t,e){let i=t.getUnitData(),s=e.getUnitData(),a=this.calcDamage(t,e);s.currHp-=a,console.log("".concat(null==t?void 0:t.getUnitData().name," attacks ").concat(e.getUnitData().name)),console.log("".concat(null==e?void 0:e.getUnitData().name," takes ").concat(a," damage!")),s.currHp<=0&&e.killUnit();let n=t.getDestination();if(n&&!_(e.getLocation(),n,e.getUnitData().currRng)||!_(e.getLocation(),t.getLocation(),e.getUnitData().currRng))return;let r=this.calcDamage(e,t);i.currHp-=r,console.log("".concat(null==e?void 0:e.getUnitData().name," retaliates and ").concat(null==t?void 0:t.getUnitData().name," takes ").concat(r," damage!")),i.currHp<=0&&t.killUnit()}calcDamage(t,e){let i=t.getUnitData(),s=e.getUnitData(),a=i.currPwr;switch(i.unitClass){case A.ASSASSIN:s.currHp<.5*s.maxHP&&(a=Math.ceil(1.2*a));break;case A.BERSERKER:i.currHp<.5*i.maxHP&&(a=Math.ceil(1.2*a))}return s.unitClass===A.GUARDIAN&&(a=Math.ceil(.8*a)),a}constructor(){C.on(y.unitEvent.ATTACK,(t,e)=>{(null==t?void 0:t.isActive())&&(C.emit(y.unitEvent.WAIT),this.initiateFight(t,e))}).on(y.fieldEvent.CAST_SPELL,(t,e)=>{t.forEach(t=>{if(e){if(e instanceof j){if(console.log("Apply ".concat(t.name," onto ").concat(e.getUnitData().name,"..")),!t.duration){t.setTarget(e),t.apply();return}t instanceof W?e.insertBuff(t):t instanceof z&&e.insertDebuff(t)}else console.log("Apply ".concat(t," to (").concat(e.x,",").concat(e.y,")..."))}else console.log("Apply ".concat(t," without a target..."))})})}}let F=Object.freeze({HP:"hp",SP:"sp",PWR:"pwr",DEF:"def",MVT:"mvt",RNG:"rng"});class K{setTarget(t){this.target=t,this.active=!0}getTarget(){return this.target}reset(){this.duration&&!(this.duration<=0)&&(this.currTime=0)}getAmount(){return this.amount}getStat(){return this.stat}getDuration(){return this.duration}getCurrTime(){return this.currTime}isActive(){return this.active}applyStatChange(){switch(this.stat){case F.HP:this.delta=this.valueType===V.VALUE?this.amount:Math.floor(this.target.getUnitData().baseMaxHp*this.amount/100),this.target.getUnitData().maxHP+=this.delta;break;case F.SP:this.delta=this.valueType===V.VALUE?this.amount:Math.floor(this.target.getUnitData().baseMaxSp*this.amount/100),this.target.getUnitData().maxSP+=this.delta;break;case F.PWR:this.delta=this.valueType===V.VALUE?this.amount:Math.floor(this.target.getUnitData().basePwr*this.amount/100),this.target.getUnitData().currPwr+=this.delta;break;case F.DEF:this.delta=this.valueType===V.VALUE?this.amount:Math.floor(this.target.getUnitData().baseDef*this.amount/100),this.target.getUnitData().currDef+=this.delta;break;case F.MVT:this.delta=this.valueType===V.VALUE?this.amount:Math.floor(this.target.getUnitData().baseMvt*this.amount/100),this.target.getUnitData().currMvt+=this.delta}}apply(){this.active&&(this.applied||(this.applyStatChange(),this.applied=!0),this.duration||this.remove(),this.currTime<this.duration?this.currTime++:this.currTime>=this.duration&&this.duration>0&&this.remove())}remove(){if(!this.isRemovable){console.log("This spell effect cannot be removed.");return}this.forceRemove()}forceRemove(){switch(this.stat){case F.HP:this.target.getUnitData().maxHP-=this.delta;break;case F.SP:this.target.getUnitData().maxSP-=this.delta;break;case F.PWR:this.target.getUnitData().currPwr-=this.delta;break;case F.DEF:this.target.getUnitData().currDef-=this.delta;break;case F.MVT:this.target.getUnitData().currMvt-=this.delta}this.active=!1,console.log("This spell effect has been removed.")}constructor(t,e,i=V.VALUE,s,a=0,n=!0){this.name=t,this.amount=e,this.valueType=i,this.stat=s,this.duration=a,this.currTime=0,this.isRemovable=n,this.active=!1,this.applied=!1,this.delta=0}}class X extends K{constructor(t,e,i=V.VALUE,s,a=0,n=!0){super(t,e,i,s,a,n)}}class J{constructor(t,e,i,s,a=!1){this.id=t,this.x=e,this.y=i,this.tile=s,this.capturable=a}}class Z extends J{updateCaptureTick(){this.captureTick--}resetCaptureTick(){this.captureTick=3}getCaptureTicks(){return this.captureTick}capture(t){this.owner=t}getOwner(){return this.owner}constructor(t,e,i,s){super(t,e,i,s,!0),this.captureTick=3}}class q extends Z{linkRallyPoints(t){this.rallyPoints=[...this.rallyPoints,...t]}getRallyPoints(){return this.rallyPoints}constructor(t,e,i,s){super(t,e,i,s),this.effects=[new X("Stronghold's Advantage",3,V.VALUE,F.PWR,-1,!1),new X("Stronghold's Advantage",3,V.VALUE,F.DEF,-1,!1)],this.rallyPoints=[]}}class Q extends J{constructor(t,e,i,s){super(t,e,i,s)}}class $ extends Z{linkRallyPoints(t){this.rallyPoints=[...this.rallyPoints,...t]}getRallyPoints(){return this.rallyPoints}constructor(t,e,i,s){super(t,e,i,s),this.effects=[new X("Outpost's Advantage",1,V.VALUE,F.PWR,-1,!1),new X("Outpost's Advantage",1,V.VALUE,F.DEF,-1,!1)],this.rallyPoints=[]}}class tt extends Z{constructor(t,e,i,s){super(t,e,i,s)}}class te extends Z{constructor(t,e,i,s){super(t,e,i,s)}}(a=o||(o={}))[a.SUCCESS=0]="SUCCESS",a[a.WARNING=1]="WARNING",a[a.DANGER=2]="DANGER",(n=h||(h={}))[n.NONE=0]="NONE",n[n.PLAY_CARD=1]="PLAY_CARD",n[n.MOVE_UNIT=2]="MOVE_UNIT";class ti{setStatus(t){let e=this.getColorByTileStatus(t);this.status=t,this.tile.setFillStyle(e,.25),this.tile.setStrokeStyle(1,e)}getStatus(){return this.status}getTile(){return this.tile}show(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.NONE;this.tileSelectionType=i,this.setStatus(t||this.initStatus),this.selectedUnit=e||void 0,this.tile.setVisible(!0)}hide(){this.status=this.initStatus,this.tile.setVisible(!1),this.selectedUnit=void 0}getColorByTileStatus(t){switch(t){case o.SUCCESS:return M.success;case o.WARNING:return M.warning;case o.DANGER:return M.danger;default:return M.none}}constructor(t,e,i,s,a,n,r=o.SUCCESS){let c=this.getColorByTileStatus(r);this.status=r,this.initStatus=r,this.tilePosition=s,this.tile=t.add.rectangle(i.x,i.y,a,n,c,.25).setOrigin(0).setStrokeStyle(1,c).setName(e).setInteractive(),this.tileSelectionType=h.NONE,this.selectedUnit=void 0,this.tile.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{if(this.status===o.SUCCESS)switch(this.tileSelectionType){case h.PLAY_CARD:C.emit(y.cardEvent.PLAY,{x:s.x,y:s.y});break;case h.MOVE_UNIT:C.emit(y.unitEvent.MOVE,this.selectedUnit,this.tilePosition)}else console.log("Not a valid target")}),this.tile.setVisible(!1)}}let ts="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var ta={randomUUID:ts};let tn=new Uint8Array(16),tr=[];for(let t=0;t<256;++t)tr.push((t+256).toString(16).slice(1));var to=function(t,e,i){if(ta.randomUUID&&!e&&!t)return ta.randomUUID();t=t||{};let a=t.random||(t.rng||function(){if(!s&&!(s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(tn)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e){i=i||0;for(let t=0;t<16;++t)e[i+t]=a[t];return e}return function(t,e=0){return tr[t[e+0]]+tr[t[e+1]]+tr[t[e+2]]+tr[t[e+3]]+"-"+tr[t[e+4]]+tr[t[e+5]]+"-"+tr[t[e+6]]+tr[t[e+7]]+"-"+tr[t[e+8]]+tr[t[e+9]]+"-"+tr[t[e+10]]+tr[t[e+11]]+tr[t[e+12]]+tr[t[e+13]]+tr[t[e+14]]+tr[t[e+15]]}(a)};class th{handleEvents(){C.on(y.gameEvent.PLAYER_TURN,(t,e,i)=>{this.activePlayerIndex=e;let s=this.playersInGame[e];s.getActiveUnits().forEach(t=>{this.attemptCaptureLandmark(t)});let a=this.playersInGame[e].getLandmarksOwned(),n=2*a.strongholds.length+a.outposts.length+a.resourceNodes.length;C.emit(y.playerEvent.GENERATE_RESOURCES,t,n)}).on(y.gameEvent.NEXT_TURN,()=>{let t=this.playersInGame[this.activePlayerIndex];t.getActiveUnits().forEach(t=>{t.isActive()&&(t.sleep(),console.log("".concat(t.getUnitData().name," has not moved, so it was set to inactive...")))})}).on(y.cardEvent.SELECT,t=>{if(this.hideHighlightTiles(),t instanceof b||t instanceof D){let t=this.playersInGame[this.activePlayerIndex].getLandmarksOwned().rallyPoints.map(t=>({x:t.x,y:t.y}));this.showHighlightTiles(t,void 0,void 0,h.PLAY_CARD)}else switch(t.data.targetType){case O.ally:console.log("Choose an ally to use ".concat(t.data.name," on..."));break;case O.enemy:console.log("Choose an enemy to use ".concat(t.data.name," on..."));break;case O.position:console.log("Choose a target location to use ".concat(t.data.name," on..."));break;default:console.log("Applied ".concat(t.data.name,"!"))}}).on(y.cardEvent.CANCEL,()=>{this.hideHighlightTiles()}).on(y.fieldEvent.SUMMON_UNIT,(t,e,i)=>{let s=this.playersInGame.find(t=>t.playerInfo.id==i.id);s&&this.summonUnit(t,e,s)}).on(y.unitEvent.SELECT,t=>{this.movingUnit&&this.movingUnit!=t&&this.movingUnit.cancelMove(),this.movingUnit=t,this.hideHighlightTiles();let e=t.getUnitData().currMvt,i=t.getUnitData().currRng,s=t.getLocation(),a=t.isActive();if(a){let i=this.getTilesInRange(s,e,!1);this.showHighlightTiles(i,t,void 0,h.MOVE_UNIT);return}let n=this.getTilesInRange(s,i,!0);this.showHighlightTiles(n,t,o.WARNING)}).on(y.unitEvent.CANCEL,()=>{var t;this.hideHighlightTiles(),null===(t=this.movingUnit)||void 0===t||t.cancelMove(),this.movingUnit=void 0}).on(y.unitEvent.WAIT,()=>{if(this.hideHighlightTiles(),!this.movingUnit)return;let t=this.movingUnit.getLocation(),e=this.landmarks.get("".concat(t.x,"_").concat(t.y));e&&e.capturable&&(e.occupant=void 0,e.resetCaptureTick()),this.units.delete("".concat(t.x,"_").concat(t.y)),this.movingUnit.confirmMove();let i=this.movingUnit.getLocation(),s=this.landmarks.get("".concat(i.x,"_").concat(i.y));this.units.set("".concat(i.x,"_").concat(i.y),this.movingUnit),this.movingUnit=void 0,s&&(s.occupant=this.movingUnit)}).on(y.fieldEvent.CAPTURE_LANDMARK,(t,e)=>{let i=this.playerIdToIndexMap.get(t.getOwner().id);void 0!==i&&this.playersInGame[i].registerLandmark(e)}).on(y.unitEvent.DEATH,t=>{let e=this.playerIdToIndexMap.get(t.getOwner().id);if(void 0===e)return;let i=this.playersInGame[e];i.moveUnitToGraveyard(t);let s=t.getLocation();this.units.delete("".concat(s.x,"_").concat(s.y)),t.setLocation({x:-1,y:-1}),C.emit(y.uiEvent.UPDATE_CASUALTY_COUNTER,i.getCasualties())})}generateMap(){let t=this.scene.make.tilemap({key:x.TILE_MAP});t.addTilesetImage(x.TILE_MAP_TILE_SET_IMG,x.TILE_SET),t.addTilesetImage(x.TILE_MAP_ICON_SET_IMG,x.MAP_ICONS);let e=t.createLayer(x.TILE_GROUND_LAYER,x.TILE_MAP_TILE_SET_IMG,0,0).setOrigin(0),i=t.createLayer(x.TILE_DECORATION_LAYER,x.TILE_MAP_TILE_SET_IMG,0,0).setOrigin(0),s=t.createLayer(x.TILE_OBSTACLE_LAYER,x.TILE_MAP_TILE_SET_IMG,0,0).setOrigin(0),a=t.createLayer(x.TILE_LANDMARKS_LAYER,x.TILE_MAP_ICON_SET_IMG,0,0).setOrigin(0),n=t.getObjectLayer(x.TILE_MAP_PLAYER_START_LAYER);return{map:t,layers:{ground:e,decoration:i,obstacle:s,landmarks:a,playerStarts:n}}}generateHighlightTiles(t){let e=t.map,i=t.layers.obstacle,s=Array(e.height).fill([]).map(t=>Array(e.width));e.forEachTile(t=>{let e=i.getTileAt(t.x,t.y)?o.DANGER:o.SUCCESS,a=new ti(this.scene,"tile_".concat(t.x,"_").concat(t.y),{x:t.pixelX,y:t.pixelY},{x:t.x,y:t.y},t.width,t.height,e);s[t.y][t.x]=a}),this.selectionTiles=s}loadLandmarks(t){let e={strongholds:[],outposts:[],resourceNodes:[]},i=new Map,s=new Map,a=new Map,n=t.layers.landmarks;return n.forEachTile(t=>{let n;let r=t.x,o=t.y,h=t.properties.name,c="".concat(r,"_").concat(o);switch(h){case"Stronghold":console.log("Stronghold at (".concat(r,",").concat(o,")")),n=new q("stronghold_".concat(r,"_").concat(o),r,o,t),s.set(c,n),e.strongholds=[...e.strongholds,n];break;case"Rally Point":console.log("Rally Point at (".concat(r,",").concat(o,")")),n=new Q("rally_point_".concat(r,"_").concat(o),r,o,t),i.set(c,n);break;case"Outpost":console.log("Outpost at (".concat(r,",").concat(o,")")),n=new $("outpost_".concat(r,"_").concat(o),r,o,t),e.outposts=[...e.outposts,n],s.set(c,n);break;case"Resource Node":console.log("Resource Node at (".concat(r,",").concat(o,")")),n=new tt("resource_node_".concat(r,"_").concat(o),r,o,t),e.resourceNodes=[...e.resourceNodes,n];break;case"Interest Point":console.log("Interest Point at (".concat(r,",").concat(o,")")),n=new te("point_of_interest_".concat(r,"_").concat(o),r,o,t);break;case"Camp":console.log("Camp at (".concat(r,",").concat(o,")"))}n&&a.set(c,n)}),this.linkRalliesToParents(s,i),{landmarks:e,landmarkMap:a}}linkRalliesToParents(t,e){t.forEach(t=>{let i=[],s=e.get("".concat(t.x-1,"_").concat(t.y)),a=e.get("".concat(t.x-1,"_").concat(t.y-1)),n=e.get("".concat(t.x,"_").concat(t.y-1)),r=e.get("".concat(t.x+1,"_").concat(t.y-1)),o=e.get("".concat(t.x+1,"_").concat(t.y)),h=e.get("".concat(t.x+1,"_").concat(t.y+1)),c=e.get("".concat(t.x,"_").concat(t.y+1)),l=e.get("".concat(t.x-1,"_").concat(t.y+1));s&&(i=[...i,s]),a&&(i=[...i,a]),n&&(i=[...i,n]),r&&(i=[...i,r]),o&&(i=[...i,o]),h&&(i=[...i,h]),c&&(i=[...i,c]),l&&(i=[...i,l]),t.linkRallyPoints(i)})}assignInitialLandmarks(t,e){let i=t.layers.playerStarts,s=t.layers.landmarks;i.objects.forEach(t=>{let i=Math.floor(t.x/t.width),a=Math.floor(t.y/t.height),n=s.getTileAt(i,a),r=n.properties.name,o=this.playersInGame[Number(t.name)-1];if(o)switch(r){case"Stronghold":let h=e.strongholds.find(t=>t.x==i&&t.y==a);h&&(o.registerLandmark(h),h.capture(o));break;case"Outpost":let c=e.outposts.find(t=>t.x==i&&t.y==a);c&&(o.registerLandmark(c),c.capture(o));break;case"Resource Node":let l=e.resourceNodes.find(t=>t.x==i&&t.y==a);l&&(o.registerLandmark(l),l.capture(o))}})}showHighlightTiles(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.NONE;t.forEach(t=>{let a=this.selectionTiles[t.y][t.x];this.activeHighlightTiles=[...this.activeHighlightTiles,a];let n=this.units.get("".concat(t.x,"_").concat(t.y));!i&&n&&n!=this.movingUnit?a.show(o.DANGER,e,s):a.show(i,e,s)})}hideHighlightTiles(){var t;null===(t=this.activeHighlightTiles)||void 0===t||t.forEach(t=>{t.hide()}),this.activeHighlightTiles=[]}summonUnit(t,e,i){let s=new j(to().toString(),t,e,i),a=s.getLocation();s.render(this.scene),e instanceof S?i.registerHero(s):i.registerUnit(s),this.units.set("".concat(a.x,"_").concat(a.y),s),e instanceof S?console.log("Summoned hero unit ".concat(s.getUnitData().name," with id ").concat(s.id," at location (").concat(a.x,",").concat(a.y,")")):console.log("Summoned ".concat(s.getUnitData().name," with id ").concat(s.id," at location (").concat(a.x,",").concat(a.y,")"))}update(){this.movingUnit&&this.movingUnit.update()}getTilesInRange(t,e,i){let s={x:this.tilemap.map.width-1,y:this.tilemap.map.height-1},a=this.tilemap.layers.obstacle,n=this.units,r=this.movingUnit,o=new Map;!function t(e,h){if(0===h||e.x<0||e.y<0||e.x>s.x||e.y>s.y||(o.set("".concat(e.x,"_").concat(e.y),e),!i&&a.getTileAt(e.x,e.y)))return;let c=n.get("".concat(e.x,"_").concat(e.y));(i||!c||c==r)&&(t({x:e.x-1,y:e.y},h-1),t({x:e.x,y:e.y-1},h-1),t({x:e.x+1,y:e.y},h-1),t({x:e.x,y:e.y+1},h-1))}(t,e+1);let h=Array.from(o.values());return h}attemptCaptureLandmark(t){let{x:e,y:i}=t.getLocation(),s=this.landmarks.get("".concat(e,"_").concat(i));null==s||!s.capturable||s instanceof Q||s.getOwner()==t.getOwner()||(s.updateCaptureTick(),0===s.getCaptureTicks()?C.emit(y.fieldEvent.CAPTURE_LANDMARK,t,s):console.log("".concat(s.id," will be captured by ").concat(t.getOwner().id," in ").concat(s.getCaptureTicks()," turns...")))}getUnitsInRange(t){}constructor(t,e){this.scene=t,this.playersInGame=e,this.playerIdToIndexMap=new Map,e.forEach((t,e)=>{this.playerIdToIndexMap.set(t.id,e)});let i=this.generateMap();this.tilemap=i,this.generateHighlightTiles(i),this.activeHighlightTiles=[];let{landmarks:s,landmarkMap:a}=this.loadLandmarks(i);this.landmarks=a,this.units=new Map,this.assignInitialLandmarks(i,s);let n={mapData:i,units:this.units,landmarks:this.landmarks};this.scene.game.registry.set(v.field,n),this.handleEvents(),this.activePlayerIndex=0,e.forEach(t=>{let e=t.getStartingStronghold(),i=t.deck.getLeader();i&&this.summonUnit({x:null==e?void 0:e.x,y:e.y},i.data,t)})}}class tc{goToNextTurn(){this.activePlayerIndex==this.playersInGame.length-1&&(this.activePlayerIndex=-1,this.turn++),this.activePlayerIndex++,this.activePlayer=this.playersInGame[this.activePlayerIndex],console.log("Active Player: ".concat(this.activePlayer.playerInfo.name,", Active Player Index: ").concat(this.activePlayerIndex)),console.log("Active Player ID: ".concat(this.activePlayer.id,", The Device Player ID: ").concat(this.devicePlayer.id));let t=this.activePlayer.id===this.devicePlayer.id;C.emit(y.gameEvent.PLAYER_TURN,this.activePlayer.id,this.activePlayerIndex,t)}pass(t){console.log("Player ".concat(t,"'s turn...")),console.log("Player ".concat(t," is not implemented, so will pass...")),C.emit(y.gameEvent.NEXT_TURN)}constructor(t,e){this.devicePlayer=t,this.playersInGame=[...e],this.activePlayerIndex=-1,this.turn=1,C.on(y.gameEvent.NEXT_TURN,()=>{this.goToNextTurn()}).on(y.gameEvent.PLAYER_TURN,t=>{t!=this.devicePlayer.id&&this.pass(t)})}}class tl extends Phaser.Scene{preload(){}create(){let{player:t,playersInGame:e}=this.loadPlayers();this.game.scene.start(f.HUD),this.fieldManager=new th(this,e),this.turnManager=new tc(t,e),this.combatHandler=new B;let i=this.game.registry.get(v.field).mapData.map,s=this.cameras.main;this.cameras.main.setBounds(0,0,i.widthInPixels+.2*i.widthInPixels,i.heightInPixels+m.height/3.125).setZoom(3.125).setOrigin(.5),function(t,e){t.on(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,t=>{t.isDown&&(e.scrollX-=(t.x-t.prevPosition.x)/e.zoom,e.scrollY-=(t.y-t.prevPosition.y)/e.zoom)})}(this.input,s)}loadPlayers(){let t=this.game.registry.get(v.player),e=this.game.registry.get(v.opponents);return{player:t,playersInGame:[t,...e]}}update(){this.started||(C.emit(y.gameEvent.NEXT_TURN),this.started=!0)}constructor(){super({key:f.GAMEPLAY}),this.started=!1}}let td=Object.freeze({actionLight:65520,action:119,cancelLight:11141120,cancel:7798784,background:1842204});class tu extends Phaser.GameObjects.Container{hide(){this.setVisible(!1)}show(){this.setVisible(!0)}constructor(t,e,i,s,a,n,r,o,h,c,l){super(t,s.x,s.y),this.name=e,this.bg=t.add.rectangle(0,0,a,n,r).setOrigin(0),this.display=t.add.text(0,0,i),this.add(this.bg),this.add(this.display),this.scene.add.existing(this),this.setInteractive(this.bg,Phaser.Geom.Rectangle.Contains).on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{o&&o()}).on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{h&&h()}).on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,()=>{c&&c()}).on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,()=>{l&&l()}),this.setScrollFactor(0),this.setDepth(1/0)}}let tg={width:.12*g.width,height:.2*g.height};class tm extends Phaser.GameObjects.Container{constructor(t,e){super(t,e.x,e.y),this.bg=t.add.rectangle(0,0,tg.width,tg.height,td.background).setOrigin(0);let i=t.add.image(.2*tg.width,.3*tg.height,x.DECK_COUNT).setOrigin(.5),s=t.add.text(.4*tg.width,.15*tg.height,"X 0",{fontSize:50}),a=t.add.image(.2*tg.width,.7*tg.height,x.DEATH_COUNT).setOrigin(.5),n=t.add.text(.4*tg.width,.55*tg.height,"X 0",{fontSize:50});this.add(this.bg),this.add(i),this.add(s),this.add(a),this.add(n),C.on(y.uiEvent.UPDATE_DECK_COUNTER,t=>{s.setText("X ".concat(t))}).on(y.uiEvent.UPDATE_CASUALTY_COUNTER,t=>{n.setText("X ".concat(t))})}}class tE extends Phaser.GameObjects.Container{render(t){t.forEach(t=>{let e=t.render(this.scene);this.add(e)})}constructor(t){super(t,0,0)}}let tp={width:.12*g.width,height:.4*g.height};class tT extends Phaser.GameObjects.Container{constructor(t,e){super(t,e.x,e.y),this.bg=t.add.rectangle(0,0,tp.width,tp.height,td.background).setOrigin(0);let i=t.add.text(.2*tp.width,.2*tp.height,"0",{fontSize:50}),s=t.add.line(0,.25*tp.height,.1*tp.height,.4*tp.height,.8*tp.width,-(.05*tp.height),16777215).setLineWidth(3).setOrigin(0),a=t.add.text(.55*tp.width,.5*tp.height,"0",{fontSize:50}),n=t.add.image(.3*tp.width,.8*tp.height,x.INCOME_RATE).setOrigin(.5),r=t.add.text(.5*tp.width,.8*tp.height,"X 0",{fontSize:20});this.add(this.bg),this.add(i),this.add(s),this.add(a),this.add(n),this.add(r),C.on(y.uiEvent.UPDATE_RESOURCE_DISPLAY,(t,e,s)=>{console.log("Update Display with ".concat(t,"/ ").concat(e)),i.setText(String(t)),a.setText(String(e)),s&&(console.log("Update Income Rate Display with ".concat(s)),r.setText("X ".concat(s)))})}}let ty={width:.05*m.width,height:.05*m.width},tv={width:.5*ty.width,height:.5*ty.height};class tf extends Phaser.GameObjects.Container{show(t){this.unitData=t.getUnitData(),this.image.setTexture(t.getGameObject().imageAssetName),this.unitNameText.setText(this.unitData.name),this.classIcon.setTexture(x.CLASS_ICONS,function(t){switch(t){case A.SOLDIER:return P.SOLDIER;case A.GUARDIAN:return P.GUARDIAN;case A.RANGER:return P.RANGER;case A.MAGE:return P.MAGE;case A.LANCER:return P.LANCER;case A.TOWER:return P.TOWER;case A.BERSERKER:return P.BERSERKER;case A.ASSASSIN:return P.ASSASSIN;default:return P.SOLDIER}}(this.unitData.unitClass)),this.unitHPText.setText(String(this.unitData.currHp)),this.unitSPText.setText(String(this.unitData.currSp)),this.unitPwrText.setText(String(this.unitData.currPwr)),this.setVisible(!0)}update(){this.unitData&&(this.unitHPText.setText(String(this.unitData.currHp)),this.unitSPText.setText(String(this.unitData.currSp)),this.unitPwrText.setText(String(this.unitData.currPwr)),this.setVisible(!0))}hide(){this.setVisible(!1)}constructor(t){super(t,0,0),this.image=t.add.sprite(.5*p.width,.5*p.height,x.UNDEFINED).setDisplaySize(p.width,p.height).setOrigin(.5);let e=t.add.container(.15*m.width,.7*m.height),i=t.add.image(0,0,x.HP_ICON).setDisplaySize(ty.width,ty.height).setOrigin(.5);this.unitHPText=t.add.text(0,0,"0").setFontSize(32).setOrigin(.5),e.add(i),e.add(this.unitHPText);let s=t.add.container(.25*m.width,.7*m.height),a=t.add.image(0,0,x.SP_ICON).setDisplaySize(ty.width,ty.height).setOrigin(.5);this.unitSPText=t.add.text(0,0,"0").setFontSize(32).setOrigin(.5),s.add(a),s.add(this.unitSPText);let n=t.add.container(.35*m.width,.7*m.height),r=t.add.image(0,0,x.PWR_ICON).setDisplaySize(ty.width,ty.height).setOrigin(.5);this.unitPwrText=t.add.text(0,0,"0").setFontSize(32).setOrigin(.5),n.add(r),n.add(this.unitPwrText),this.unitNameText=t.add.text(.15*m.width,.2*m.height,"unit name").setOrigin(0);let o=t.add.container(.125*m.width,.2*m.height),h=t.add.rectangle(0,0,tv.width,tv.height,0).setStrokeStyle(2,16777215).setOrigin(.5);this.classIcon=t.add.sprite(0,0,x.CLASS_ICONS,P.SOLDIER).setDisplaySize(tv.width,tv.height).setOrigin(.5),o.add(h),o.add(this.classIcon),this.add(this.image),this.add(this.unitNameText),this.add(o),this.add(e),this.add(s),this.add(n)}}class tA{handleEvents(){C.on(y.gameEvent.PLAYER_TURN,(t,e,i)=>{i&&this.drawCard()}).on(y.cardEvent.SELECT,t=>{this.returnCard(),this.selected=t,this.pullOutCard(),console.log("Selected card#".concat(this.selected.id))}).on(y.cardEvent.CANCEL,()=>{this.selected&&(this.returnCard(),this.selected=void 0,console.log("Deselected card"))}).on(y.cardEvent.PLAY,t=>{if(!this.selected){console.log("No card is selected...");return}this.playCard(t)})}getHand(){return[...this.hand]}playCard(t){if(!this.selected){console.log("No card is selected...");return}try{this.player.spendResources(this.selected.data.cost),this.selected.play(t),this.removeSelected()}catch(t){console.log(t.message)}finally{C.emit(y.cardEvent.CANCEL)}}drawCard(){let t=this.deck.length;if(0===t)return;let e=Math.floor(Math.random()*this.deck.length),i=this.deck.splice(e,1)[0];return i.setPosition({x:this.hand.length*E.width,y:0}),this.hand=[...this.hand,i],C.emit(y.uiEvent.UPDATE_HAND,this.getHand()),C.emit(y.uiEvent.UPDATE_DECK_COUNTER,this.deck.length),i}removeSelected(){this.hand=this.hand.filter(t=>t!==this.selected),this.selected.hide(),this.selected=void 0,this.repositionCardsInHand(),C.emit(y.uiEvent.UPDATE_HAND,this.hand)}repositionCardsInHand(){let t=0;this.hand.forEach(e=>{e.setPosition({x:t*E.width,y:0}),t++})}pullOutCard(){if(!this.selected)return;let t=this.selected.getPosition();if(0!==t.y)return;let e={...t,y:t.y-.05*E.height};this.selected.setPosition({x:e.x,y:e.y})}returnCard(){if(!this.selected)return;let t=this.selected.getPosition();if(0===t.y)return;let e={...t,y:0};this.selected.setPosition({x:e.x,y:e.y})}constructor(t){this.player=t,this.deck=t.deck.getCards(),this.hand=[],this.handleEvents()}}let tP={width:200,height:50};class tR extends Phaser.Scene{preload(){}create(){let t=this.game.registry.get(v.player);this.player=t,this.bottomPanel=this.add.container(0,.8*g.height),this.rightPanel=this.add.container(.87*g.width,0),this.cardManager=new tA(t);let e=this.add.rectangle(0,0,m.width,m.height,td.background).setOrigin(0);this.bottomPanel.add(e);let i=new tE(this);this.add.existing(i),this.bottomPanel.add(i);let s=new tu(this,"cancelCardButton","Cancel",{x:.8*m.width,y:.5*m.height},tP.width,tP.height,td.cancel,()=>{null==s||s.bg.setFillStyle(td.cancelLight)},()=>{null==s||s.bg.setFillStyle(td.cancel),C.emit(y.cardEvent.CANCEL)});i.add(s),s.hide();let a=new tu(this,"endTurnButton","End Turn",{x:.8*m.width,y:.1*m.height},tP.width,tP.height,td.action,()=>{null==a||a.bg.setFillStyle(td.actionLight)},()=>{null==a||a.bg.setFillStyle(td.action),C.emit(y.gameEvent.NEXT_TURN)});i.add(a);let n=new tf(this);this.add.existing(n),this.bottomPanel.add(n);let r=new tu(this,"cancelUnitButton","Cancel",{x:.8*m.width,y:.5*m.height},tP.width,tP.height,td.cancel,()=>{null==s||s.bg.setFillStyle(td.cancelLight)},()=>{null==s||s.bg.setFillStyle(td.cancel),C.emit(y.unitEvent.CANCEL)});n.add(r);let o=new tu(this,"waitButton","Wait",{x:.8*m.width,y:.1*m.height},tP.width,tP.height,td.action,()=>{null==o||o.bg.setFillStyle(td.actionLight)},()=>{null==o||o.bg.setFillStyle(td.action),C.emit(y.unitEvent.WAIT)});n.add(o),n.hide(),this.resourceDisplay=new tT(this,{x:0,y:.39*g.height}),this.rightPanel.add(this.resourceDisplay),this.deckStatDisplay=new tm(this,{x:0,y:.15*g.height}),this.rightPanel.add(this.deckStatDisplay),C.on(y.cardEvent.SELECT,()=>{s.show(),this.isPlayerTurn&&a.hide()}).on(y.cardEvent.CANCEL,()=>{s.hide(),this.isPlayerTurn&&a.show()}).on(y.uiEvent.UPDATE_HAND,t=>{i.render(t)}).on(y.unitEvent.SELECT,t=>{C.emit(y.cardEvent.CANCEL),i.setVisible(!1),n.show(t),t.isActive()&&t.getOwner()==this.player?o.show():o.hide()}).on(y.uiEvent.UPDATE_UNIT_STAT_DISPLAY,()=>{n.update()}).on(y.unitEvent.CANCEL,()=>{i.setVisible(!0),n.hide()}).on(y.unitEvent.WAIT,()=>{i.setVisible(!0),n.hide()}).on(y.gameEvent.PLAYER_TURN,(t,e,i)=>{i&&(this.wake(),a.setVisible(!0))}).on(y.gameEvent.NEXT_TURN,()=>{this.sleep(),a.setVisible(!1)}),this.cardManager.drawCard(),this.cardManager.drawCard(),this.cardManager.drawCard()}sleep(){this.isPlayerTurn=!1}wake(){this.isPlayerTurn=!0}update(){}constructor(){super({key:f.HUD}),this.isPlayerTurn=!1}}class tS{constructor(t,e){this.id=t,this.name=e}}(r=c||(c={}))[r.STRONGHOLD=0]="STRONGHOLD",r[r.OUTPOST=1]="OUTPOST",r[r.RALLY_POINT=2]="RALLY_POINT",r[r.RESOURCE_NODE=3]="RESOURCE_NODE",r[r.POINT_OF_INTEREST=4]="POINT_OF_INTEREST",r[r.CAMP=5]="CAMP";class tw{setTeam(t){this.team=t}getTeam(){return this.team}registerLandmark(t){t.getOwner(),this.unregisterLandmark(t),t instanceof q?this.landmarksOwned.strongholds.push(t):t instanceof $?this.landmarksOwned.outposts.push(t):t instanceof tt&&this.landmarksOwned.resourceNodes.push(t),(t instanceof q||t instanceof $)&&t.getRallyPoints().forEach(t=>{t.tile.tint=this.color,this.landmarksOwned.rallyPoints=[...this.landmarksOwned.rallyPoints,t]}),t.capture(this),t.tile.tint=this.color,console.log("".concat(t.id," has been captured by ").concat(this.playerInfo.name))}unregisterLandmark(t){let e=t.getOwner();if(e&&(console.log("Remove ".concat(t.id," from ").concat(t.getOwner().id,"'s ownership...")),t instanceof q?e.landmarksOwned.strongholds=e.landmarksOwned.strongholds.filter(e=>e.id!=t.id):t instanceof $?e.landmarksOwned.outposts=e.landmarksOwned.outposts.filter(e=>e.id!=t.id):t instanceof tt&&(e.landmarksOwned.resourceNodes=e.landmarksOwned.resourceNodes.filter(e=>e.id!=t.id)),t instanceof q||t instanceof $)){var i;let s=t.getRallyPoints();e.landmarksOwned.rallyPoints=null===(i=e.landmarksOwned.rallyPoints)||void 0===i?void 0:i.filter(t=>!s.find(e=>e==t))}}registerUnit(t){this.activeUnits=[...this.activeUnits,t]}registerHero(t){t.card instanceof b||(this.activeChampions=[...this.activeChampions,t])}moveUnitToGraveyard(t){this.activeUnits=this.activeUnits.filter(e=>e!=t),this.graveyard.push(t)}getLandmarkAt(t,e){switch(t){case c.STRONGHOLD:return this.landmarksOwned.strongholds.find(t=>t.x==e.x&&t.y==e.y);case c.OUTPOST:return this.landmarksOwned.outposts.find(t=>t.x==e.x&&t.y==e.y);case c.RESOURCE_NODE:return this.landmarksOwned.resourceNodes.find(t=>t.x==e.x&&t.y==e.y)}}getStartingStronghold(){return this.landmarksOwned.strongholds[0]}getLandmarksOwned(){return this.landmarksOwned}getActiveUnits(){return[...this.activeUnits,...this.activeChampions]}getCasualties(){return this.graveyard.length}generateResources(t){let e=this.currResource+t;e>this.maxResource&&(e=this.maxResource),this.currResource=e,C.emit(y.uiEvent.UPDATE_RESOURCE_DISPLAY,this.currResource,this.maxResource,t)}spendResources(t){if(t>this.currResource)throw Error("Not enough resources");this.currResource-=t,C.emit(y.uiEvent.UPDATE_RESOURCE_DISPLAY,this.currResource,this.maxResource)}getResources(){return{current:this.currResource,max:this.maxResource}}constructor(t,e,i,s,a,n=!1){this.id=t,this.playerInfo=e,this.team=i,this.color=s,this.deck=a,this.isDevicePlayer=n,this.activeChampions=[],this.activeUnits=[],this.traps=[],this.landmarksOwned={strongholds:[],outposts:[],resourceNodes:[],rallyPoints:[]},this.graveyard=[],this.currResource=0,this.maxResource=2,C.on(y.gameEvent.PLAYER_TURN,(e,i)=>{e===t&&this.maxResource<10&&this.maxResource++}).on(y.playerEvent.GENERATE_RESOURCES,(e,i)=>{e===t&&this.generateResources(i)})}}let tO=Object.freeze({PLAYER1:255,PLAYER2:16711680,PLAYER3:48300,PLAYER4:16776960,NEUTRAL:0});function tC(t){switch(t){case 1:return tO.PLAYER1;case 2:return tO.PLAYER2;case 3:return tO.PLAYER3;case 4:return tO.PLAYER4;default:return tO.NEUTRAL}}let t_=Object.freeze({dealDamage:"deal-damage",heal:"heal",statChange:"stat-change",summon:"summon",drawCard:"draw-card"});class tL{static getSkillEffect(t,e){let i,s=[];switch(e.effectType){case t_.dealDamage:if(!e.amount||!e.valueType)break;i=new z(e.name?e.name:t,e.amount,e.valueType,e.duration,e.overTime,e.isDelayed,e.isRemovable);break;case t_.heal:if(!e.amount||!e.valueType)break;i=new W(e.name?e.name:t,e.amount,e.valueType,e.duration,e.overTime,e.isDelayed,e.isRemovable)}return i&&(s=[...s,i]),s}}class tx extends I{play(t){switch(this.data.targetType){case O.ally:case O.enemy:case O.position:C.emit(y.fieldEvent.CAST_SPELL,this.skillEffects,t);break;default:C.emit(y.fieldEvent.CAST_SPELL,this.skillEffects)}}constructor(t,e,i){super(t,e,i),this.skillEffects=tL.getSkillEffect(this.data.name,e.effectData)}}class tN{getCards(){return this.cards}getLeader(){return this.leader}constructor(t,e){this.cards=t,this.leader=e}}class tU extends Phaser.Scene{preload(){this.load.image(x.TILE_SET,"./assets/maps/tilesets/tileset.png"),this.load.image(x.MAP_ICONS,"./assets/maps/tilesets/mapicons.png"),this.load.tilemapTiledJSON(x.TILE_MAP,"./assets/maps/testmap2.json"),this.load.image(x.UNDEFINED,"./assets/portraits/undefined.png"),this.load.image(x.HP_ICON,"./assets/icons/hp.png"),this.load.image(x.SP_ICON,"./assets/icons/sp.png"),this.load.image(x.PWR_ICON,"./assets/icons/pwr.png"),this.load.image(x.ATTACK_SELECTOR,"./assets/icons/attack.png"),this.load.image(x.SPELL_SELECTOR,"./assets/icons/spell.png"),this.load.image(x.INCOME_RATE,"./assets/icons/incomeRate.png"),this.load.image(x.DECK_COUNT,"./assets/icons/deckCount.png"),this.load.image(x.DEATH_COUNT,"./assets/icons/deathCount.png"),this.load.spritesheet(x.CLASS_ICONS,"./assets/icons/Class.png",{frameWidth:31,frameHeight:31})}create(){console.log("Now Loading...");let t=new tS(to().toString(),"TestPlayer"),e=new tS(to().toString(),"Enemy"),i=new D("0",new S("3","test_mage_hero",A.MAGE,20,30,3,0,2,2,"pwr +25% to mages",{name:"Magic Aura",targetType:O.none,effectType:t_.statChange,childEffects:[],amount:25,valueType:V.PERCENTAGE,stat:F.PWR,duration:-1,isRemovable:!1},"recover 2sp per turn",{name:"Meditate",targetType:O.none,effectType:t_.statChange,amount:2,valueType:V.VALUE,stat:F.SP,duration:-1,overTime:!0,isRemovable:!1},"deal 2 damage to targets (radius 1)",{name:"Magic Burst",targetType:O.enemy,effectType:t_.dealDamage,childEffects:[],amount:2,valueType:V.VALUE},[A.MAGE,A.MAGE,A.MAGE,A.MAGE],5),t),s=new D("0",new S("2","test_ranger_hero",A.RANGER,22,15,3,0,3,3,"pwr +25% to rangers",{name:"Precision Aura",targetType:O.none,effectType:t_.statChange,childEffects:[],amount:25,valueType:V.PERCENTAGE,stat:F.PWR,duration:-1,isRemovable:!1},"+20% pwr when target is 3 tiles away",{name:"Snipe",targetType:O.none,effectType:t_.statChange,childEffects:[],amount:25,valueType:V.PERCENTAGE,stat:F.PWR,duration:-1,isRemovable:!1},"move unit 2 tiles",{name:"Chase",targetType:O.none,effectType:t_.statChange,amount:0,valueType:V.PERCENTAGE,stat:F.PWR},[A.RANGER,A.RANGER,A.RANGER,A.ASSASSIN,A.ASSASSIN,A.SOLDIER],5),e),a=[new D("1",new S("1","test_soldier_hero",A.SOLDIER,30,10,5,5,3,1,"pwr +25% to all",{name:"Assault Aura",targetType:O.none,effectType:t_.statChange,childEffects:[],amount:25,valueType:V.PERCENTAGE,stat:F.PWR,duration:-1,isRemovable:!1},"+2 pwr to units 1 tile adjacent to this unit",{name:"Charisma",targetType:O.none,effectType:t_.statChange,childEffects:[],amount:2,valueType:V.VALUE,stat:F.PWR,duration:-1,isRemovable:!1},"deal 3 damage to target within 3 tiles",{name:"Cleave",targetType:O.none,effectType:t_.dealDamage,amount:5,valueType:V.VALUE,stat:F.PWR},[A.SOLDIER,A.SOLDIER,A.SOLDIER,A.RANGER,A.RANGER,A.GUARDIAN],5),t),new b("2",new R("1","test_soldier",A.SOLDIER,10,0,1,1,3,1,1),t),new b("3",new R("1","test_soldier",A.SOLDIER,10,0,1,1,3,1,1),t),new b("4",new R("1","test_soldier",A.SOLDIER,10,0,1,1,3,1,1),t),new b("5",new R("3","test_ranger",A.RANGER,8,0,2,1,2,3,2),t),new b("6",new R("3","test_ranger",A.RANGER,8,0,2,1,2,3,2),t),new b("7",new R("6","test_guardian",A.GUARDIAN,15,0,1,1,1,1,3),t),new tx("8",new L("1","test_fire_spell",O.enemy,5,"Deal 1 burn damage per turn for 3 turns",{name:"Burn",targetType:O.enemy,effectType:t_.dealDamage,amount:1,valueType:V.VALUE,duration:3,overTime:!0,isRemovable:!0}),t),new tx("9",new L("2","test_heal_spell",O.ally,2,"Heal target by 10 hp",{name:"Heal",targetType:O.ally,effectType:t_.heal,amount:10,valueType:V.VALUE,isRemovable:!0}),t)],n=new tN(a,i),r=new tN([],s),o=new tw(1,t,1,tC(1),n),h=new tw(2,e,2,tC(2),r);this.game.registry.set(v.player,o),this.game.registry.set(v.opponents,[h]),this.game.scene.start(f.GAMEPLAY)}update(){}}function tI(){let t=new(d()).Game(T);return t.scene.add(f.LOADING,tU,!1),t.scene.add(f.GAMEPLAY,tl,!1),t.scene.add(f.HUD,tR,!1),t.scene.start(f.LOADING),t}},8960:function(t){!function(){var e={229:function(t){var e,i,s,a=t.exports={};function n(){throw Error("setTimeout has not been defined")}function r(){throw Error("clearTimeout has not been defined")}function o(t){if(e===setTimeout)return setTimeout(t,0);if((e===n||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(i){try{return e.call(null,t,0)}catch(i){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:n}catch(t){e=n}try{i="function"==typeof clearTimeout?clearTimeout:r}catch(t){i=r}}();var h=[],c=!1,l=-1;function d(){c&&s&&(c=!1,s.length?h=s.concat(h):l=-1,h.length&&u())}function u(){if(!c){var t=o(d);c=!0;for(var e=h.length;e;){for(s=h,h=[];++l<e;)s&&s[l].run();l=-1,e=h.length}s=null,c=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===r||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function g(t,e){this.fun=t,this.array=e}function m(){}a.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];h.push(new g(t,e)),1!==h.length||c||o(u)},g.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(t){return[]},a.binding=function(t){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},i={};function s(t){var a=i[t];if(void 0!==a)return a.exports;var n=i[t]={exports:{}},r=!0;try{e[t](n,n.exports,s),r=!1}finally{r&&delete i[t]}return n.exports}s.ab="//";var a=s(229);t.exports=a}()}}]);